<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TabulaGo - Takım Kelime Oyunu</title>
    
    <!-- Mobil optimizasyon meta tag'leri -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TabulaGo">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6a11cb">
    <meta name="msapplication-TileColor" content="#6a11cb">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Preload avatarlar için -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preload" as="image" href="avatar1.png">
    <link rel="preload" as="image" href="avatar2.png">
    <link rel="preload" as="image" href="avatar3.png">
    <link rel="preload" as="image" href="avatar4.png">
    <link rel="preload" as="image" href="avatar5.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <script src="words.js"></script>
    
    <style>
        /* ===== CSS DEĞİŞKENLERİ ===== */
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --accent: #ff6b6b;
            --success: #4cd964;
            --light: #f8f9fa;
            --dark: #212529;
            --team1: #ff9a3c;
            --team2: #00b4db;
            --team3: #9b59b6;
            --team4: #2ecc71;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.2);
            --radius: 16px;
            --radius-lg: 24px;
            --card-red: #d30000;
            --card-light-red: #ff4d4d;
            
            /* Zar boyutları */
            --dice-size: 80px;
            --pip-size: 8px;
        }

        /* ===== GENEL STİLLER ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
            overflow-x: hidden;
            max-width: 100vw;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .container,
        .screen {
            max-width: 100%;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }

        /* ===== HEADER STİLLERİ ===== */
        header {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        h1 {
            font-size: clamp(3rem, 6vw, 4.5rem);
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff9a3c, #00b4db, #9b59b6, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-weight: 800;
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
            opacity: 0.9;
            font-weight: 300;
            margin-top: 10px;
        }

        .logo-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: inline-block;
            background: linear-gradient(to right, var(--team1), var(--team2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-logo-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -58%);
            pointer-events: none;
            z-index: 5;
        }

        .header-logo {
            width: 280px;
            height: auto;
            display: block;
        }

        header .subtitle {
            position: relative;
            margin-top: 140px;
            z-index: 1;
        }

        /* ===== EKRAN STİLLERİ ===== */
        .screen {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(15px);
            margin-bottom: 30px;
            display: none;
            position: relative;
            overflow: hidden;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: var(--transition);
        }

        .screen.active-screen {
            display: block;
            animation: screenSlideIn 0.5s ease forwards;
        }

        @keyframes screenSlideIn {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .screen-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 25px;
            color: white;
            position: relative;
            display: inline-block;
            font-weight: 700;
        }

        .screen-title::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            border-radius: 2px;
        }

        /* ===== AVATAR SEÇİM EKRANI STİLLERİ ===== */
        .avatar-selection-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 10px;
            color: white;
        }

        .avatar-selection-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .current-team-info {
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        .current-team-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .current-player-name {
            font-size: 1.4rem;
            opacity: 0.9;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .avatar-item {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .avatar-item:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .avatar-item.selected {
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(76, 217, 100, 0.5);
            animation: avatarPulse 2s infinite;
        }

        @keyframes avatarPulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 217, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0); }
        }

        .avatar-item.used {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .avatar-used-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            text-align: center;
            padding: 5px;
        }

        .avatar-selection-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .team-ready-btn {
            padding: 15px 30px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .team-ready-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .team-ready-btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }

        .team-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-dots {
            display: flex;
            gap: 8px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .progress-dot.completed {
            background: var(--success);
        }

        .progress-dot.current {
            background: var(--accent);
            transform: scale(1.2);
        }

        /* ===== FLAMA SEÇİM EKRANI STİLLERİ ===== */
        .flag-selection-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 10px;
            color: white;
        }

        .flag-selection-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .flag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .flag-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid transparent;
        }

        .flag-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .flag-item.selected {
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(76, 217, 100, 0.5);
            animation: flagPulse 2s infinite;
        }

        @keyframes flagPulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 217, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0); }
        }

        .flag-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
        }

        .flag-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .flag-selection-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .flag-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .flag-progress-dots {
            display: flex;
            gap: 8px;
        }

        .flag-progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .flag-progress-dot.completed {
            background: var(--success);
        }

        .flag-progress-dot.current {
            background: var(--accent);
            transform: scale(1.2);
        }

        .flag-ready-btn {
            padding: 15px 30px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .flag-ready-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .flag-ready-btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
        }

        /* ===== HAZIR EKRANI STİLLERİ ===== */
        .ready-for-dice-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .ready-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 25px;
        }

        .ready-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ready-teams {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ready-team {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .ready-team:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .ready-team-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .ready-team-players {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ready-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .ready-player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
        }

        .ready-player-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ready-player-name {
            flex: 1;
            text-align: left;
        }

        /* ===== MOBİL OYUN EKRANI STİLLERİ ===== */
        #gameScreen.active-screen {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            min-height: 80vh;
        }

        .game-header-mobile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .game-info-mobile {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            flex: 1;
        }

        .game-info-item-mobile {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
            transition: var(--transition);
        }

        .game-info-label-mobile {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .game-info-value-mobile {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .game-player-avatar-mobile {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
        }

        .game-player-avatar-mobile img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .game-main-content-mobile {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            gap: 15px;
            margin: 15px 0;
        }

        .timer-container-mobile {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 120px;
        }

        .timer-mobile {
            font-size: clamp(2rem, 6vw, 2.8rem);
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', monospace;
            color: white;
            transition: var(--transition);
        }

        .timer-warning {
            color: #ff6b6b !important;
            animation: pulse 1s infinite;
        }

        .pass-info-mobile {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 120px;
        }

        .pass-count-mobile {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }

        .pass-dot-mobile {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .pass-dot-mobile.used {
            background: var(--accent);
            transform: scale(1.1);
        }

        /* ===== KART TASARIMI - MOBİL OPTİMİZE ===== */
        .card-container-mobile {
            perspective: 1200px;
            margin: 15px 0;
            display: flex;
            justify-content: center;
        }

        .card-mobile {
            width: 280px;
            height: 380px;
            border-radius: 18px;
            border: 6px solid var(--card-red);
            box-sizing: border-box;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 12px 10px 8px;
            box-shadow: var(--shadow-lg);
            transform-style: preserve-3d;
            transition: transform 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .card-mobile.flipped {
            transform: rotateY(180deg);
        }

        .card-inner-mobile {
            background: var(--card-red);
            border-radius: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .card-inner-mobile::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .main-word-mobile {
            color: #ffffff;
            font-weight: 800;
            text-align: center;
            font-size: clamp(20px, 5vw, 26px);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            word-break: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            line-height: 1.2;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .forbidden-words-mobile {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .forbidden-word-mobile {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: clamp(12px, 3vw, 14px);
            color: white;
            font-weight: 600;
            backdrop-filter: blur(5px);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            word-break: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            line-height: 1.2;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .forbidden-word-mobile:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .bottom-text-wrapper-mobile {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bottom-text-mobile {
            color: var(--card-red);
            font-weight: 800;
            font-size: 20px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .card-enter {
            animation: cardEnter 0.5s ease forwards;
        }

        .card-exit {
            animation: cardExit 0.5s ease forwards;
        }

        @keyframes cardEnter {
            0% { opacity: 0; transform: scale(0.8) rotateY(-90deg); }
            100% { opacity: 1; transform: scale(1) rotateY(0deg); }
        }

        @keyframes cardExit {
            0% { opacity: 1; transform: scale(1) rotateY(0deg); }
            100% { opacity: 0; transform: scale(1.1) rotateY(90deg); }
        }

        /* ===== KONTROL BUTONLARI - MOBİL ===== */
        .game-controls-mobile {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .control-btn-mobile {
            padding: 14px 12px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            touch-action: manipulation;
        }

        .control-btn-mobile::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .control-btn-mobile:hover::before {
            left: 100%;
        }

        .correct-btn-mobile {
            background: var(--success);
            color: white;
        }

        .pass-btn-mobile {
            background: linear-gradient(135deg, #ff9a3c, #ff6b6b);
            color: white;
        }

        .forbidden-btn-mobile {
            background: linear-gradient(135deg, #d30000, #ff4d4d);
            color: white;
        }

        .pause-btn-mobile {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            grid-column: span 2;
        }

        .control-btn-mobile:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .control-btn-mobile:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .control-btn-mobile:disabled:hover::before {
            left: -100%;
        }

        /* ===== TAKIM SIRASI EKRANI STİLLERİ ===== */
        .turn-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .turn-team-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 15px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .turn-team-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .turn-team {
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            font-weight: bold;
            margin-bottom: 10px;
            padding: 15px 30px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.1);
            display: inline-block;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            color: white;
        }

        .current-player {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: var(--radius);
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== TAKIM AYARLARI STİLLERİ ===== */
        .team-setup {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .team {
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius);
            padding: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .team::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
        }

        .team-1::before {
            background: var(--team1);
        }

        .team-2::before {
            background: var(--team2);
        }

        .team-3::before {
            background: var(--team3);
        }

        .team-4::before {
            background: var(--team4);
        }

        .team:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .team-name {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .remove-team {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .remove-team:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(90deg);
        }

        .team-input {
            width: 100%;
            padding: 14px 18px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            margin-bottom: 18px;
            outline: none;
            transition: var(--transition);
            font-weight: 500;
        }

        .team-input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .team-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .player-count {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .player-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .player-count-display {
            font-size: 1.6rem;
            font-weight: bold;
            min-width: 35px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 10px;
        }

        .player-names {
            margin-top: 20px;
        }

        .player-name-input {
            width: 100%;
            padding: 10px 14px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 0.95rem;
            margin-bottom: 10px;
            outline: none;
            transition: var(--transition);
        }

        .player-name-input:focus {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
        }

        .player-name-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .add-team-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--radius);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 25px;
            font-weight: 600;
        }

        .add-team-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-5px);
        }

        /* ===== BUTON STİLLERİ ===== */
        .btn {
            padding: 16px 35px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            min-width: 180px;
            letter-spacing: 0.5px;
            touch-action: manipulation;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn:disabled:hover::before {
            left: -100%;
        }

        /* ===== OYUN BİLGİLERİ STİLLERİ ===== */
        .game-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .round-info, .team-scores {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
        }

        .info-item {
            text-align: center;
            flex: 1;
            min-width: 120px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .info-label {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .team-score {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .team-score:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .score-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .team1-badge {
            background: var(--team1);
        }

        .team2-badge {
            background: var(--team2);
        }

        .team3-badge {
            background: var(--team3);
        }

        .team4-badge {
            background: var(--team4);
        }

        .pass-info {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 20px;
        }

        .pass-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .pass-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .pass-count {
            display: flex;
            gap: 8px;
        }

        .pass-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .pass-dot.used {
            background: var(--accent);
            transform: scale(1.1);
        }

        .timer-container {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timer {
            font-size: clamp(4rem, 12vw, 6rem);
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', monospace;
            color: white;
            transition: var(--transition);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== TAKIM SIRASI EKRANI TASARIMI ===== */
        .team-turn-screen {
            text-align: center;
            padding: 30px 20px;
        }

        .turn-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 25px;
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .team1-turn {
            color: var(--team1);
            box-shadow: 0 0 30px rgba(255, 154, 60, 0.5);
        }

        .team2-turn {
            color: var(--team2);
            box-shadow: 0 0 30px rgba(0, 180, 219, 0.5);
        }

        .team3-turn {
            color: var(--team3);
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.5);
        }

        .team4-turn {
            color: var(--team4);
            box-shadow: 0 0 30px rgba(46, 204, 113, 0.5);
        }

        .turn-team::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
        }

        .team1-turn::before {
            background: var(--team1);
        }

        .team2-turn::before {
            background: var(--team2);
        }

        .team3-turn::before {
            background: var(--team3);
        }

        .team4-turn::before {
            background: var(--team4);
        }

        .team-stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .team-stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .team-stat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .team-stat-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .team-stat-name {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .team-stat-scores {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .stat-positive {
            color: var(--success);
        }

        .stat-negative {
            color: var(--accent);
        }

        .countdown {
            font-size: clamp(4rem, 12vw, 7rem);
            font-weight: bold;
            margin: 30px 0;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, var(--team1), var(--team2), var(--team3), var(--team4));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== KAZANAN EKRANI STİLLERİ ===== */
        .winner-screen {
            text-align: center;
        }

        .winner-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            margin-bottom: 25px;
            background: linear-gradient(to right, #ff9a3c, #00b4db, #9b59b6, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .winner-team {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 40px;
            padding: 20px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.1);
            display: inline-block;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: winnerPulse 2s infinite;
        }

        @keyframes winnerPulse {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 255, 255, 0.5); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
        }

        .final-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .final-score {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px 15px;
            border-radius: var(--radius);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .final-score:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.15);
        }

        .score-value {
            font-size: clamp(3rem, 7vw, 5rem);
            font-weight: bold;
            line-height: 1;
        }

        .team1-score {
            color: var(--team1);
        }

        .team2-score {
            color: var(--team2);
        }

        .team3-score {
            color: var(--team3);
        }

        .team4-score {
            color: var(--team4);
        }

        .score-label {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-top: 10px;
        }

        .overtime-notice {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            font-size: 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        .rules-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 25px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rules-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .rules-list {
            list-style-type: none;
        }

        .rules-list li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
        }

        .rules-list li:before {
            content: "•";
            color: var(--accent);
            position: absolute;
            left: 0;
            font-size: 1.5rem;
        }

        /* ===== DURAKLATMA EKRANI STİLLERİ ===== */
        .pause-screen {
            text-align: center;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.7) !important;
        }

        .pause-title {
            font-size: clamp(2.2rem, 5vw, 3.5rem);
            margin-bottom: 25px;
        }

        .pause-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 40px;
        }

        .pause-btn {
            padding: 18px 35px;
        }

        /* ===== ZAR EKRANI STİLLERİ ===== */
        .dice-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .dice-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 25px;
        }

        .dice-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .dice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px 15px;
            border-radius: var(--radius);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            min-height: 240px;
        }

        .dice-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
        }

        /* 3D ZAR STİLLERİ */
        .dice-3d-container {
            position: relative;
            perspective: 900px;
            width: var(--dice-size);
            height: var(--dice-size);
        }

        .dice-3d {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.15s linear;
            will-change: transform;
            position: relative;
        }

        .dice-face {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 15%, #ffffff, #e5e7eb 60%, #cbd5f5);
            border-radius: 12px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: 8px;
            box-shadow:
                0 10px 20px rgba(15, 23, 42, 0.5),
                0 0 0 1px rgba(148, 163, 184, 0.4);
        }

        .dice-pip {
            width: var(--pip-size);
            height: var(--pip-size);
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #010409, #111827);
            margin: auto;
            box-shadow: 0 0 0 1px rgba(15,23,42,0.5);
        }

        /* Yüzlerin 3D konumları */
        .dice-face-1 { transform: translateZ(calc(var(--dice-size) / 2)); }
        .dice-face-6 { transform: rotateY(180deg) translateZ(calc(var(--dice-size) / 2)); }
        .dice-face-3 { transform: rotateY(90deg) translateZ(calc(var(--dice-size) / 2)); }
        .dice-face-4 { transform: rotateY(-90deg) translateZ(calc(var(--dice-size) / 2)); }
        .dice-face-5 { transform: rotateX(90deg) translateZ(calc(var(--dice-size) / 2)); }
        .dice-face-2 { transform: rotateX(-90deg) translateZ(calc(var(--dice-size) / 2)); }

        /* Pip dizilimleri */
        .dice-face-1 .dice-pip:nth-child(5) { grid-area: 2 / 2; }

        .dice-face-2 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-2 .dice-pip:nth-child(2) { grid-area: 3 / 3; }

        .dice-face-3 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-3 .dice-pip:nth-child(2) { grid-area: 2 / 2; }
        .dice-face-3 .dice-pip:nth-child(3) { grid-area: 3 / 3; }

        .dice-face-4 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-4 .dice-pip:nth-child(2) { grid-area: 1 / 3; }
        .dice-face-4 .dice-pip:nth-child(3) { grid-area: 3 / 1; }
        .dice-face-4 .dice-pip:nth-child(4) { grid-area: 3 / 3; }

        .dice-face-5 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-5 .dice-pip:nth-child(2) { grid-area: 1 / 3; }
        .dice-face-5 .dice-pip:nth-child(3) { grid-area: 2 / 2; }
        .dice-face-5 .dice-pip:nth-child(4) { grid-area: 3 / 1; }
        .dice-face-5 .dice-pip:nth-child(5) { grid-area: 3 / 3; }

        .dice-face-6 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-6 .dice-pip:nth-child(2) { grid-area: 2 / 1; }
        .dice-face-6 .dice-pip:nth-child(3) { grid-area: 3 / 1; }
        .dice-face-6 .dice-pip:nth-child(4) { grid-area: 1 / 3; }
        .dice-face-6 .dice-pip:nth-child(5) { grid-area: 2 / 3; }
        .dice-face-6 .dice-pip:nth-child(6) { grid-area: 3 / 3; }

        .dice-3d-shadow {
            position: absolute;
            width: calc(var(--dice-size) * 0.9);
            height: 16px;
            background: radial-gradient(circle, rgba(0,0,0,0.4), transparent 65%);
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            filter: blur(2px);
            opacity: 0.7;
            pointer-events: none;
        }

        .dice-team-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .dice-value {
            font-size: 1.4rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 30px;
            min-width: 60px;
            margin-top: 5px;
        }

        .order-list {
            margin: 40px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .order-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        .order-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .order-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .order-team {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .order-dice {
            margin-left: auto;
            font-weight: bold;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 30px;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .stats-table th, .stats-table td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-table th {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        .stats-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .rounds-selector {
            margin: 25px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--radius);
            flex-wrap: wrap;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rounds-input {
            width: 80px;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            outline: none;
            font-weight: 600;
        }

        .rounds-input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .ready-btn {
            position: relative;
            z-index: 10;
            margin-top: 25px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5;
            display: none;
        }

        .dark-overlay.active {
            display: block;
        }

        .dice-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }

        .dice-btn {
            padding: 16px 30px;
        }

        .negative-score {
            color: #ff6b6b;
        }

        /* ===== DEVAM ETME EKRANI STİLLERİ ===== */
        .resume-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .resume-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 25px;
        }

        .resume-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .resume-item {
            margin-bottom: 18px;
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .resume-label {
            font-weight: bold;
        }

        .resume-value {
            font-weight: normal;
        }

        .resume-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .tie-notice {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            font-size: 1.2rem;
            animation: pulse 2s infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tie-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin: 18px 0;
            font-size: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== MODAL STİLLERİ ===== */
        .rules-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .rules-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .rules-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .rules-modal-content {
            position: relative;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: var(--radius-lg);
            padding: 40px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: scale(0.8);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
/* ===== KURALLAR MODALI – SCROLLBAR GİZLE (SCROLL KALSIN) ===== */

.rules-modal-content{
  overflow-y: auto !important;   /* dikey scroll var */
  overflow-x: hidden !important; /* yatay scroll yok */
  max-height: 90vh !important;   /* senin tasarımın bozulmasın */
}

/* Chrome, Edge, Safari */
.rules-modal-content::-webkit-scrollbar{
  width: 0 !important;
  height: 0 !important;
}

/* Firefox */
.rules-modal-content{
  scrollbar-width: none !important;
}

/* iOS / genel: yatay taşmayı kesin engelle */
.rules-modal-body{
  overflow-x: hidden !important;
}

        .rules-modal.active .rules-modal-content {
            transform: scale(1);
        }

        .rules-modal-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .rules-modal-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 15px;
            background: linear-gradient(to right, #ff9a3c, #00b4db, #9b59b6, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .rules-modal-close {
            position: absolute;
            top: -15px;
            right: -15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        .rules-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(90deg);
        }

        .rules-modal-body {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rules-modal-section {
            margin-bottom: 25px;
        }

        .rules-modal-section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: white;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 8px;
            font-weight: 700;
        }

        .rules-modal-list {
            list-style-type: none;
            padding-left: 0;
        }

        .rules-modal-list li {
            margin-bottom: 12px;
            padding-left: 30px;
            position: relative;
        }

        .rules-modal-list li:before {
            content: "•";
            color: var(--accent);
            position: absolute;
            left: 15px;
            font-size: 1.5rem;
        }

        .rules-modal-footer {
            text-align: center;
        }

        .rules-understood-btn {
            padding: 18px 50px;
            font-size: 1.2rem;
            background: linear-gradient(to right, var(--team1), var(--team2));
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .rules-understood-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .rules-understood-btn:hover::before {
            left: 100%;
        }

        .rules-understood-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }

        .rules-understood-btn:active {
            transform: translateY(2px);
        }

        .rules-understood-btn.warning {
            animation: warningPulse 0.5s infinite alternate;
        }

        @keyframes warningPulse {
            from { box-shadow: 0 0 15px rgba(255, 107, 107, 0.7); }
            to { box-shadow: 0 0 25px rgba(255, 107, 107, 0.9); }
        }

/* ===========================
   START ACTIONS (KURALLAR + BAŞLA)
   =========================== */

/* Genel (desktop/tablet) */
.start-actions{
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: nowrap;
  gap: 12px;
  margin-top: 14px;
}

/* Butonların kendi boşluklarını sıfırla */
.start-actions .rules-btn,
.start-actions #startGameBtn{
  margin: 0;
  padding: 0;
  border: 0;
  background: transparent;
  line-height: 0;          /* 🔥 inline kaynaklı boşluğu bitirir */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Görseller net dursun */
.start-actions .rules-img,
.start-actions .start-img{
  display: block;
  margin: 0;
  height: auto;
}

/* Mobil: alt alta + daha derli toplu + boşluklar toparlandı */
@media (max-width: 480px){
  .start-actions{
    flex-direction: column;
    gap: 8px;              /* 🔥 iki buton arası mesafe */
    margin-top: -6px;      /* 🔥 üst boşluğu toparlar (görseldeki büyük boşluğu alır) */
  }

  /* İki buton aynı anda düzenli büyüsün (tek yerden) */
  .start-actions{
    transform: scale(1.10);        /* sadece bunu değiştir */
    transform-origin: top center;
  }

  /* Mobilde boyutlar daha dengeli (ikisi de düzgün hizalanır) */
  .start-actions .rules-img{
    width: min(240px, 82vw);
  }

  .start-actions .start-img{
    width: min(260px, 86vw);
  }
}
@media (max-width: 480px){

  /* Sadece OYUNA BAŞLA */
  .start-actions #startGameBtn{
    margin-top: -80px;   /* 🔼 yukarı alır */
  }

}
@media (max-width: 480px){

  /* Sadece OYUN KURALLARI */
  .start-actions .rules-btn{
    margin-top: -50px;   /* 🔼 yukarı alır */
  }

}




        .rules-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-5px);
        }

        /* ===== EŞİTLİK EKRANI STİLLERİ ===== */
        .tie-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .tie-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 25px;
        }

        .tie-info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tie-teams {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .tie-team {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            min-width: 150px;
        }

        .tie-team:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .tie-team-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tie-team-score {
            font-size: 2rem;
            font-weight: bold;
        }

        .tie-explanation {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            margin: 25px 0;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ===== EFEKT STİLLERİ ===== */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--accent);
            opacity: 0;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ===== MOBİL UYUMLULUK İYİLEŞTİRMELERİ ===== */
        @media (max-width: 767px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 0 10px;
            }
            
            header {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .screen {
                padding: 20px 15px;
            }
            
            .card-mobile {
                width: 260px;
                height: 360px;
            }
            
            .main-word-mobile {
                font-size: 20px;
                min-height: 45px;
            }
            
            .forbidden-word-mobile {
                font-size: 12px;
                padding: 8px 10px;
                min-height: 38px;
            }
            
            .bottom-text-mobile {
                font-size: 18px;
            }
            
            .team-setup {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .team {
                padding: 15px;
            }
            
            .team-input, .player-name-input {
                padding: 12px 15px;
                font-size: 16px;
            }
            
            .game-info {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .round-info, .team-scores {
                flex-direction: column;
                gap: 10px;
            }
            
            .info-item {
                min-width: auto;
                padding: 12px;
            }
            
            .timer {
                font-size: 4rem;
            }
            
            .game-controls-mobile {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            .control-btn-mobile {
                padding: 12px 8px;
                font-size: 0.85rem;
            }
            
            .pause-btn-mobile {
                grid-column: span 2;
            }
            
            .turn-team {
                font-size: 1.8rem;
                padding: 12px 20px;
            }
            
            .turn-team-avatar {
                width: 100px;
                height: 100px;
            }
            
            .current-player {
                font-size: 1.1rem;
                padding: 10px 15px;
            }
            
            .team-stats-container {
                grid-template-columns: 1fr;
            }
            
            .team-stat-scores {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .countdown {
                font-size: 5rem;
            }
            
            .dice-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .dice-3d-container {
                width: 70px;
                height: 70px;
                --dice-size: 70px;
                --pip-size: 6px;
            }
            
            .dice-item {
                min-height: 200px;
                padding: 15px 10px;
            }
            
            .dice-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .dice-btn {
                width: 100%;
            }
            
            .final-scores {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .final-score {
                padding: 20px 10px;
            }
            
            .score-value {
                font-size: 2.5rem;
            }
            
            .rules-modal-content {
                padding: 25px 20px;
                width: 95%;
                max-height: 85vh;
            }
            
            .rules-modal-body {
                padding: 20px 15px;
            }
            
            .pause-options {
                flex-direction: column;
            }
            
            .pause-btn {
                width: 100%;
            }
            
            .resume-options {
                flex-direction: column;
            }
            
            .stats-table {
                font-size: 0.9rem;
            }
            
            .stats-table th, .stats-table td {
                padding: 12px 8px;
            }
            
            #gameScreen {
                padding: 10px;
            }
            
            .game-header-mobile {
                flex-direction: column;
                gap: 8px;
            }
            
            .game-info-mobile {
                gap: 8px;
            }
            
            .game-info-item-mobile {
                min-width: 70px;
                padding: 8px 12px;
            }
            
            .game-info-label-mobile {
                font-size: 0.7rem;
            }
            
            .game-info-value-mobile {
                font-size: 1rem;
            }
            
            .timer-mobile {
                font-size: 2rem;
            }
            
            .pass-info-mobile {
                padding: 8px 12px;
                min-width: 100px;
            }
            
            .card-mobile {
                width: 240px;
                height: 340px;
            }
            
            .main-word-mobile {
                font-size: 18px;
                min-height: 40px;
            }
            
            .forbidden-word-mobile {
                font-size: 11px;
                padding: 6px 8px;
                min-height: 35px;
            }
            
            .game-controls-mobile {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            .control-btn-mobile {
                padding: 10px 6px;
                font-size: 0.8rem;
            }
            
            .pause-btn-mobile {
                grid-column: span 2;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 10px;
            }
            
            .avatar-item {
                width: 80px;
                height: 80px;
            }
            
            .avatar-selection-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .team-ready-btn {
                width: 100%;
            }
            
            .flag-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .flag-image {
                width: 100px;
                height: 100px;
            }
            
            .flag-selection-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .flag-ready-btn {
                width: 100%;
            }
            
            .game-player-avatar-mobile {
                width: 35px;
                height: 35px;
            }
            
            .tie-teams {
                flex-direction: column;
                gap: 15px;
            }
            
            .tie-team {
                min-width: auto;
                padding: 15px;
            }
        }

        @media (min-width: 768px) {
            .screen {
                padding: 40px;
            }
            
            .game-controls-mobile {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .pause-btn-mobile {
                grid-column: span 1;
            }
            
            .pause-options {
                flex-direction: row;
                justify-content: center;
            }
            
            .resume-options {
                flex-direction: row;
                justify-content: center;
            }
            
            .game-info {
                grid-template-columns: 1fr 1fr;
            }
            
            .dice-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .team-setup {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .container {
                padding: 0 20px;
            }
        }

        /* ===== EKSTRA STİLLER ===== */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        .order-team-flag {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .order-flag-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 5px;
        }

        .order-flag-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            font-weight: bold;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        @media (max-width: 767px) {
            .order-item {
                gap: 12px;
                padding: 12px;
            }
            
            .order-team-flag {
                width: 35px;
                height: 35px;
            }
            
            .order-flag-placeholder {
                font-size: 0.7rem;
            }
            
            .order-team {
                font-size: 1rem;
            }
            
            .order-dice {
                font-size: 1rem;
                padding: 6px 12px;
            }
        }

        .team-stat-flag {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .team-stat-flag-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 5px;
        }

        .team-stat-flag-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            font-weight: bold;
        }

        .team-flag-display {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            margin: 0 auto 5px;
        }

        .team-flag-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 3px;
        }

        .team-flag-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.6rem;
            font-weight: bold;
        }

        .pause-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .pause-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .pause-flag {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .pause-flag img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 3px;
        }

        /* Chrome, Edge, Opera, Safari */
        .no-spinner::-webkit-inner-spin-button,
        .no-spinner::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        .no-spinner {
            -moz-appearance: textfield;
        }

        /* ===== EK MOBİL OPTİMİZASYONLARI ===== */
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            header {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .screen {
                padding: 15px 10px;
                margin-bottom: 15px;
            }
            
            .card-mobile {
                width: 240px;
                height: 340px;
                border-width: 4px;
            }
            
            .main-word-mobile {
                font-size: 18px;
                min-height: 40px;
                padding: 6px 10px;
            }
            
            .forbidden-word-mobile {
                font-size: 11px;
                padding: 6px 8px;
                min-height: 35px;
            }
            
            .game-controls-mobile {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
            }
            
            .control-btn-mobile {
                padding: 10px 5px;
                font-size: 0.75rem;
                min-height: 44px;
            }
            
            .pause-btn-mobile {
                grid-column: span 2;
            }
            
            .game-header-mobile {
                flex-direction: column;
                gap: 8px;
            }
            
            .game-info-mobile {
                gap: 6px;
            }
            
            .game-info-item-mobile {
                min-width: 65px;
                padding: 6px 8px;
            }
            
            .timer-mobile {
                font-size: 1.8rem;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
                max-height: 300px;
            }
            
            .avatar-item {
                width: 70px;
                height: 70px;
            }
            
            .flag-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 12px;
                max-height: 300px;
            }
            
            .flag-image {
                width: 80px;
                height: 80px;
            }
            
            .dice-3d-container {
                width: 60px;
                height: 60px;
                --dice-size: 60px;
                --pip-size: 5px;
            }
            
            .dice-item {
                min-height: 180px;
                padding: 12px 8px;
            }
            
            .team-setup {
                gap: 12px;
            }
            
            .team {
                padding: 12px;
            }
            
            .team-input, .player-name-input {
                padding: 10px 12px;
                font-size: 16px;
            }
            
            .btn {
                padding: 14px 25px;
                font-size: 1rem;
                min-width: 160px;
            }
            
            .dice-container {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        /* ===== iOS ÖZEL DÜZELTMELERİ ===== */
        @supports (-webkit-touch-callout: none) {
            .btn, .control-btn-mobile {
                -webkit-appearance: none;
                border-radius: 50px;
            }
            
            input, textarea {
                border-radius: 12px;
            }
            
            .avatar-grid, .flag-grid {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* ===== DOKUNMA HEDEFİ İYİLEŞTİRMELERİ ===== */
        @media (max-width: 767px) {
            .btn, .control-btn-mobile, .avatar-item, .flag-item, 
            .player-btn, .remove-team, .team-input, .player-name-input {
                min-height: 44px;
                min-width: 44px;
            }
            
            .game-controls-mobile .control-btn-mobile {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* ===== YATAY MOD İÇİN İYİLEŞTİRMELER ===== */
        @media (max-height: 500px) and (orientation: landscape) {
            #gameScreen {
                min-height: 100vh;
                padding: 10px;
            }
            
            .game-header-mobile {
                flex-direction: row;
                flex-wrap: nowrap;
                margin-bottom: 10px;
            }
            
            .game-main-content-mobile {
                margin: 10px 0;
            }
            
            .card-mobile {
                width: 220px;
                height: 300px;
            }
            
            .game-controls-mobile {
                margin-top: 10px;
            }
        }

        /* ===== YÜKSEK ÇÖZÜNÜRLÜKLÜ EKRANLAR İÇİN ===== */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .avatar-image, .flag-image, .header-logo {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }

        /* ===== GÜVENLİ ALAN DESTEĞİ ===== */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            
            body {
                padding-top: max(10px, env(safe-area-inset-top));
            }
        }

        /* ===== PERFORMANS İYİLEŞTİRMELERİ ===== */
        .avatar-item, .flag-item, .card-mobile, .btn, .dice-3d {
            will-change: transform;
            transform: translateZ(0);
        }

        .rules-modal-close::before {
            content: "×";
            font-size: 1.8rem;
            line-height: 1;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 767px) {
            input, select, textarea {
                font-size: 16px;
            }
        }

        .control-btn-mobile:active, .btn:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        /* ===== GELİŞMİŞ GERİ SAYIM TASARIMI ===== */
        .turn-countdown {
            font-size: clamp(4rem, 12vw, 8rem);
            font-weight: 800;
            margin: 30px 0;
            text-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.4),
                0 8px 24px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', sans-serif;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 180px;
            height: 180px;
            margin: 30px auto;
            border-radius: 24px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 
                inset 0 0 40px rgba(255, 255, 255, 0.1),
                0 15px 40px rgba(0, 0, 0, 0.25),
                0 0 80px rgba(106, 17, 203, 0.3);
            animation: countdownPulse 1.2s ease-in-out infinite alternate;
            color: white;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .turn-countdown::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border-radius: 28px;
            background: linear-gradient(135deg, var(--team1), var(--team2), var(--team3), var(--team4));
            z-index: -1;
            opacity: 0.6;
            filter: blur(15px);
            animation: countdownRotate 4s linear infinite;
        }

        .turn-countdown::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            right: 3px;
            bottom: 3px;
            border-radius: 21px;
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9));
            z-index: -1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .turn-countdown {
            font-size: clamp(3.5rem, 18vw, 6rem);
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 
                0 3px 10px rgba(0, 0, 0, 0.4),
                0 6px 18px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', sans-serif;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: clamp(120px, 40vw, 160px);
            height: clamp(120px, 40vw, 160px);
            margin: 20px auto;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.18) 0%, rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 
                inset 0 0 30px rgba(255, 255, 255, 0.1),
                0 10px 30px rgba(0, 0, 0, 0.25),
                0 0 60px rgba(106, 17, 203, 0.25);
            animation: countdownPulse 1.5s ease-in-out infinite alternate;
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 10;
        }

        .turn-countdown::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 24px;
            background: linear-gradient(135deg, var(--team1), var(--team2), var(--team3), var(--team4));
            z-index: -1;
            opacity: 0.5;
            filter: blur(8px);
            animation: countdownRotate 6s linear infinite;
        }

        .turn-countdown::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.85), rgba(37, 117, 252, 0.85));
            z-index: -1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.15);
        }

        .turn-countdown {
            font-size: clamp(4rem, 15vw, 7rem);
            font-weight: 800;
            margin: 0 auto;
            text-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.4),
                0 8px 24px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', sans-serif;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: clamp(140px, 35vw, 200px);
            height: clamp(140px, 35vw, 200px);
            border-radius: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 
                inset 0 0 40px rgba(255, 255, 255, 0.1),
                0 12px 35px rgba(0, 0, 0, 0.25),
                0 0 70px rgba(106, 17, 203, 0.3);
            animation: countdownPulse 1.5s ease-in-out infinite alternate;
            color: white;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 10;
            position: relative;
            left: 0;
            right: 0;
            margin-left: auto;
            margin-right: auto;
        }

        .turn-countdown::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--team1), var(--team2), var(--team3), var(--team4));
            z-index: -1;
            opacity: 0.5;
            filter: blur(10px);
            animation: countdownRotate 8s linear infinite;
        }

        .turn-countdown::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 23px;
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9));
            z-index: -1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.2);
        }

        .turn-countdown span {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            text-align: center;
            line-height: 1;
            animation: numberPop 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .turn-countdown.countdown-3 {
            background: linear-gradient(135deg, rgba(255, 154, 60, 0.2), rgba(255, 107, 107, 0.15));
            box-shadow: 
                inset 0 0 40px rgba(255, 154, 60, 0.1),
                0 12px 35px rgba(255, 107, 107, 0.25),
                0 0 70px rgba(255, 154, 60, 0.3);
        }

        .turn-countdown.countdown-2 {
            background: linear-gradient(135deg, rgba(0, 180, 219, 0.2), rgba(155, 89, 182, 0.15));
            box-shadow: 
                inset 0 0 40px rgba(0, 180, 219, 0.1),
                0 12px 35px rgba(155, 89, 182, 0.25),
                0 0 70px rgba(0, 180, 219, 0.3);
        }

        .turn-countdown.countdown-1 {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.15));
            box-shadow: 
                inset 0 0 40px rgba(46, 204, 113, 0.1),
                0 12px 35px rgba(39, 174, 96, 0.25),
                0 0 70px rgba(46, 204, 113, 0.3);
            animation: countdownFinalPulse 0.7s ease-in-out infinite alternate;
        }

        @keyframes countdownPulse {
            0% {
                transform: scale(1) translateY(0);
                box-shadow: 
                    inset 0 0 40px rgba(255, 255, 255, 0.1),
                    0 12px 35px rgba(0, 0, 0, 0.25),
                    0 0 70px rgba(106, 17, 203, 0.3);
            }
            100% {
                transform: scale(1.05) translateY(-5px);
                box-shadow: 
                    inset 0 0 40px rgba(255, 255, 255, 0.12),
                    0 15px 40px rgba(0, 0, 0, 0.3),
                    0 0 80px rgba(106, 17, 203, 0.35);
            }
        }

        @keyframes countdownFinalPulse {
            0% {
                transform: scale(1);
                box-shadow: 
                    inset 0 0 40px rgba(46, 204, 113, 0.1),
                    0 12px 35px rgba(39, 174, 96, 0.25),
                    0 0 70px rgba(46, 204, 113, 0.3);
            }
            100% {
                transform: scale(1.08);
                box-shadow: 
                    inset 0 0 40px rgba(46, 204, 113, 0.12),
                    0 15px 40px rgba(39, 174, 96, 0.3),
                    0 0 85px rgba(46, 204, 113, 0.35);
            }
        }

        @keyframes countdownRotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes numberPop {
            0% {
                transform: scale(0.3) rotate(-180deg);
                opacity: 0;
                filter: blur(10px);
            }
            60% {
                transform: scale(1.1) rotate(5deg);
                opacity: 1;
                filter: blur(0);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: blur(0);
            }
        }

        .countdown-text {
            font-size: clamp(1rem, 4vw, 1.3rem);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin: 15px auto;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.12);
            padding: 10px 24px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 300px;
            line-height: 1.4;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .team-turn-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            padding: 30px 20px;
        }

        .turn-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            text-align: center;
        }

        @media (max-width: 768px) {
            .turn-countdown {
                width: clamp(130px, 40vw, 180px);
                height: clamp(130px, 40vw, 180px);
                border-radius: 22px;
            }
            
            .turn-countdown::before {
                top: -4px;
                left: -4px;
                right: -4px;
                bottom: -4px;
                border-radius: 26px;
            }
            
            .turn-countdown::after {
                top: 2px;
                left: 2px;
                right: 2px;
                bottom: 2px;
                border-radius: 20px;
            }
            
            .team-turn-screen {
                padding: 20px 15px;
                min-height: 50vh;
            }
            
            .turn-team-container {
                gap: 15px;
                margin-bottom: 25px;
            }
            
            .countdown-text {
                padding: 8px 20px;
                margin: 12px auto;
                font-size: clamp(0.9rem, 3.8vw, 1.1rem);
                max-width: 260px;
            }
        }

        @media (max-width: 480px) {
            .turn-countdown {
                width: clamp(120px, 45vw, 160px);
                height: clamp(120px, 45vw, 160px);
                border-radius: 20px;
                font-size: clamp(3.5rem, 16vw, 6rem);
            }
            
            .turn-countdown::before {
                top: -3px;
                left: -3px;
                right: -3px;
                bottom: -3px;
                border-radius: 23px;
            }
            
            .turn-countdown::after {
                top: 1px;
                left: 1px;
                right: 1px;
                bottom: 1px;
                border-radius: 18px;
            }
            
            .team-turn-screen {
                padding: 15px 10px;
                min-height: 45vh;
            }
            
            .turn-team-container {
                gap: 12px;
                margin-bottom: 20px;
            }
            
            .countdown-text {
                padding: 6px 18px;
                margin: 10px auto;
                font-size: clamp(0.85rem, 3.5vw, 1rem);
                max-width: 240px;
            }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            .team-turn-screen {
                padding: 15px 10px;
                min-height: 70vh;
            }
            
            .turn-countdown {
                width: 100px;
                height: 100px;
                font-size: 3.5rem;
                margin: 10px auto;
            }
            
            .countdown-text {
                margin: 8px auto;
                padding: 5px 15px;
                font-size: 0.9rem;
                max-width: 200px;
            }
            
            .turn-team-container {
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .dice-container {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .dice-3d-container {
                width: 50px;
                height: 50px;
                --dice-size: 50px;
                --pip-size: 4px;
            }
        }

        @media (min-width: 1200px) {
            .turn-countdown {
                width: 180px;
                height: 180px;
                font-size: 6rem;
            }
            
            .team-turn-screen {
                min-height: 65vh;
            }
            
            .dice-3d-container {
                width: 100px;
                height: 100px;
                --dice-size: 100px;
                --pip-size: 10px;
            }
        }

        @media (min-width: 1600px) {
            .turn-countdown {
                width: 200px;
                height: 200px;
                font-size: 7rem;
            }
            
            .dice-3d-container {
                width: 120px;
                height: 120px;
                --dice-size: 120px;
                --pip-size: 12px;
            }
        }

        .turn-countdown {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        @media (prefers-reduced-motion: reduce) {
            .turn-countdown {
                animation: none;
            }
            
            .turn-countdown::before {
                animation: none;
            }
            
            .turn-countdown span {
                animation: none;
            }
            
            .dice-3d {
                transition: none;
            }
        }

        @supports (-webkit-touch-callout: none) {
            .turn-countdown {
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }
            
            .countdown-text {
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
            }
            
            .dice-face {
                -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
            }
        }

        @-moz-document url-prefix() {
            .turn-countdown {
                backdrop-filter: blur(12px);
            }
        }

        @media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
            .turn-countdown {
                background: rgba(106, 17, 203, 0.8);
            }
            
            .turn-countdown::before,
            .turn-countdown::after {
                display: none;
            }
        }
		
		/* ===== GÜNCEL 3D ZAR TASARIMI ===== */
        :root {
            --dice-size: 90px;
            --pip-size: 10px;
            --dice-border: 12px;
            --dice-padding: 12px;
        }

        .dice-3d-container {
            position: relative;
            perspective: 1000px;
            width: var(--dice-size);
            height: var(--dice-size);
            margin: 0 auto;
            transform-style: preserve-3d;
        }

        .dice-3d {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            will-change: transform;
            position: relative;
        }

        .dice-face {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border-radius: var(--dice-border);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: var(--dice-padding);
            box-shadow: 
                inset 0 0 0 2px rgba(255, 255, 255, 0.8),
                inset 0 0 20px rgba(0, 0, 0, 0.05),
                0 8px 20px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(0, 0, 0, 0.1);
            backface-visibility: hidden;
            transform-style: preserve-3d;
            border: 2px solid rgba(255, 255, 255, 0.9);
        }

        .dice-pip {
            width: var(--pip-size);
            height: var(--pip-size);
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #1a1a1a, #000000);
            box-shadow: 
                0 0 2px rgba(0, 0, 0, 0.5),
                inset 0 1px 1px rgba(255, 255, 255, 0.2);
            margin: auto;
            position: relative;
        }

        .dice-pip::after {
            content: '';
            position: absolute;
            top: 20%;
            left: 20%;
            width: 30%;
            height: 30%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            filter: blur(0.5px);
        }

        .dice-face::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), transparent);
            border-radius: var(--dice-border) var(--dice-border) 0 0;
            pointer-events: none;
        }

        .dice-face-1 { transform: translateZ(calc(var(--dice-size) / 2)) rotateY(0deg); }
        .dice-face-6 { transform: rotateY(180deg) translateZ(calc(var(--dice-size) / 2)) rotateZ(0deg); }
        .dice-face-3 { transform: rotateY(90deg) translateZ(calc(var(--dice-size) / 2)) rotateZ(0deg); }
        .dice-face-4 { transform: rotateY(-90deg) translateZ(calc(var(--dice-size) / 2)) rotateZ(0deg); }
        .dice-face-5 { transform: rotateX(90deg) translateZ(calc(var(--dice-size) / 2)) rotateZ(0deg); }
        .dice-face-2 { transform: rotateX(-90deg) translateZ(calc(var(--dice-size) / 2)) rotateZ(0deg); }

        .dice-face-1 .dice-pip:nth-child(5) { grid-area: 2 / 2; }

        .dice-face-2 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-2 .dice-pip:nth-child(2) { grid-area: 3 / 3; }

        .dice-face-3 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-3 .dice-pip:nth-child(2) { grid-area: 2 / 2; }
        .dice-face-3 .dice-pip:nth-child(3) { grid-area: 3 / 3; }

        .dice-face-4 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-4 .dice-pip:nth-child(2) { grid-area: 1 / 3; }
        .dice-face-4 .dice-pip:nth-child(3) { grid-area: 3 / 1; }
        .dice-face-4 .dice-pip:nth-child(4) { grid-area: 3 / 3; }

        .dice-face-5 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-5 .dice-pip:nth-child(2) { grid-area: 1 / 3; }
        .dice-face-5 .dice-pip:nth-child(3) { grid-area: 2 / 2; }
        .dice-face-5 .dice-pip:nth-child(4) { grid-area: 3 / 1; }
        .dice-face-5 .dice-pip:nth-child(5) { grid-area: 3 / 3; }

        .dice-face-6 .dice-pip:nth-child(1) { grid-area: 1 / 1; }
        .dice-face-6 .dice-pip:nth-child(2) { grid-area: 2 / 1; }
        .dice-face-6 .dice-pip:nth-child(3) { grid-area: 3 / 1; }
        .dice-face-6 .dice-pip:nth-child(4) { grid-area: 1 / 3; }
        .dice-face-6 .dice-pip:nth-child(5) { grid-area: 2 / 3; }
        .dice-face-6 .dice-pip:nth-child(6) { grid-area: 3 / 3; }

        .dice-3d-shadow {
            position: absolute;
            width: calc(var(--dice-size) * 0.85);
            height: 20px;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.4) 0%, transparent 70%);
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            filter: blur(4px);
            opacity: 0.6;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .dice-3d-container.rolling .dice-3d-shadow {
            width: calc(var(--dice-size) * 0.95);
            height: 25px;
            opacity: 0.8;
            filter: blur(6px);
        }

        .dice-3d.rolling {
            animation: diceRoll 0.8s ease-out;
        }

        @keyframes diceRoll {
            0% { transform: rotateX(0) rotateY(0) rotateZ(0); }
            25% { transform: rotateX(180deg) rotateY(90deg) rotateZ(45deg); }
            50% { transform: rotateX(360deg) rotateY(180deg) rotateZ(90deg); }
            75% { transform: rotateX(540deg) rotateY(270deg) rotateZ(135deg); }
            100% { transform: rotateX(720deg) rotateY(360deg) rotateZ(180deg); }
        }

        .dice-item.team1 .dice-face {
            background: linear-gradient(135deg, #ff9a3c 0%, #ff7a00 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .dice-item.team2 .dice-face {
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .dice-item.team3 .dice-face {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .dice-item.team4 .dice-face {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .dice-value {
            font-size: 1.6rem;
            font-weight: 800;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 50px;
            min-width: 70px;
            margin-top: 10px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .dice-value.final {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(106, 17, 203, 0.4);
        }

        @media (max-width: 767px) {
            :root {
                --dice-size: 70px;
                --pip-size: 8px;
                --dice-border: 10px;
                --dice-padding: 8px;
            }
            
            .dice-value {
                font-size: 1.4rem;
                padding: 8px 15px;
                min-width: 60px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --dice-size: 60px;
                --pip-size: 6px;
                --dice-border: 8px;
                --dice-padding: 6px;
            }
            
            .dice-value {
                font-size: 1.2rem;
                padding: 6px 12px;
                min-width: 50px;
            }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            :root {
                --dice-size: 50px;
                --pip-size: 5px;
                --dice-border: 6px;
                --dice-padding: 4px;
            }
            
            .dice-value {
                font-size: 1rem;
                padding: 4px 10px;
                min-width: 45px;
            }
        }

        @media (prefers-color-scheme: dark) {
            .dice-face {
                background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
                border-color: rgba(255, 255, 255, 0.1);
            }
            
            .dice-pip {
                background: radial-gradient(circle at 30% 30%, #e2e8f0, #cbd5e0);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .dice-3d {
                transition: none;
                animation: none;
            }
            
            .dice-3d-shadow {
                transition: none;
            }
        }

        @supports (-webkit-touch-callout: none) {
            .dice-3d {
                -webkit-transform-style: preserve-3d;
                transform-style: preserve-3d;
            }
            
            .dice-face {
                -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
            }
        }

        /* ===== MOBİL BUTON TAP HIGHLIGHT DÜZELTMESİ ===== */
        @media (max-width: 767px) {
            .control-btn-mobile {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
                tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
            
            .control-btn-mobile:active {
                transform: scale(0.95) !important;
                transition: transform 0.1s ease !important;
            }
            
            .control-btn-mobile i {
                pointer-events: none;
            }
        }
		/* ===== PAUSE EKRANI – ALT BOŞLUK (FLEX STRETCH) DÜZELTME ===== */
@media (min-width: 768px) {
  #pauseScreen .round-info {
    align-items: flex-start; /* stretch kapanır -> kartlar içerik kadar olur */
  }

  /* ekstra garanti: bazı tarayıcılarda tek tek item'a da uygula */
  #pauseScreen .round-info .info-item {
    align-self: flex-start;
  }
}

/* =========================================================
   GLOBAL
   ========================================================= */
*{
  box-sizing: border-box;
}

/* =========================================================
   FOOTER
   ========================================================= */

.site-footer{
  width: 100%;
  margin-top: 10px;
  padding-bottom: 12px;
}

/* ana kapsayıcı */
.footer-inner{
  position: relative;
  overflow: hidden;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 14px 18px;

  background: rgba(255,255,255,0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: var(--shadow);
}

/* üst renk şeridi */
.footer-inner::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:5px;
  background: linear-gradient(
    to right,
    var(--team1),
    var(--team2),
    var(--team3),
    var(--team4)
  );
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* glow */
.footer-glow{
  position:absolute;
  inset:-40%;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,183,3,.25), transparent 55%),
    radial-gradient(circle at 80% 20%, rgba(255,154,60,.2), transparent 55%),
    radial-gradient(circle at 60% 90%, rgba(155,89,182,.18), transparent 60%);
  filter: blur(14px);
  animation: footerGlowMove 12s linear infinite;
  pointer-events:none;
}

/* içerik */
.footer-content{
  position: relative;
  z-index: 2;
  display:flex;
  flex-wrap: nowrap;
  align-items:center;
  justify-content:center;
  gap: 10px;
  row-gap: 2px;
  text-align:center;
}

/* designed by */
.footer-text{
  color: rgba(255,255,255,.85);
  font-size:.95rem;
  font-weight:500;
}

/* Eren İlhan */
.footer-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height:44px;
  padding:8px 12px;

  font-weight:800;
  text-decoration:none;
  position:relative;
  border-radius:12px;

  background: linear-gradient(
    135deg,
    #fff6c2 0%,
    #ffd36a 22%,
    #ffb703 50%,
    #e6a100 78%,
    #fff1a8 100%
  );
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;

  text-shadow:
    0 2px 4px rgba(0,0,0,.55),
    0 0 10px rgba(255,183,3,.35);

  transition: transform .25s ease, text-shadow .25s ease, filter .25s ease;
  touch-action: manipulation;
  user-select:none;
}

.footer-link::after{
  content:"";
  position:absolute;
  left:12%;
  right:12%;
  bottom:-4px;
  height:3px;
  border-radius:999px;
  background: linear-gradient(to right,#fff6c2,#ffb703,#e6a100);
  box-shadow:0 0 8px rgba(255,183,3,.6);
  transform:scaleX(0);
  transition:transform .3s ease;
}

.footer-link:hover{
  transform: translateY(-2px) scale(1.03);
  text-shadow:
    0 4px 8px rgba(0,0,0,.65),
    0 0 18px rgba(255,183,3,.6);
  filter:brightness(1.12);
}
.footer-link:hover::after{ transform:scaleX(1); }
.footer-link:active{ transform:scale(.96); }

/* fix logo */
.footer-fix{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:42px;
  min-height:42px;
  margin-left:6px;
  border-radius:50%;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,183,3,.35);
  backdrop-filter: blur(6px);
  transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
}
.footer-fix img{
  width:20px;
  height:20px;
  transform:scale(3.7);
  pointer-events:none;
}
.footer-fix:hover{
  transform: translateY(-1px);
  background: rgba(255,183,3,.15);
  box-shadow:0 0 10px rgba(255,183,3,.45);
}

/* telif */
.footer-legal{
  width:100%;
  display:block;
  margin-top:-2px;
  font-size:.72rem;
  font-weight:500;
  letter-spacing:.3px;
  color: rgba(255,255,255,.42);
  text-align:center;
  user-select:none;
  opacity:.9;
  transition:opacity .25s ease,color .25s ease;
}
.footer-legal strong{
  color: rgba(255,183,3,.85);
  font-weight:800;
}
.site-footer:hover .footer-legal{
  opacity:1;
  color: rgba(255,255,255,.55);
}

/* sparkles */
.footer-sparkles{
  position:absolute;
  inset:0;
  z-index:1;
  pointer-events:none;
}
.spark{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  background: rgba(255,255,255,.7);
  box-shadow:0 0 12px rgba(255,255,255,.6);
  opacity:.35;
  animation:sparkFloat 4.5s ease-in-out infinite;
}
.spark.s1{ left:12%; top:60%; }
.spark.s2{ left:38%; top:32%; animation-delay:1s; }
.spark.s3{ left:70%; top:65%; animation-delay:2s; }
.spark.s4{ left:88%; top:38%; animation-delay:3s; }

@keyframes footerGlowMove{
  0%{ transform:translateX(-2%) rotate(0deg); }
  50%{ transform:translateX(2%) rotate(180deg); }
  100%{ transform:translateX(-2%) rotate(360deg); }
}
@keyframes sparkFloat{
  0%,100%{ transform:translateY(0) scale(1); opacity:.25; }
  50%{ transform:translateY(-10px) scale(1.15); opacity:.55; }
}

/* =========================================================
   LEAVE MODAL
   ========================================================= */

.leave-modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  background: rgba(20,18,40,.65);
  backdrop-filter: blur(8px);
  z-index:9999;
}
.leave-modal.is-open{ display:flex; }

.leave-box{
  position:relative;
  z-index:2;
  width:100%;
  max-width:420px;
  padding:22px 20px;
  border-radius:22px;
  text-align:center;
  background: linear-gradient(160deg, rgba(130,120,200,.95), rgba(100,90,170,.95));
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 25px 60px rgba(0,0,0,.45);
  animation: leaveModalIn .25s ease-out;
}

/* orbit */
.leave-orbit{
  position:absolute;
  width:520px;
  height:520px;
  border-radius:50%;
  pointer-events:none;
  background: conic-gradient(#ffb703,#ff5ec4,#8a5cff,#00f5d4,#ffb703);
  filter:blur(22px);
  opacity:.65;
  animation: orbitSpin 8s linear infinite;
}
.leave-modal .leave-orbit{
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:0;
}

@keyframes orbitSpin{
  from{ transform:translate(-50%,-50%) rotate(0); }
  to{ transform:translate(-50%,-50%) rotate(360deg); }
}

/* logo */
.leave-logo img{
  width:150px;
  filter:drop-shadow(0 6px 14px rgba(0,0,0,.35));
}

/* metinler */
.leave-warning{
  font-size:1.15rem;
  font-weight:800;
  color:#ffe29a;
  text-shadow:0 2px 8px rgba(255,183,3,.45);
}
.leave-subinfo{
  font-size:.9rem;
  color: rgba(255,255,255,.5);
  margin-top:6px;
}
.leave-subinfo strong{
  color:#ffb703;
  font-weight:800;
  font-size:1.08em;
}

/* butonlar */
.leave-actions{
  display:flex;
  gap:12px;
}
.leave-actions button{
  flex:1;
  height:46px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
}
.leave-cancel{
  background: rgba(255,255,255,.15);
  color:#fff;
}
.leave-confirm{
  background: linear-gradient(135deg,#ffe29a,#ffb703);
  color:#2b2b2b;
}

/* loading */
.leave-status[hidden]{ display:none!important; }
.leave-status{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin:8px 0 18px;
}
.leave-spinner{
  width:18px;
  height:18px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;
  animation: spin .8s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg); } }

@keyframes leaveModalIn{
  from{ opacity:0; transform:translateY(10px) scale(.97); }
  to{ opacity:1; transform:none; }
}

/* scroll kilidi */
body.modal-open{
  overflow:hidden;
  touch-action:none;
}

/* mobil */
@media(max-width:480px){
  .leave-box{ padding:20px 16px; }
  .leave-logo img{ width:130px; }
}


.footer-instagram{
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.footer-instagram{
  display: inline-flex;
  align-items: center;
  gap: 6px;                 /* ikon – yazı arası */
}

/* ================================
   Instagram Icon (Premium & Stabil)
   ================================ */

.ig-icon{
  width: 16px;
  height: 16px;
  object-fit: contain;

  /* Görünüm */
  opacity: 0.88;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.35));

  /* Sadece ikon büyür */
  transform: scale(1.7);
  transform-origin: center;

  /* Akıcı animasyon */
  transition:
    transform .22s cubic-bezier(.4,0,.2,1),
    opacity .22s ease,
    filter .22s ease;

  pointer-events: none; /* link alanını bozmaz */
}

/* Hover – desktop */
.footer-instagram:hover .ig-icon{
  opacity: 1;
  transform: scale(1.6);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.45));
}

/* Active – dokunma hissi */
.footer-instagram:active .ig-icon{
  transform: scale(1.45);
}

/* ================================
   Mobil Optimizasyon
   ================================ */

@media (max-width: 767px){
  .ig-icon{
    width: 18px;
    height: 18px;

    transform: scale(1.55);
  }

  /* mobilde hover yok → stabil kalsın */
  .footer-instagram:hover .ig-icon{
    transform: scale(1.55);
  }
}
.rules-icon{
  width: 22px;
  height: 22px;
  object-fit: contain;
  vertical-align: middle;
  margin-right: 8px;

  transform: scale(4) translateX(1px);   /* 🔥 sadece görsel büyür */
  transform-origin: center;
}
/* ❌ KAPATMA BUTONUNU TAMAMEN TEMİZLE */
.rules-modal-close{
  background: none !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
  border: none !important;
  padding: 0 !important;
}

/* ❌ CSS ile çizilen X varsa ÖLDÜR */
.rules-modal-close::before,
.rules-modal-close::after{
  content: none !important;
  display: none !important;
}

/* ❌ İçindeki font / karakter varsa gizle */
.rules-modal-close{
  font-size: 0 !important;
  color: transparent !important;
}
.rules-close-icon{
  width: 20px;
  height: 20px;
  object-fit: contain;

  transform: scale(6) translateY(7px);
  transform-origin: center;

  filter: drop-shadow(0 2px 6px rgba(0,0,0,.45));
  pointer-events: none;
}


.rules-modal-header{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px 56px 14px 16px;
}

/* SADECE GÖRSEL BÜYÜR (responsive – büyütülmüş) */
/* MOBİL */
.rules-modal-title-image{
  height: 96px;
  width: auto;
  object-fit: contain;
  transform-origin: center;
  transform:
    translateX(-20px)   /* ⬅️ sola */
    translateY(23px)    /* 🔽 aşağı */
    scale(2);
  user-select: none;
  pointer-events: none;
}


/* Tablet */
@media (min-width: 600px){
  .rules-modal-title-image{ transform: scale(2.1); }
}

/* Masaüstü */
@media (min-width: 992px){
  .rules-modal-title-image{
    transform: translateY(20px) scale(2.6); /* 🔽 sadece PC'de aşağı */
  }
}

/* BUTON → TAM ŞEFFAF */
.rules-understood-btn{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* GÖRSEL → BÜYÜK, NET, OPTİMİZE */
.rules-understood-image{
  height: clamp(180px, 22vw, 320px); /* mobil–tablet–PC tek satır */
  width: auto;
  max-width: 100%;
  object-fit: contain;
  display: block;
  pointer-events: none;
  user-select: none;
}

/* SADECE ÇOK BÜYÜK MASAÜSTÜ */
@media (min-width: 1200px){
  .rules-understood-image{
    height: 360px;
  }
}

/* === Kurallar + Başla YAN YANA === */
.start-actions{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;        /* 🔽 masaüstü boşluk azaltıldı */
  margin-top: 18px;
  width: 100%;
  flex-wrap: wrap;
}

/* Oyun Kuralları butonu */
#rulesBtn{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 22px;
  border-radius: 999px;
  white-space: nowrap;
}

/* Kurallar ikonu */
.rules-icon{
  width: 22px;
  height: 22px;
  object-fit: contain;
  flex-shrink: 0;
}

/* Başla PNG butonu */
#startGameBtn{
  background: none;
  box-shadow: none;
  padding: 0;
}

/* Başla görseli (genel) */
.start-img{
  width: clamp(200px, 30vw, 280px);  /* biraz büyüttük */
  height: auto;
  display: block;
  pointer-events: none;
}

/* Hover / basma efektleri */
#startGameBtn:hover .start-img{
  transform: scale(1.05);
  transition: transform .2s ease;
}
#startGameBtn:active .start-img{
  transform: scale(0.97);
}

/* Mobil ayar (daha büyük + daha iyi tıklanabilir) */
@media (max-width: 480px){
  .start-actions{
    flex-direction: column;
    gap: 6px !important;   /* 🔥 mobilde boşluk ciddi azaltıldı */
    margin-top: 10px;
  }

  /* Kurallar butonu mobilde biraz genişleyip rahat tıklansın */
  #rulesBtn{
    padding: 12px 18px;
    font-size: 1rem;
  }

  /* Başla görseli mobilde büyük dursun */
  .start-img{
    width: min(320px, 88vw);  /* 🔥 mobilde büyüdü */
  }
}


/* Kurallar + Başla */
.start-actions{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;          /* aradaki mesafe */
  width: 100%;
  margin-top: 14px;
  flex-wrap: wrap; /* ASLA alt alta düşmesin */
}

/* Butonlar */
.rules-btn,
#startGameBtn.btn{
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Görseller – responsive küçülme */
.rules-img{
  width: clamp(110px, 36vw, 180px);
  height: auto;
  max-width: 100%;
}

.start-img{
  width: clamp(130px, 40vw, 210px);
  height: auto;
  max-width: 100%;
}

/* Çok küçük ekran güvenliği */
@media (max-width: 320px){
  .rules-img{
    width: 48vw;
  }
  .start-img{
    width: 52vw;
  }
}
/* Varsayılan: mobil & tablet normal */
.rules-btn img,
#startGameBtn .start-img{
  transform: scale(1);
  transform-origin: center;
}

/* SADECE bilgisayarda büyüt */
@media (min-width: 1024px){
  .rules-btn img{
    transform: scale(1.4);   /* %20 büyüme */
  }

  #startGameBtn .start-img{
    transform: scale(1.2);
  }
}

/* === MOLA (PAUSE) EKRANI – AYARLI === */

#pauseScreen {
    /* 🔧 GENEL BOŞLUKLAR (İSTEĞE BAĞLI) */
    --pause-padding-top: 10px;        /* tüm pause ekranının üst boşluğu */
    --pause-padding-bottom: 26px;     /* tüm pause ekranının alt boşluğu */

    /* 🖼️ MOLA GÖRSELİ AYARLARI */
    --mola-image-scale: 2;            /* 🔍 1 = normal | 1.1 = %10 büyük | 0.9 = küçük */
    --mola-image-offset-y: 65px;       /* ⬆️ - değer yukarı | + değer aşağı */

    --mola-image-width-desktop: 240px;/* masaüstü temel genişlik */
    --mola-image-width-mobile: 200px; /* mobil temel genişlik */

    /* 📐 DİĞER BOŞLUK AYARLARI */
    --pause-title-offset: -14px;      /* mola alanını yukarı/aşağı alır */
    --pause-title-gap: 6px;           /* mola görseli ile alt yazı arası */

    --pause-info-gap: 10px;            /* açıklama yazısı alt boşluğu */
    --pause-content-gap-desktop: 10px; /* içerik üst boşluğu (desktop) */
    --pause-content-gap-mobile: 6px;   /* içerik üst boşluğu (mobil) */
}

/* Ana kapsayıcı */
#pauseScreen .pause-screen {
    padding-top: var(--pause-padding-top);
    padding-bottom: var(--pause-padding-bottom);
}

/* Mola başlığı (görselin kapsayıcısı) */
#pauseScreen .pause-title {
    margin: var(--pause-title-offset) 0 var(--pause-title-gap);
}

/* 🖼️ MOLA GÖRSELİ – SADECE KENDİ İÇİNDE KONTROL */
#pauseScreen .mola-image {
    display: block;
    margin: 0 auto;
    width: var(--mola-image-width-desktop); /* temel boyut */
    max-width: 70%;
    height: auto;

    /* 🔧 ASIL OYNAMALIK KISIM */
    transform:
        translateY(var(--mola-image-offset-y)) /* yukarı / aşağı */
        scale(var(--mola-image-scale));         /* büyüt / küçült */

    transform-origin: center; /* sadece kendi merkezinden büyür */
}

/* Açıklama yazısı */
#pauseScreen .pause-info-text {
    margin: 0 0 var(--pause-info-gap);
    font-size: 0.95rem;
    opacity: 0.9;
}

/* İçerik alanı */
#pauseScreen .pause-game-info {
    margin-top: var(--pause-content-gap-desktop);
}

/* === MOBİL === */
@media (max-width: 768px) {
    #pauseScreen .mola-image {
        width: var(--mola-image-width-mobile);
        max-width: 75%;
    }

    #pauseScreen .pause-game-info {
        margin-top: var(--pause-content-gap-mobile);
    }
}


/* ============================
   ANLATMAYA HAZIR TAKIM (DESKTOP FIX)
   Mobil aynı kalır, sadece PC'de güzelleşir
   ============================ */
@media (min-width: 1024px){

  /* ekranın içini genişlet */
  #teamTurnScreen .team-turn-screen{
    max-width: 980px;     /* 🔧 genişlik (850-1100 arası deneyebilirsin) */
    margin: 0 auto;
    padding: 40px 60px;
  }

  /* üst bölüm (avatar + takım adı + oyuncu) biraz daha ferah */
  #teamTurnScreen .turn-team-container{
    gap: 16px;
    margin-bottom: 26px;
  }

  /* alttaki takım skor kartlarını 2 sütun yap */
  #teamTurnScreen .team-stats-container{
    grid-template-columns: repeat(2, minmax(260px, 1fr)); /* ✅ 2 kolon */
    gap: 22px;
    width: 100%;
    max-width: 760px;     /* 🔧 kart bloğu genişliği */
    margin: 0 auto 22px;
  }

  /* kartları biraz büyüt (daha “dolgun” dursun) */
  #teamTurnScreen .team-stat-card{
    padding: 22px;
    border-radius: 18px;
  }
}

@media (max-width: 767px){

  /* Winner ekranı genel */
  #winnerScreen{
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: 14px 12px 18px;
  }

  /* Tabloyu kart gibi göster */
  #winnerScreen .stats-table{
    display: block;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;

    background: rgba(255,255,255,0.06);   /* 🔥 sade cam efekti */
    backdrop-filter: blur(6px);
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  }

  /* Tablo iç genişliği */
  #winnerScreen .stats-table table{
    min-width: 520px;   /* yatay scroll tetiklenir */
    width: 100%;
    border-collapse: collapse;
  }

  /* Başlık satırı */
  #winnerScreen .stats-table thead th{
    position: sticky;
    top: 0;
    background: rgba(255,255,255,0.12);
    font-weight: 600;
    font-size: 0.85rem;
    letter-spacing: .3px;
  }

  /* Hücreler */
  #winnerScreen .stats-table th,
  #winnerScreen .stats-table td{
    padding: 10px 12px;
    text-align: center;
    white-space: nowrap;
    color: #fff;
  }

  /* Zebra satır (çok hafif) */
  #winnerScreen .stats-table tbody tr:nth-child(even){
    background: rgba(255,255,255,0.04);
  }

  /* Kazanan takım satırı */
  #winnerScreen .stats-table tbody tr.winner{
    background: linear-gradient(
      90deg,
      rgba(106,17,203,0.35),
      rgba(37,117,252,0.35)
    );
    font-weight: 600;
  }
}
/* ===== Toplam Tur Sayısı (siteyle uyumlu, geniş kutu YOK) ===== */
.rounds-selector{
  margin-top: 16px;

  /* 🔥 kırmızıyla işaretlediğin geniş alanı kaldırır */
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
  box-shadow: none !important;

  /* ortada dursun */
  display: flex;
  justify-content: center;
  align-items: center;
}

.rounds-row{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 16px;

  /* artık tek kutu bu olsun */
  padding: 14px 16px;
  border-radius: 22px;

  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.rounds-label{
  font-family: 'Poppins', sans-serif;
  font-weight: 800;
  font-size: .98rem;
  color: rgba(255,255,255,0.92);
  letter-spacing: .2px;
  opacity: .95;
}

/* küçük, “+/– balonları” gibi */
.rounds-picker{
  display:flex;
  align-items:center;
  gap: 10px;

  padding: 8px 10px;
  border-radius: 18px;

  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
}

.rounds-pill{
  width: 40px;
  height: 40px;
  border-radius: 14px;

  display:flex;
  align-items:center;
  justify-content:center;

  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.90);

  font-family: 'Poppins', sans-serif;
  font-weight: 900;
  font-size: 1rem;

  cursor:pointer;
  user-select:none;
  transition: transform .16s ease, background .16s ease, box-shadow .16s ease, border-color .16s ease, opacity .16s ease;
}

.rounds-pill:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.22);
}

.rounds-pill:active{
  transform: translateY(0) scale(0.98);
}

.rounds-pill.is-active{
  background: linear-gradient(135deg, rgba(255,154,60,0.32), rgba(0,180,219,0.22));
  border-color: rgba(255,255,255,0.26);
  box-shadow:
    0 12px 26px rgba(0,0,0,0.20),
    0 0 0 2px rgba(255,255,255,0.10) inset,
    0 0 18px rgba(0,180,219,0.18);
}

/* Mobilde daha kompakt */
@media (max-width: 520px){
  .rounds-row{ gap: 12px; padding: 12px 12px; }
  .rounds-label{ font-size: .92rem; }
  .rounds-pill{ width: 38px; height: 38px; border-radius: 13px; }
}
@media (max-width: 360px){
  .rounds-row{
    flex-wrap: wrap;
    justify-content: center;
  }
}

.dice-ready-btn{
  padding: 0 !important;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

.dice-ready-img{
  width: clamp(220px, 55vw, 420px);
  height: auto;
  display: block;
  user-select: none;
  pointer-events: none;
}

/* Hover hissi */
.dice-ready-btn:hover .dice-ready-img{
  transform: scale(1.05);
}

.dice-ready-btn:active .dice-ready-img{
  transform: scale(0.98);
}
/* =========================================
   ZARLARI AT (zarat.png) - TEK ve SAĞLAM (OPTİMİZE)
   ========================================= */

#rollDiceBtn{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  min-width: unset !important;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;

  /* 🔥 taşmayı engelle */
  max-width: 100%;
}

/* Görsel: hem mobil hem PC düzgün ölçek */
#rollDiceBtn .dice-btn-img{
  width: clamp(220px, 28vw, 360px);
  height: auto;
  display: block;
  margin: 0 auto;

  user-select: none;
  pointer-events: none;
  transform: translateZ(0);

  /* 🔥 görünüm bozulmasın */
  max-width: 100%;
  object-fit: contain;
}

/* Hover / Active hissi */
#rollDiceBtn:hover .dice-btn-img{
  transform: scale(1.04);
  transition: transform .18s ease;
}
#rollDiceBtn:active .dice-btn-img{
  transform: scale(.97);
}

/* Mobilde: büyük ama taşmadan sığsın */
@media (max-width: 480px){
  #rollDiceBtn .dice-btn-img{
    width: min(320px, 92vw) !important;  /* ✅ 420 -> 320 */
  }
}

/* Çok küçük ekran güvenliği */
@media (max-width: 360px){
  #rollDiceBtn .dice-btn-img{
    width: min(300px, 90vw) !important;
  }
}

/* =========================================
   HADI BAŞLAYALIM (hadibasla.png)
   ========================================= */

#startAfterDiceBtn{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;

  display: flex;
  justify-content: center;
  align-items: center;

  margin: 28px auto 0; /* ortada dursun */
}

/* Görsel */
#startAfterDiceBtn .start-after-dice-img{
  width: clamp(220px, 30vw, 360px);
  height: auto;
  display: block;

  user-select: none;
  pointer-events: none; /* tıklama butonda kalsın */
}

/* Hover / Active hissi */
#startAfterDiceBtn:hover .start-after-dice-img{
  transform: scale(1.04);
  transition: transform .18s ease;
}
#startAfterDiceBtn:active .start-after-dice-img{
  transform: scale(.97);
}

/* 📱 Mobil optimizasyon */
@media (max-width: 480px){
  #startAfterDiceBtn .start-after-dice-img{
    width: min(320px, 90vw);
  }
}

@media (max-width: 360px){
  #startAfterDiceBtn .start-after-dice-img{
    width: min(300px, 88vw);
  }
}


    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <header>
            <h1 class="visually-hidden">TabulaGo</h1>
            <div class="header-logo-wrapper">
                <img src="logo.png" alt="TabulaGo" class="header-logo">
            </div>
            <p class="subtitle">Takımını Kur, Kelimeleri Anlat, Kazan!</p>
        </header>
        
        <!-- ===== EKRANLAR ===== -->
        
        <!-- Devam Etme Ekranı -->
        <div class="screen" id="resumeScreen">
            <div class="resume-screen">
                <h2 class="resume-title">Kaldığın Yerden Devam Et</h2>
                <div class="resume-info" id="resumeInfo"></div>
                <div class="resume-options">
                    <button class="btn" id="resumeGameBtn"><i class="fas fa-play-circle"></i> Devam Et</button>
                    <button class="btn" id="newGameBtn"><i class="fas fa-plus-circle"></i> Yeni Oyun</button>
                </div>
            </div>
        </div>
        
<!-- Takım Kurma Ekranı -->
<div class="screen active-screen" id="teamSetupScreen">
    <h2 class="screen-title">Takımlarını Oluştur</h2>
    <div class="team-setup" id="teamsContainer"></div>

    <button class="add-team-btn" id="addTeamBtn">
        <i class="fas fa-plus"></i><span>Takım Ekle</span>
    </button>

<div class="rounds-selector">
  <div class="rounds-row" role="group" aria-label="Toplam tur sayısı seçimi">
    <div class="rounds-label">Toplam Tur Sayısı</div>

    <div class="rounds-picker" aria-label="Tur seçimi">
      <button type="button" class="rounds-pill" data-round="1" aria-pressed="false">1</button>
      <button type="button" class="rounds-pill" data-round="2" aria-pressed="false">2</button>
      <button type="button" class="rounds-pill" data-round="3" aria-pressed="false">3</button>
    </div>
  </div>

  <!-- Sistem aynı kalsın -->
  <input type="number" id="totalRounds" min="1" max="3" value="3" hidden>
</div>



    <!-- Kurallar + Başla (yan yana) -->
    <div class="start-actions">
<button class="rules-btn" id="rulesBtn">
    <img src="kurallar.png" alt="Oyun Kuralları" class="rules-img">
</button>

        <button class="btn" id="startGameBtn">
            <img src="basla.png" alt="Oyuna Başla" class="start-img">
        </button>
    </div>
</div>

        
        <!-- Avatar Seçim Ekranı -->
        <div class="screen" id="avatarSelectionScreen">
            <h2 class="avatar-selection-title">Avatar Seçimi</h2>
            <p class="avatar-selection-subtitle">Her oyuncu kendine bir avatar seçsin!</p>
            <div class="current-team-info">
                <div class="current-team-name" id="currentTeamName">Takım 1</div>
                <div class="current-player-name" id="currentPlayerName">Oyuncu 1</div>
            </div>
            <div class="avatar-grid" id="avatarGrid"></div>
            <div class="avatar-selection-controls">
                <div class="team-progress">
                    <div class="progress-dots" id="teamProgressDots"></div>
                    <span id="progressText">0/3 oyuncu tamamlandı</span>
                </div>
                <button class="team-ready-btn" id="teamReadyBtn" disabled>
                    <i class="fas fa-check-circle"></i> Devam Et
                </button>
            </div>
        </div>
        
        <!-- Flama Seçim Ekranı -->
        <div class="screen" id="flagSelectionScreen">
            <h2 class="flag-selection-title">Flamalarımızı Seçelim!</h2>
            <p class="flag-selection-subtitle">Her takım kendine bir flama seçsin!</p>
            <div class="current-team-info">
                <div class="current-team-name" id="currentFlagTeamName">Takım 1</div>
            </div>
            <div class="flag-grid" id="flagGrid"></div>
            <div class="flag-selection-controls">
                <div class="flag-progress">
                    <div class="flag-progress-dots" id="flagProgressDots"></div>
                    <span id="flagProgressText">0/2 takım tamamlandı</span>
                </div>
                <button class="flag-ready-btn" id="flagReadyBtn" disabled>
                    <i class="fas fa-check-circle"></i> Devam Et
                </button>
            </div>
        </div>
        
<!-- Zar Atmaya Hazır Ekranı -->
<div class="screen" id="readyForDiceScreen">
    <div class="ready-for-dice-screen">
        <h2 class="ready-title">Herkes Hazır!</h2>
        <div class="ready-info">
            <p>Tüm takımlar avatar ve flama seçimini tamamladı. Zar atarak oyun sırasını belirleyelim!</p>
        </div>
        <div class="ready-teams" id="readyTeams"></div>

        <button class="btn dice-ready-btn" id="goToDiceBtn" aria-label="Zar atmaya hazırız">
            <img src="zarhazir.png" alt="Zar Atmaya Hazırız" class="dice-ready-img">
        </button>
    </div>
</div>

        
<!-- Zar Atma Ekranı -->
<div class="screen" id="diceScreen">
  <div class="dice-screen">
    <h2 class="dice-title">Sıra Belirleme</h2>

    <p class="dice-subtitle">
      Tüm takımlar zar atsın! En yüksek atan başlayacak.
    </p>

    <div id="tieInfoContainer"></div>

    <div class="dice-container" id="diceContainer"></div>

<div class="dice-controls">
  <button class="btn dice-btn dice-image-btn" id="rollDiceBtn" aria-label="Zarları At"></button>

</div>


    <div class="order-list" id="orderList" hidden>
      <h3 class="order-title">Oyun Sırası</h3>
    </div>

<button class="btn start-after-dice-btn" id="startAfterDiceBtn" hidden aria-label="Hadi Başlayalım">
  <img src="hadibasla.png" alt="Hadi Başlayalım" class="start-after-dice-img">
</button>
  </div>
</div>

        
        <!-- Takım Sırası Ekranı -->
        <div class="screen" id="teamTurnScreen">
            <div class="team-turn-screen">
                <h2 class="turn-title">Anlatmaya Hazır Takım</h2>
                <div class="turn-team-container">
                    <div class="turn-team-avatar" id="turnTeamAvatar">
                        <div class="avatar-placeholder">?</div>
                    </div>
                    <div class="turn-team" id="turnTeamName">Takım 1</div>
                    <div class="current-player" id="turnCurrentPlayer">Anlatacak Oyuncu: Oyuncu 1</div>
                </div>
                <div class="team-stats-container" id="teamStatsContainer"></div>
                <div class="turn-countdown" id="turnCountdown">3</div>
                <button class="btn btn-primary" id="readyBtn"><i class="fas fa-play"></i> Hazırım!</button>
            </div>
        </div>
        
        <!-- Oyun Ekranı - Mobil Optimize -->
        <div class="screen" id="gameScreen">
            <div class="game-header-mobile">
                <div class="game-info-mobile">
                    <div class="game-info-item-mobile">
                        <div class="game-info-label-mobile">Tur</div>
                        <div class="game-info-value-mobile" id="currentRoundDisplay">1/10</div>
                    </div>
                    <div class="game-info-item-mobile">
                        <div class="game-info-label-mobile">Takım</div>
                        <div class="game-info-value-mobile" id="currentTeamDisplay">Takım 1</div>
                        <div class="team-flag-display" id="currentTeamFlag">
                            <div class="team-flag-placeholder">?</div>
                        </div>
                    </div>
                    <div class="game-info-item-mobile">
                        <div class="game-info-label-mobile">Anlatıcı</div>
                        <div class="game-info-value-mobile" id="currentPlayerDisplay">Oyuncu 1</div>
                        <div class="game-player-avatar-mobile" id="currentPlayerAvatar">
                            <div class="avatar-placeholder">?</div>
                        </div>
                    </div>
                </div>
                <div class="game-info-mobile">
                    <div class="timer-container-mobile">
                        <div class="timer-mobile" id="timer">60</div>
                        <div class="info-label">Kalan Süre</div>
                    </div>
                    <div class="pass-info-mobile">
                        <div class="info-label" id="currentTeamPassLabel">Pas Hakkı</div>
                        <div class="pass-count-mobile" id="currentTeamPassCount">
                            <div class="pass-dot-mobile"></div>
                            <div class="pass-dot-mobile"></div>
                            <div class="pass-dot-mobile"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="game-main-content-mobile">
                <div class="card-container-mobile">
                    <div class="card-mobile" id="gameCard">
                        <div class="card-inner-mobile">
                            <div class="main-word-mobile" id="mainWord">YÜKSEK</div>
                            <div class="forbidden-words-mobile">
                                <div class="forbidden-word-mobile" id="forbiddenWord1">DAĞ</div>
                                <div class="forbidden-word-mobile" id="forbiddenWord2">UZUN</div>
                                <div class="forbidden-word-mobile" id="forbiddenWord3">BİNA</div>
                                <div class="forbidden-word-mobile" id="forbiddenWord4">TEPE</div>
                            </div>
                        </div>
                        <div class="bottom-text-wrapper-mobile">
                            <div class="bottom-text-mobile">TabulaGo</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="game-controls-mobile">
                <button class="control-btn-mobile correct-btn-mobile" id="correctBtn">
                    <i class="fas fa-check"></i> Doğru (+1)
                </button>
                <button class="control-btn-mobile pass-btn-mobile" id="passBtn">
                    <i class="fas fa-forward"></i> Pas (Kalan: <span id="passCount">3</span>)
                </button>
                <button class="control-btn-mobile forbidden-btn-mobile" id="forbiddenBtn">
                    <i class="fas fa-times"></i> Yasak (-1)
                </button>
                <button class="control-btn-mobile pause-btn-mobile" id="pauseBtn">
                    <i class="fas fa-pause"></i> Duraklat
                </button>
            </div>
        </div>
        
<!-- Duraklatma Ekranı -->
<div class="screen" id="pauseScreen">
    <div class="pause-screen">

        <!-- MOLA GÖRSELİ -->
        <div class="pause-title">
            <img src="mola.png" alt="Mola" class="mola-image">
        </div>

        <div class="info-label pause-info-text">
            MOLADASINIZ! Ne zaman isterseniz kaldığınız yerden devam edebilirsiniz.
        </div>

        <div class="game-info pause-game-info">
            <div class="round-info">
                <div class="info-item">
                    <div class="info-label">Tur</div>
                    <div class="info-value" id="pauseCurrentRound">1/10</div>
                </div>

                <div class="info-item">
                    <div class="info-label">Anlatan Takım</div>
                    <div class="info-value" id="pauseCurrentTeam">Takım 1</div>
                    <div class="pause-flag" id="pauseTeamFlag">
                        <div class="team-flag-placeholder">?</div>
                    </div>
                </div>

                <div class="info-item">
                    <div class="info-label">Anlatıcı</div>
                    <div class="info-value" id="pauseCurrentPlayer">Oyuncu 1</div>
                    <div class="pause-avatar" id="pausePlayerAvatar">
                        <div class="avatar-placeholder">?</div>
                    </div>
                </div>
            </div>

            <div class="team-scores" id="pauseTeamScores"></div>
        </div>

        <div class="pause-options">
            <button class="btn pause-btn" id="resumeBtn">
                <i class="fas fa-play"></i> Devam Et
            </button>
            <button class="btn pause-btn" id="quitBtn">
                <i class="fas fa-sign-out-alt"></i> Oyundan Çık
            </button>
        </div>

    </div>
</div>

        
        <!-- Eşitlik Ekranı -->
        <div class="screen" id="tieScreen">
            <div class="tie-screen">
                <h2 class="tie-title">Eşitlik Var!</h2>
                <div class="tie-info-box">
                    <p>Normal turlar tamamlandı, ancak bazı takımlar eşit puanda!</p>
                    <p>Eşit puana sahip takımlar 1 tur daha oynayacak.</p>
                </div>
                <div class="tie-teams" id="tieTeams"></div>
                <div class="tie-explanation" id="tieExplanation"></div>
                <button class="btn" id="continueTieBtn"><i class="fas fa-play"></i> Oyuna Devam Et</button>
            </div>
        </div>
        
        <!-- Kazanan Ekranı -->
        <div class="screen" id="winnerScreen">
            <h2 class="winner-title">Oyun Bitti!</h2>
            <div class="winner-team" id="winnerTeamName">Takım 1 Kazandı!</div>
            <div class="final-scores" id="finalScores"></div>
            <div class="stats-table-container" id="statsTableContainer"></div>
            <div class="game-controls" style="margin-top: 30px;">
                <button class="btn" id="playAgainBtn"><i class="fas fa-redo"></i> Yeni Oyun</button>
                <button class="btn" id="mainMenuBtn"><i class="fas fa-home"></i> Ana Menü</button>
            </div>
        </div>
    </div>

<!-- Kurallar Modal -->
<div class="rules-modal" id="rulesModal">
  <div class="rules-modal-backdrop" id="rulesModalBackdrop"></div>

  <div class="rules-modal-content">
<div class="rules-modal-header">
  <img
    src="kural.png"
    alt="TabulaGo Oyun Kuralları"
    class="rules-modal-title-image"
    draggable="false"
  >

  <button class="rules-modal-close" id="rulesModalClose" aria-label="Kuralları Kapat">
    <img src="bilgi.png" alt="Bilgi" class="rules-close-icon">
  </button>
</div>


    <div class="rules-modal-body">
      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Genel Kurallar</h3>
        <ul class="rules-modal-list">
          <li><strong>TabulaGo</strong>, takımlar halinde oynanan bir kelime anlatma oyunudur.</li>
          <li>Amaç, takımınıza kelimeleri doğru anlattırarak <strong>en yüksek puanı</strong> toplamaktır.</li>
          <li>Takımlar <strong>en az 2</strong>, <strong>en fazla 4</strong> adet olabilir.</li>
          <li>Her takımda <strong>1–5 oyuncu</strong> bulunabilir.</li>
          <li>Oyun sırası, başta yapılan <strong>zar atışı</strong> ile belirlenir.</li>
          <li>Her anlatım turu <strong>60 saniyedir</strong>.</li>
          <li>Süre bittiğinde tur <strong>otomatik</strong> olarak sona erer ve sıradaki takıma geçilir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Tur Yapısı</h3>
        <ul class="rules-modal-list">
          <li>Oyun, seçilen <strong>tur sayısı</strong> (round) kadar oynanır.</li>
          <li><strong>1 tur</strong>, sadece “her takımın 1 kez oynaması” değildir.</li>
          <li>Her tur, takımlar arasındaki oyuncu sayısına göre oluşan <strong>anlatıcı slotlarından</strong> oluşur.</li>
          <li>Bir turda oluşan slot sayısı, takımlar içindeki <strong>en yüksek oyuncu sayısına</strong> göre belirlenir.</li>
          <li>Her slotta tüm takımlar sırayla oynar; yani bir tur içinde her takım birden fazla kez sıraya girer.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Anlatıcı ve Oyuncu Dengesi</h3>
        <ul class="rules-modal-list">
          <li>Oyuncular takım içinde sırayla <strong>anlatıcı</strong> olur.</li>
          <li>Takımların oyuncu sayıları farklıysa, az oyunculu takımda eksik slotlar oluşabilir.</li>
          <li>Eksik slotlarda ekranda <strong>“OYUNCU X”</strong> görünebilir; bu durumda anlatıcı, takım içinden <strong>rastgele</strong> seçilir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Anlatım Kuralları</h3>
        <ul class="rules-modal-list">
          <li>Anlatıcı, karttaki <strong>ana kelimeyi söylemeden</strong> takımına anlatmaya çalışır.</li>
          <li>Kartta yazan <strong>yasaklı kelimeler</strong> kesinlikle kullanılmamalıdır.</li>
          <li>Anlatıcı, anlatım sırasında <strong>jest ve mimik</strong> kullanabilir.</li>
          <li>Anlatıcı, ana kelimenin <strong>hecelerini</strong> veya <strong>harflerini</strong> söyleyemez.</li>
          <li>Aynı tur içinde anlatım sırasında kelime biterse, sistem otomatik olarak <strong>yeni kelime</strong> getirir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Puanlama Sistemi</h3>
        <ul class="rules-modal-list">
          <li>Doğru tahmin edilen her kelime için <strong>+1</strong> puan</li>
          <li>Yasaklı kelime kullanıldığında <strong>-1</strong> puan (<strong>eksi puan mümkündür</strong>)</li>
          <li>Pas kullanımı puan değiştirmez, sadece pas hakkını düşürür.</li>
          <li>Belirlenen tur sayısı sonunda en çok puanı alan takım kazanır.</li>
          <li>Skor mantığı <strong>Net = Doğru - Yasak</strong> şeklindedir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Pas Hakkı</h3>
        <ul class="rules-modal-list">
          <li>Her takım, <strong>kendi anlatım turuna</strong> başlarken <strong>3 pas</strong> hakkıyla başlar.</li>
          <li>Pas kullanıldığında mevcut kelime geçilir ve <strong>yeni bir kelime</strong> gelir.</li>
          <li>Pas hakkı bitince takım mevcut kelimeyi anlatmaya devam etmek zorundadır.</li>
          <li>Yeni anlatım turu başladığında pas hakkı tekrar <strong>3</strong> olarak yenilenir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Zar ve Sıralama</h3>
        <ul class="rules-modal-list">
          <li>Başlangıçta tüm takımlar zar atar ve oyun sırası belirlenir.</li>
          <li>Eşit zar gelirse, sadece <strong>eşit atan takımlar</strong> tekrar zar atar.</li>
          <li>Eşitlik bozulana kadar tekrar zar atışı devam eder.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Eşitlik Durumu (Uzatma)</h3>
        <ul class="rules-modal-list">
          <li>Normal oyun sonunda eşit puanlı takımlar varsa, <strong>eşitlik ekranı</strong> gösterilir.</li>
          <li>Yalnızca <strong>eşit puana sahip takımlar</strong> uzatma oynar; diğer takımların sıralaması korunur.</li>
          <li>Uzatma, eşit takımlar için <strong>1 tur</strong> oynanır (<strong>60 saniye</strong>).</li>
          <li>Uzatma bitince en yüksek puanı alan takım kazanır.</li>
          <li><strong>Not:</strong> Eğer “yine eşitlik olursa tekrar uzatma” istiyorsanız, bunun oyun kodunda ayrıca açılması gerekir.</li>
        </ul>
      </div>

      <div class="rules-modal-section">
        <h3 class="rules-modal-section-title">Duraklatma ve Devam</h3>
        <ul class="rules-modal-list">
          <li>Oyun sırasında <strong>Duraklat</strong> butonu ile mola verilebilir.</li>
          <li>Duraklatınca süre durur; devam edince kalan süreden oyun sürer.</li>
          <li>Duraklatma ekranında isterseniz oyundan çıkıp ana menüye dönebilirsiniz.</li>
        </ul>
      </div>
    </div>

<div class="rules-modal-footer">
  <button class="rules-understood-btn" id="rulesUnderstoodBtn">
    <img src="anla.png" alt="Okudum Anladım" class="rules-understood-image">
  </button>
</div>


  </div>
</div>


<!-- ===== FOOTER ===== -->
<footer class="site-footer" role="contentinfo">
  <div class="footer-inner">
    <div class="footer-glow" aria-hidden="true"></div>

<div class="footer-content">
  <span class="footer-text">Designed by</span>

<a class="footer-link footer-instagram"
   href="https://www.instagram.com/ileri.official?igsh=MXo0bmczdHVtbjFm&utm_source=qr"
   target="_blank"
   rel="noopener noreferrer">

  <img src="insta.png"
       alt="Instagram"
       class="ig-icon"
       draggable="false">

  Eren İlhan
</a>


  <a href="fix.html" class="footer-fix">
    <img src="fix.png" alt="Sorun Bildir">
  </a>
</div>

<!-- ⬇️ AYRI SATIR -->
<span class="footer-legal">
  © <span id="footerYear"></span> <strong>TabulaGo</strong> • Tüm hakları saklıdır
</span>

    <div class="footer-sparkles" aria-hidden="true">
      <span class="spark s1"></span>
      <span class="spark s2"></span>
      <span class="spark s3"></span>
      <span class="spark s4"></span>
    </div>
  </div>
</footer>

<!-- ===== SİTEDEN AYRILMA ONAY MODAL ===== -->
<div class="leave-modal"
     id="leaveModal"
     aria-hidden="true"
     role="dialog"
     aria-modal="true"
     aria-labelledby="leaveTitle"
     aria-describedby="leaveDesc">

  <!-- 🔮 RENKLİ DÖNEN ORBIT (KART DIŞI) -->
  <div class="leave-orbit" aria-hidden="true"></div>

  <div class="leave-box" role="document" tabindex="-1">

    <!-- LOGO -->
    <div class="leave-logo" aria-hidden="true">
      <img src="logo.png" alt="">
    </div>

    <!-- BAŞLIK -->
    <h3 id="leaveTitle">Siteden ayrılıyorsunuz</h3>

    <!-- ANA UYARI -->
    <p id="leaveDesc" class="leave-warning">
      Sorun bildirme sayfasına yönlendirileceksiniz.
    </p>

    <!-- AÇIKLAYICI METİN -->
    <p class="leave-subinfo">
      Devam etmeniz halinde mevcut oyun oturumu sonlandırılacak ve
      oyunda yaptığınız tüm işlemler, puanlar ve ilerleme
      <strong>KALICI OLARAK SİLİNECEKTİR</strong>.
    </p>

    <!-- YÜKLENİYOR / YÖNLENDİRİLİYORSUNUZ -->
    <div class="leave-status" aria-live="polite" hidden>
      <span class="leave-spinner" aria-hidden="true"></span>
      <span class="leave-status-text">Yönlendiriliyorsunuz…</span>
    </div>

    <!-- AKSİYONLAR -->
    <div class="leave-actions">
      <button type="button" class="leave-cancel">
        Vazgeç
      </button>

      <button type="button" class="leave-confirm">
        Devam Et
      </button>
    </div>

  </div>
</div>
    <!-- Kurallar Modal -->
    <div class="rules-modal" id="rulesModal">
    <script>
// ==========================================
//  MODÜLER KOD YAPISI - ANA UYGULAMA
// ==========================================

/**
 * TabulaGo Oyun Uygulaması
 * Güncellenmiş beraberlik sistemi ile
 */

// ==========================================
//  KONFİGÜRASYON VE SABİTLER
// ==========================================
const CONFIG = {
  STORAGE_KEY: 'tabulagoGameState_v3',
  SAVE_THROTTLE_MS: 600,
  AUTOSAVE_MS: 10000,
  CLEANUP_MS: 60000,
  SAVE_TTL_HOURS: 24,
  TURN_SECONDS_DEFAULT: 60,
  MAX_TEAMS: 4,
  MIN_TEAMS: 2,
  MAX_ROUNDS: 3,
  MAX_PLAYERS_PER_TEAM: 5,
  PASS_LIMIT: 3
};

// ==========================================
//  DATA MODELLERİ
// ==========================================
const GameModels = {
  Team: class {
    constructor(id, name, color, players) {
      this.id = id;
      this.name = name;
      this.color = color;
      this.players = players;
      this.playerCount = players.length;
      this.score = 0;
      this.passes = CONFIG.PASS_LIMIT;
      this.diceValue = 0;
    }
  },

  GameState: class {
    constructor() {
      this.version = 3;
      this.teams = [];
      this.totalRounds = CONFIG.MAX_ROUNDS;
      this.teamOrder = [];
      this.diceRolled = false;
      this.diceParticipants = [];
      this.diceRounds = 0;
      this.gameStarted = false;
      this.activeScreen = 'teamSetup';
      this.turnSchedule = [];
      this.currentTurnIndex = 0;
      this.maxSlotsPerTeam = 0;
      this.narratorPools = {};
      this.usedWords = [];
      this.sessionUsedWords = [];
      this.stats = {
        passes: [],
        correctAnswers: [],
        forbiddenWords: []
      };
      this.playerStats = [];
      this.perTurnPassLimit = CONFIG.PASS_LIMIT;

      // ✅ tie.phase eklendi
      this.tie = {
        isTie: false,
        phase: 'none',           // none | pending | playing | resolved
        tieTeams: [],
        tieRoundsCompleted: 0,
        maxTieRounds: 1,
        originalScores: {}
      };

      this.timer = {
        durationSec: CONFIG.TURN_SECONDS_DEFAULT,
        running: false,
        paused: false,
        endTimeMs: null,
        remainingSec: CONFIG.TURN_SECONDS_DEFAULT,
        originalEndTimeMs: null
      };
      this.pauseState = {
        screenBeforePause: null,
        remainingTimeAtPause: null
      };
      this.playerAvatars = [];
      this.teamFlags = [];
      this.lastSaved = null;
    }
  },

  PlayerStat: class {
    constructor(name) {
      this.name = name;
      this.correct = 0;
      this.forbidden = 0;
      this.passes = 0;
    }
  }
};

// ==========================================
//  DOM ELEMENT YÖNETİCİSİ
// ==========================================
const DOM = {
  screens: {
    resume: document.getElementById('resumeScreen'),
    teamSetup: document.getElementById('teamSetupScreen'),
    avatarSelection: document.getElementById('avatarSelectionScreen'),
    flagSelection: document.getElementById('flagSelectionScreen'),
    readyForDice: document.getElementById('readyForDiceScreen'),
    dice: document.getElementById('diceScreen'),
    teamTurn: document.getElementById('teamTurnScreen'),
    game: document.getElementById('gameScreen'),
    pause: document.getElementById('pauseScreen'),
    tie: document.getElementById('tieScreen'),
    winner: document.getElementById('winnerScreen')
  },

  rulesModal: document.getElementById('rulesModal'),
  rulesModalBackdrop: document.getElementById('rulesModalBackdrop'),
  rulesModalClose: document.getElementById('rulesModalClose'),
  rulesBtn: document.getElementById('rulesBtn'),
  rulesUnderstoodBtn: document.getElementById('rulesUnderstoodBtn'),

  resumeInfo: document.getElementById('resumeInfo'),
  resumeGameBtn: document.getElementById('resumeGameBtn'),
  newGameBtn: document.getElementById('newGameBtn'),

  teamsContainer: document.getElementById('teamsContainer'),
  addTeamBtn: document.getElementById('addTeamBtn'),
  totalRoundsInput: document.getElementById('totalRounds'),

  currentTeamNameDisplay: document.getElementById('currentTeamName'),
  currentPlayerNameDisplay: document.getElementById('currentPlayerName'),
  avatarGrid: document.getElementById('avatarGrid'),
  teamProgressDots: document.getElementById('teamProgressDots'),
  progressText: document.getElementById('progressText'),
  teamReadyBtn: document.getElementById('teamReadyBtn'),

  currentFlagTeamNameDisplay: document.getElementById('currentFlagTeamName'),
  flagGrid: document.getElementById('flagGrid'),
  flagProgressDots: document.getElementById('flagProgressDots'),
  flagProgressText: document.getElementById('flagProgressText'),
  flagReadyBtn: document.getElementById('flagReadyBtn'),

  readyTeamsContainer: document.getElementById('readyTeams'),
  goToDiceBtn: document.getElementById('goToDiceBtn'),

  diceContainer: document.getElementById('diceContainer'),
  tieInfoContainer: document.getElementById('tieInfoContainer'),
  rollDiceBtn: document.getElementById('rollDiceBtn'),
  orderList: document.getElementById('orderList'),
  startAfterDiceBtn: document.getElementById('startAfterDiceBtn'),

  turnTeamNameDisplay: document.getElementById('turnTeamName'),
  turnTeamAvatarDisplay: document.getElementById('turnTeamAvatar'),
  turnCountdownDisplay: document.getElementById('turnCountdown'),
  readyBtn: document.getElementById('readyBtn'),
  teamStatsContainer: document.getElementById('teamStatsContainer'),
  turnCurrentPlayerDisplay: document.getElementById('turnCurrentPlayer'),

  currentRoundDisplay: document.getElementById('currentRoundDisplay'),
  currentTeamDisplay: document.getElementById('currentTeamDisplay'),
  currentPlayerDisplay: document.getElementById('currentPlayerDisplay'),
  currentTeamFlag: document.getElementById('currentTeamFlag'),
  currentPlayerAvatar: document.getElementById('currentPlayerAvatar'),
  mainWordDisplay: document.getElementById('mainWord'),
  forbiddenWord1: document.getElementById('forbiddenWord1'),
  forbiddenWord2: document.getElementById('forbiddenWord2'),
  forbiddenWord3: document.getElementById('forbiddenWord3'),
  forbiddenWord4: document.getElementById('forbiddenWord4'),
  correctBtn: document.getElementById('correctBtn'),
  passBtn: document.getElementById('passBtn'),
  forbiddenBtn: document.getElementById('forbiddenBtn'),
  pauseBtn: document.getElementById('pauseBtn'),
  timerDisplay: document.getElementById('timer'),
  passCountDisplay: document.getElementById('passCount'),
  currentTeamPassLabel: document.getElementById('currentTeamPassLabel'),
  currentTeamPassCount: document.getElementById('currentTeamPassCount'),
  gameCard: document.getElementById('gameCard'),

  pauseCurrentRoundDisplay: document.getElementById('pauseCurrentRound'),
  pauseCurrentTeamDisplay: document.getElementById('pauseCurrentTeam'),
  pauseCurrentPlayerDisplay: document.getElementById('pauseCurrentPlayer'),
  pauseTeamFlag: document.getElementById('pauseTeamFlag'),
  pausePlayerAvatar: document.getElementById('pausePlayerAvatar'),
  pauseTeamScoresContainer: document.getElementById('pauseTeamScores'),
  resumeBtn: document.getElementById('resumeBtn'),
  quitBtn: document.getElementById('quitBtn'),

  tieTeamsContainer: document.getElementById('tieTeams'),
  tieExplanationContainer: document.getElementById('tieExplanation'),
  continueTieBtn: document.getElementById('continueTieBtn'),

  winnerTeamNameDisplay: document.getElementById('winnerTeamName'),
  finalScoresContainer: document.getElementById('finalScores'),
  statsTableContainer: document.getElementById('statsTableContainer'),

  startGameBtn: document.getElementById('startGameBtn'),
  playAgainBtn: document.getElementById('playAgainBtn'),
  mainMenuBtn: document.getElementById('mainMenuBtn')
};

// ==========================================
//  UTİLİTY FONKSİYONLARI
// ==========================================
const Utils = {
  clamp: (n, min, max) => Math.max(min, Math.min(max, n)),

  safeArrayAccess: (array, index, fallback = 0) => {
    if (!Array.isArray(array)) return fallback;
    return array[index] ?? fallback;
  },

  deepMerge: (target, source) => {
    if (!source || typeof source !== 'object') return target;
    const out = Array.isArray(target) ? [...target] : { ...target };
    for (const key of Object.keys(source)) {
      const s = source[key];
      const t = out[key];
      if (Array.isArray(s)) out[key] = s.slice();
      else if (s && typeof s === 'object')
        out[key] = Utils.deepMerge((t && typeof t === 'object') ? t : {}, s);
      else out[key] = s;
    }
    return out;
  },

  nowISO: () => new Date().toISOString(),

  shuffleInPlace: (arr) => {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  },

  getActiveScreenKeyFromDOM: () => {
    const active = document.querySelector('.screen.active-screen');
    if (!active) return 'teamSetup';
    for (const [key, el] of Object.entries(DOM.screens)) {
      if (el === active) return key;
    }
    return 'teamSetup';
  }
};

// ==========================================
//  SAKLAMA YÖNETİCİSİ (LocalStorage)
// ==========================================
const StorageManager = {
  _saveTimer: null,
  _lastSaveAt: 0,
  _gameState: null,

  saveGameStateThrottled(force = false) {
    if (!this._gameState) return;

    const now = Date.now();
    if (force) {
      if (this._saveTimer) {
        clearTimeout(this._saveTimer);
        this._saveTimer = null;
      }
      this._lastSaveAt = now;
      this._saveGameState();
      return;
    }

    const diff = now - this._lastSaveAt;
    if (diff >= CONFIG.SAVE_THROTTLE_MS) {
      this._lastSaveAt = now;
      this._saveGameState();
      return;
    }

    if (this._saveTimer) return;
    this._saveTimer = setTimeout(() => {
      this._saveTimer = null;
      this._lastSaveAt = Date.now();
      this._saveGameState();
    }, CONFIG.SAVE_THROTTLE_MS - diff);
  },

  _saveGameState() {
    if (!this._gameState) return;

    this._gameState.activeScreen = Utils.getActiveScreenKeyFromDOM();
    this._normalizeTimerState();

    if (this._gameState.timer.running && !this._gameState.timer.paused && this._gameState.timer.endTimeMs) {
      const rem = Math.max(0, Math.ceil((this._gameState.timer.endTimeMs - Date.now()) / 1000));
      this._gameState.timer.remainingSec = rem;
    }

    this._gameState.lastSaved = Utils.nowISO();
    localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(this._gameState));
  },

  _normalizeTimerState() {
    if (!this._gameState.timer || typeof this._gameState.timer !== 'object') {
      this._gameState.timer = {
        durationSec: CONFIG.TURN_SECONDS_DEFAULT,
        running: false,
        paused: false,
        endTimeMs: null,
        remainingSec: CONFIG.TURN_SECONDS_DEFAULT,
        originalEndTimeMs: null
      };
    }

    let d = parseInt(this._gameState.timer.durationSec, 10);
    if (Number.isNaN(d) || d < 1) d = CONFIG.TURN_SECONDS_DEFAULT;
    this._gameState.timer.durationSec = d;

    let r = parseInt(this._gameState.timer.remainingSec, 10);
    if (Number.isNaN(r) || r < 0) r = d;
    this._gameState.timer.remainingSec = r;

    if (this._gameState.timer.endTimeMs != null && typeof this._gameState.timer.endTimeMs !== 'number') {
      this._gameState.timer.endTimeMs = null;
    }
    if (this._gameState.timer.originalEndTimeMs != null && typeof this._gameState.timer.originalEndTimeMs !== 'number') {
      this._gameState.timer.originalEndTimeMs = null;
    }

    if (typeof this._gameState.timer.running !== 'boolean') this._gameState.timer.running = false;
    if (typeof this._gameState.timer.paused !== 'boolean') this._gameState.timer.paused = false;
  },

  loadGameState() {
    const raw = localStorage.getItem(CONFIG.STORAGE_KEY);
    if (!raw) {
      this._gameState = new GameModels.GameState();
      return false;
    }

    try {
      const parsed = JSON.parse(raw);
      const defaultState = new GameModels.GameState();
      this._gameState = Utils.deepMerge(defaultState, parsed);

      if (this._gameState.lastSaved) {
        const savedTime = new Date(this._gameState.lastSaved).getTime();
        const hoursDiff = (Date.now() - savedTime) / (1000 * 60 * 60);
        if (hoursDiff > CONFIG.SAVE_TTL_HOURS) {
          localStorage.removeItem(CONFIG.STORAGE_KEY);
          this._gameState = new GameModels.GameState();
          return false;
        }
      }

      this._normalizeTimerState();

      if (this._gameState.timer.running && !this._gameState.timer.paused) {
        if (typeof this._gameState.timer.endTimeMs === 'number') {
          const rem = Math.max(0, Math.ceil((this._gameState.timer.endTimeMs - Date.now()) / 1000));
          this._gameState.timer.remainingSec = rem;
          if (rem <= 0) {
            this._gameState.timer.running = false;
            this._gameState.timer.remainingSec = 0;
          }
        } else {
          const rem = Utils.clamp(
            this._gameState.timer.remainingSec ?? CONFIG.TURN_SECONDS_DEFAULT,
            0,
            this._gameState.timer.durationSec
          );
          this._gameState.timer.remainingSec = rem;
          this._gameState.timer.running = false;
        }
      }

      if (!this._gameState.narratorPools || typeof this._gameState.narratorPools !== 'object') {
        this._gameState.narratorPools = {};
      }
      if (!Number.isFinite(this._gameState.maxSlotsPerTeam) || this._gameState.maxSlotsPerTeam < 0) {
        this._gameState.maxSlotsPerTeam = 0;
      }

      // ✅ tie.phase güvenliği
      if (!this._gameState.tie || typeof this._gameState.tie !== 'object') {
        this._gameState.tie = new GameModels.GameState().tie;
      } else {
        if (!this._gameState.tie.phase) this._gameState.tie.phase = 'none';
        if (!this._gameState.tie.originalScores || typeof this._gameState.tie.originalScores !== 'object') {
          this._gameState.tie.originalScores = {};
        }
      }

      return true;
    } catch (e) {
      console.error('Kayıtlı oyun yüklenirken hata:', e);
      this._gameState = new GameModels.GameState();
      return false;
    }
  },

  cleanupGameState() {
    if (!this._gameState) return;

    if (Array.isArray(this._gameState.sessionUsedWords) && this._gameState.sessionUsedWords.length > 1500) {
      this._gameState.sessionUsedWords = this._gameState.sessionUsedWords.slice(-800);
    }
    if (Array.isArray(this._gameState.usedWords) && this._gameState.usedWords.length > 3000) {
      this._gameState.usedWords = this._gameState.usedWords.slice(-1500);
    }

    this.saveGameStateThrottled();
  },

  get gameState() { return this._gameState; },
  set gameState(state) { this._gameState = state; },

  clearAll() {
    localStorage.removeItem(CONFIG.STORAGE_KEY);
    this._gameState = new GameModels.GameState();
  }
};

// ==========================================
//  EKRAN YÖNETİCİSİ
// ==========================================
const ScreenManager = {
  showScreen(screenName) {
    Object.values(DOM.screens).forEach(s => { if (s) s.classList.remove('active-screen'); });

    if (DOM.screens[screenName]) {
      DOM.screens[screenName].classList.add('active-screen');
      if (StorageManager.gameState) StorageManager.gameState.activeScreen = screenName;
      StorageManager.saveGameStateThrottled();
    }
  },

  clearAllIntervals() {
    GameTimer.stopTimer();
    if (this.countdownInterval) { clearInterval(this.countdownInterval); this.countdownInterval = null; }
    if (this.resumeCountdownInterval) { clearInterval(this.resumeCountdownInterval); this.resumeCountdownInterval = null; }
  },

  countdownInterval: null,
  resumeCountdownInterval: null
};

// ==========================================
//  TAKIM YÖNETİCİSİ
// ==========================================
const TeamManager = {
  teamColors: ['team1', 'team2', 'team3', 'team4'],

  addTeam() {
    const gameState = StorageManager.gameState;
    const teamCount = gameState.teams.length;
    if (teamCount >= CONFIG.MAX_TEAMS) return;

    const teamId = teamCount + 1;
    const teamColor = this.teamColors[teamCount];
    const players = ['Oyuncu 1', 'Oyuncu 2', 'Oyuncu 3'];

    const team = new GameModels.Team(teamId, `Takım ${teamId}`, teamColor, players);
    gameState.teams.push(team);

    this.renderTeams();
    StorageManager.saveGameStateThrottled();
  },

  removeTeam(teamId) {
    const gameState = StorageManager.gameState;
    if (gameState.teams.length <= CONFIG.MIN_TEAMS) return;

    gameState.teams = gameState.teams.filter(t => t.id !== teamId);

    gameState.teams.forEach((team, idx) => {
      team.id = idx + 1;
      team.color = this.teamColors[idx];
      if (/^Takım \d+$/.test(team.name)) team.name = `Takım ${team.id}`;
    });

    this.renderTeams();
    StorageManager.saveGameStateThrottled();
  },

  adjustPlayerCount(teamId, delta) {
    const gameState = StorageManager.gameState;
    const team = gameState.teams.find(t => t.id === teamId);
    if (!team) return;

    const newCount = team.playerCount + delta;
    if (newCount < 1 || newCount > CONFIG.MAX_PLAYERS_PER_TEAM) return;

    team.playerCount = newCount;
    if (delta > 0) team.players.push(`Oyuncu ${newCount}`);
    else team.players.pop();

    this.renderTeams();
    StorageManager.saveGameStateThrottled();
  },

  renderTeams() {
    if (!DOM.teamsContainer) return;

    const gameState = StorageManager.gameState;
    DOM.teamsContainer.innerHTML = '';

    gameState.teams.forEach(team => {
      const el = document.createElement('div');
      el.className = `team ${team.color}`;
      el.innerHTML = `
        <div class="team-header">
          <div class="team-name">${team.id}. Takım</div>
          ${gameState.teams.length > CONFIG.MIN_TEAMS
          ? `<button class="remove-team" data-team-id="${team.id}" aria-label="${team.name} takımını sil">
              <i class="fas fa-times"></i>
            </button>` : ''
        }
        </div>
        <input type="text" class="team-input team-name-input"
          data-team-id="${team.id}" value="${team.name}" placeholder="Takım İsmi">
        <div class="player-count">
          <button class="player-btn team-decrease" data-team-id="${team.id}" aria-label="Oyuncu sayısını azalt">
            <i class="fas fa-minus"></i>
          </button>
          <div class="player-count-display team-player-count" data-team-id="${team.id}">${team.playerCount}</div>
          <button class="player-btn team-increase" data-team-id="${team.id}" aria-label="Oyuncu sayısını artır">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <div>Oyuncu Sayısı: 1-5</div>
        <div class="player-names" id="playerNames-${team.id}">
          ${team.players.map((p, idx) => `
            <input type="text" class="player-name-input"
              data-team-id="${team.id}" data-player-index="${idx}"
              value="${p}" placeholder="Oyuncu ${idx + 1}">
          `).join('')}
        </div>
      `;
      DOM.teamsContainer.appendChild(el);
    });

    this._attachTeamEventListeners();
  },

  _attachTeamEventListeners() {
    document.querySelectorAll('.remove-team').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const teamId = parseInt(e.target.closest('.remove-team')?.getAttribute('data-team-id'), 10);
        this.removeTeam(teamId);
      });
    });

    document.querySelectorAll('.team-decrease').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const teamId = parseInt(e.target.closest('.team-decrease')?.getAttribute('data-team-id'), 10);
        this.adjustPlayerCount(teamId, -1);
      });
    });

    document.querySelectorAll('.team-increase').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const teamId = parseInt(e.target.closest('.team-increase')?.getAttribute('data-team-id'), 10);
        this.adjustPlayerCount(teamId, +1);
      });
    });

    document.querySelectorAll('.team-name-input').forEach(input => {
      input.addEventListener('focus', (e) => {
        const id = e.target.getAttribute('data-team-id');
        if (e.target.value === `Takım ${id}`) e.target.value = '';
      });

      input.addEventListener('input', (e) => {
        e.target.value = e.target.value.toUpperCase();
        const teamId = parseInt(e.target.getAttribute('data-team-id'), 10);
        const team = StorageManager.gameState.teams.find(t => t.id === teamId);
        if (team) team.name = e.target.value;
        StorageManager.saveGameStateThrottled();
      });
    });

    document.querySelectorAll('.player-name-input').forEach(input => {
      input.addEventListener('focus', (e) => {
        const idx = parseInt(e.target.getAttribute('data-player-index'), 10);
        if (e.target.value === `Oyuncu ${idx + 1}`) e.target.value = '';
      });

      input.addEventListener('input', (e) => {
        e.target.value = e.target.value.toUpperCase();
        const teamId = parseInt(e.target.getAttribute('data-team-id'), 10);
        const idx = parseInt(e.target.getAttribute('data-player-index'), 10);
        const team = StorageManager.gameState.teams.find(t => t.id === teamId);
        if (team && team.players[idx] !== undefined) team.players[idx] = e.target.value;
        StorageManager.saveGameStateThrottled();
      });
    });
  }
};

// ==========================================
//  AVATAR YÖNETİCİSİ
// ==========================================
const AvatarManager = {
  avatarList: [
    'avatar1.png','avatar2.png','avatar3.png','avatar4.png','avatar5.png',
    'avatar6.png','avatar7.png','avatar8.png','avatar9.png','avatar10.png',
    'avatar11.png','avatar12.png','avatar13.png','avatar14.png','avatar15.png',
    'avatar16.png','avatar17.png','avatar18.png','avatar19.png','avatar20.png',
    'avatar21.png','avatar22.png','avatar23.png','avatar24.png','avatar25.png',
    'avatar26.png','avatar27.png','avatar28.png','avatar29.png','avatar30.png',
    'avatar31.png','avatar32.png','avatar33.png','avatar34.png','avatar35.png',
	'avatar36.png','avatar37.png','avatar38.png','avatar39.png','avatar40.png',
	'avatar41.png','avatar42.png','avatar43.png','avatar44.png','avatar45.png',
	'avatar46.png','avatar47.png','avatar48.png','avatar49.png',
  ],

  selectionState: { currentTeamIndex: 0, currentPlayerIndex: 0 },

  showAvatarSelectionScreen(keepIndex = false) {
    if (!keepIndex) { this.selectionState.currentTeamIndex = 0; this.selectionState.currentPlayerIndex = 0; }
    this.updateDisplay();
    this.renderAvatarGrid();
    this.checkTeamReadyStatus();
    ScreenManager.showScreen('avatarSelection');
  },

  updateDisplay() {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const player = team.players[this.selectionState.currentPlayerIndex];

    if (DOM.currentTeamNameDisplay) DOM.currentTeamNameDisplay.textContent = team.name;
    if (DOM.currentPlayerNameDisplay) DOM.currentPlayerNameDisplay.textContent = player;

    this.updateProgressDisplay();
  },

  updateProgressDisplay() {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];

    const done = team.players.filter(p =>
      gameState.playerAvatars.some(pa => pa.teamId === team.id && pa.playerName === p)
    ).length;
    const total = team.players.length;

    if (DOM.teamProgressDots) {
      DOM.teamProgressDots.innerHTML = '';
      for (let i = 0; i < total; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        if (i < done) dot.classList.add('completed');
        else if (i === this.selectionState.currentPlayerIndex) dot.classList.add('current');
        DOM.teamProgressDots.appendChild(dot);
      }
    }

    if (DOM.progressText) DOM.progressText.textContent = `${done}/${total} oyuncu tamamlandı`;
  },

  renderAvatarGrid() {
    if (!DOM.avatarGrid) return;
    DOM.avatarGrid.innerHTML = '';
    const gameState = StorageManager.gameState;

    this.avatarList.forEach((avatar, index) => {
      const item = document.createElement('div');
      item.className = 'avatar-item';
      item.dataset.avatarIndex = String(index);

      const selected = this.isAvatarSelected(index);
      const used = this.isAvatarUsed(index);

      if (selected) item.classList.add('selected');
      if (used) {
        item.classList.add('used');
        item.style.opacity = '0.5';
        item.style.cursor = 'not-allowed';
      }

      item.innerHTML = `
        <img src="${avatar}" alt="Avatar ${index + 1}" class="avatar-image"
          onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>Avatar ${index + 1}</div>'">
        ${used ? '<div class="avatar-used-overlay"><i class="fas fa-times-circle"></i></div>' : ''}
      `;

      if (!used) item.addEventListener('click', () => this.selectAvatar(index));
      DOM.avatarGrid.appendChild(item);
    });
  },

  isAvatarSelected(avatarIndex) {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const player = team.players[this.selectionState.currentPlayerIndex];
    const pa = gameState.playerAvatars.find(x => x.teamId === team.id && x.playerName === player);
    return pa && pa.avatarIndex === avatarIndex;
  },

  isAvatarUsed(avatarIndex) {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const player = team.players[this.selectionState.currentPlayerIndex];
    return gameState.playerAvatars.some(pa =>
      pa.avatarIndex === avatarIndex && !(pa.teamId === team.id && pa.playerName === player)
    );
  },

  selectAvatar(avatarIndex) {
    if (this.isAvatarUsed(avatarIndex)) return;

    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const player = team.players[this.selectionState.currentPlayerIndex];

    gameState.playerAvatars = gameState.playerAvatars.filter(pa => !(pa.teamId === team.id && pa.playerName === player));

    gameState.playerAvatars.push({
      teamId: team.id,
      playerName: player,
      avatarIndex,
      avatarPath: this.avatarList[avatarIndex]
    });

    this.renderAvatarGrid();
    this.updateProgressDisplay();
    this.checkTeamReadyStatus();
    StorageManager.saveGameStateThrottled();
  },

  checkTeamReadyStatus() {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];

    const done = team.players.filter(p =>
      gameState.playerAvatars.some(pa => pa.teamId === team.id && pa.playerName === p)
    ).length;

    if (DOM.teamReadyBtn) DOM.teamReadyBtn.disabled = done <= this.selectionState.currentPlayerIndex;
  },

  finishTeamAvatarSelection() {
    this.selectionState.currentPlayerIndex++;

    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];

    if (this.selectionState.currentPlayerIndex >= team.players.length) {
      this.selectionState.currentTeamIndex++;
      this.selectionState.currentPlayerIndex = 0;

      if (this.selectionState.currentTeamIndex >= gameState.teams.length) {
        FlagManager.showFlagSelectionScreen(false);
      } else {
        this.updateDisplay();
        this.renderAvatarGrid();
        this.checkTeamReadyStatus();
        ScreenManager.showScreen('avatarSelection');
      }
    } else {
      this.updateDisplay();
      this.renderAvatarGrid();
      this.checkTeamReadyStatus();
    }

    StorageManager.saveGameStateThrottled(true);
  }
};

// ==========================================
//  FLAMA YÖNETİCİSİ
// ==========================================
const FlagManager = {
  flagList: [
    { name: 'Kırmızı Flama', image: 'flamakirmizi.png', color: '#ff6b6b' },
    { name: 'Mavi Flama', image: 'flamamavi.png', color: '#00b4db' },
    { name: 'Sarı Flama', image: 'flamasari.png', color: '#ffd93d' },
    { name: 'Yeşil Flama', image: 'flamayesil.png', color: '#6bcf7f' }
  ],

  selectionState: { currentTeamIndex: 0 },

  showFlagSelectionScreen(keepIndex = false) {
    if (!keepIndex) this.selectionState.currentTeamIndex = 0;
    this.updateDisplay();
    this.renderFlagGrid();
    this.checkFlagReadyStatus();
    ScreenManager.showScreen('flagSelection');
  },

  updateDisplay() {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];

    if (DOM.currentFlagTeamNameDisplay) DOM.currentFlagTeamNameDisplay.textContent = team.name;
    this.updateProgressDisplay();
  },

  updateProgressDisplay() {
    const gameState = StorageManager.gameState;
    const done = gameState.teams.filter(t => gameState.teamFlags.some(tf => tf.teamId === t.id)).length;
    const total = gameState.teams.length;

    if (DOM.flagProgressDots) {
      DOM.flagProgressDots.innerHTML = '';
      for (let i = 0; i < total; i++) {
        const dot = document.createElement('div');
        dot.className = 'flag-progress-dot';
        if (i < done) dot.classList.add('completed');
        else if (i === this.selectionState.currentTeamIndex) dot.classList.add('current');
        DOM.flagProgressDots.appendChild(dot);
      }
    }
    if (DOM.flagProgressText) DOM.flagProgressText.textContent = `${done}/${total} takım tamamlandı`;
  },

  renderFlagGrid() {
    if (!DOM.flagGrid) return;

    DOM.flagGrid.innerHTML = '';
    const gameState = StorageManager.gameState;

    this.flagList.forEach((flag, index) => {
      const item = document.createElement('div');
      item.className = 'flag-item';
      item.dataset.flagIndex = String(index);

      const selected = this.isFlagSelected(index);
      const used = this.isFlagUsed(index);

      if (selected) item.classList.add('selected');
      if (used) { item.style.opacity = '0.5'; item.style.cursor = 'not-allowed'; }

      item.innerHTML = `
        <img src="${flag.image}" alt="${flag.name}" class="flag-image"
          onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>${flag.name}</div>'">
        <div class="flag-name">${flag.name}</div>
      `;

      if (!used) item.addEventListener('click', () => this.selectFlag(index));
      DOM.flagGrid.appendChild(item);
    });
  },

  isFlagSelected(flagIndex) {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const tf = gameState.teamFlags.find(x => x.teamId === team.id);
    return tf && tf.flagIndex === flagIndex;
  },

  isFlagUsed(flagIndex) {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    return gameState.teamFlags.some(tf => tf.flagIndex === flagIndex && tf.teamId !== team.id);
  },

  selectFlag(flagIndex) {
    if (this.isFlagUsed(flagIndex)) return;

    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];

    gameState.teamFlags = gameState.teamFlags.filter(tf => tf.teamId !== team.id);

    gameState.teamFlags.push({
      teamId: team.id,
      flagIndex,
      flagName: this.flagList[flagIndex].name,
      flagPath: this.flagList[flagIndex].image,
      flagColor: this.flagList[flagIndex].color
    });

    this.renderFlagGrid();
    this.updateProgressDisplay();
    this.checkFlagReadyStatus();
    StorageManager.saveGameStateThrottled();
  },

  checkFlagReadyStatus() {
    const gameState = StorageManager.gameState;
    const team = gameState.teams[this.selectionState.currentTeamIndex];
    const hasFlag = gameState.teamFlags.some(tf => tf.teamId === team.id);
    if (DOM.flagReadyBtn) DOM.flagReadyBtn.disabled = !hasFlag;
  },

  finishTeamFlagSelection() {
    this.selectionState.currentTeamIndex++;

    const gameState = StorageManager.gameState;

    if (this.selectionState.currentTeamIndex >= gameState.teams.length) {
      ReadyScreenManager.showReadyForDiceScreen();
    } else {
      this.updateDisplay();
      this.renderFlagGrid();
      this.checkFlagReadyStatus();
      ScreenManager.showScreen('flagSelection');
    }

    StorageManager.saveGameStateThrottled(true);
  }
};

// ==========================================
//  HAZIR EKRANI YÖNETİCİSİ
// ==========================================
const ReadyScreenManager = {
  showReadyForDiceScreen() {
    this.renderReadyTeams();
    ScreenManager.showScreen('readyForDice');
  },

  renderReadyTeams() {
    if (!DOM.readyTeamsContainer) return;

    const gameState = StorageManager.gameState;
    DOM.readyTeamsContainer.innerHTML = '';

    gameState.teams.forEach(team => {
      const el = document.createElement('div');
      el.className = 'ready-team';

      const tf = gameState.teamFlags.find(x => x.teamId === team.id);

      const playersHTML = team.players.map(player => {
        const pa = gameState.playerAvatars.find(x => x.teamId === team.id && x.playerName === player);
        return `
          <div class="ready-player">
            <div class="ready-player-avatar">
              ${pa
                ? `<img src="${AvatarManager.avatarList[pa.avatarIndex]}" alt="${player}"
                    onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>${player}</div>'">`
                : `<div class="avatar-placeholder">?</div>`}
            </div>
            <div class="ready-player-name">${player}</div>
          </div>
        `;
      }).join('');

      el.innerHTML = `
        <div class="ready-team-name">${team.name}</div>
        <div class="ready-team-players">${playersHTML}</div>
        <div class="team-flag" style="margin-top: 15px;">
          <div style="font-size: 0.9rem; margin-bottom: 5px;">Takım Flaması:</div>
          ${tf
            ? `<div style="display:flex;align-items:center;justify-content:center;gap:8px;">
                <img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}"
                  style="width:30px;height:30px;object-fit:contain;">
                <span>${tf.flagName}</span>
              </div>`
            : `<div>Seçilmedi</div>`}
        </div>
      `;
      DOM.readyTeamsContainer.appendChild(el);
    });
  }
};

// ==========================================
//  ZAR YÖNETİCİSİ
// ==========================================
const DiceManager = {
  diceAnimations: {},
  diceFrontAngles: {
    1: { x: 0, y: 0 },
    2: { x: 90, y: 0 },
    3: { x: 0, y: -90 },
    4: { x: 0, y: 90 },
    5: { x: -90, y: 0 },
    6: { x: 180, y: 0 }
  },

  showDiceScreen() {
    if (!DOM.diceContainer) return;

    DOM.diceContainer.innerHTML = '';
    const gameState = StorageManager.gameState;

    gameState.teams.forEach(team => {
      const item = document.createElement('div');
      item.className = 'dice-item';

      const name = document.createElement('div');
      name.className = 'dice-team-name';
      name.textContent = team.name;

      const diceEl = this.create3DDice(team.id, 1);

      const valueEl = document.createElement('div');
      valueEl.className = 'dice-value';
      valueEl.id = `diceValue-${team.id}`;
      valueEl.textContent = '-';

      item.appendChild(name);
      item.appendChild(diceEl);
      item.appendChild(valueEl);
      DOM.diceContainer.appendChild(item);
    });

    gameState.diceParticipants = gameState.teams.map(t => t.id);
    gameState.diceRounds = 0;
    gameState.diceRolled = false;

    if (DOM.tieInfoContainer) DOM.tieInfoContainer.innerHTML = '';
    if (DOM.orderList) DOM.orderList.style.display = 'none';
    if (DOM.startAfterDiceBtn) DOM.startAfterDiceBtn.style.display = 'none';

if (DOM.rollDiceBtn) {
  DOM.rollDiceBtn.style.display = 'block';
  DOM.rollDiceBtn.disabled = false;
  DOM.rollDiceBtn.innerHTML = `
    <img src="zarat.png" alt="Zar At" class="dice-btn-img">
  `;
}

    ScreenManager.showScreen('dice');
    StorageManager.saveGameStateThrottled(true);
  },

  create3DDice(teamId, initialValue = 1) {
    const wrap = document.createElement('div');
    wrap.className = 'dice-3d-container';
    wrap.id = `dice-3d-container-${teamId}`;

    const dice = document.createElement('div');
    dice.className = 'dice-3d';
    dice.id = `dice-3d-${teamId}`;

    [1, 2, 3, 4, 5, 6].forEach(faceValue => {
      const face = document.createElement('div');
      face.className = `dice-face dice-face-${faceValue}`;
      face.id = `dice-face-${teamId}-${faceValue}`;

      const pips = this.getPipPositions(faceValue);
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement('div');
        if (pips.includes(i)) {
          const pip = document.createElement('div');
          pip.className = 'dice-pip';
          cell.appendChild(pip);
        }
        face.appendChild(cell);
      }
      dice.appendChild(face);
    });

    wrap.appendChild(dice);

    const shadow = document.createElement('div');
    shadow.className = 'dice-3d-shadow';
    wrap.appendChild(shadow);

    const target = this.diceFrontAngles[initialValue] || this.diceFrontAngles[1];
    dice.style.transform = `rotateX(${target.x}deg) rotateY(${target.y}deg) rotateZ(0deg)`;

    return wrap;
  },

  getPipPositions(faceValue) {
    const positions = {
      1: [4],
      2: [0, 8],
      3: [0, 4, 8],
      4: [0, 2, 6, 8],
      5: [0, 2, 4, 6, 8],
      6: [0, 2, 3, 5, 6, 8]
    };
    return positions[faceValue] || positions[1];
  },

  async rollDice() {
    if (DOM.rollDiceBtn && DOM.rollDiceBtn.disabled) return;

    const gameState = StorageManager.gameState;
    let participants;

    if (Array.isArray(gameState.diceParticipants) && gameState.diceParticipants.length > 0) {
      participants = gameState.diceParticipants.map(id => gameState.teams.find(t => t.id === id)).filter(Boolean);
    } else {
      participants = [...gameState.teams];
      gameState.diceParticipants = participants.map(t => t.id);
    }

    if (!participants.length) return;

    gameState.diceRounds++;
    gameState.diceRolled = true;

    if (DOM.rollDiceBtn) DOM.rollDiceBtn.disabled = true;

    const promises = participants.map(team => {
      const diceValue = Math.floor(Math.random() * 6) + 1;
      team.diceValue = diceValue;

      const diceValueElement = document.getElementById(`diceValue-${team.id}`);
      if (diceValueElement) diceValueElement.textContent = '-';

      return this.animateDiceRoll(team.id, diceValue).then(value => {
        const el = document.getElementById(`diceValue-${team.id}`);
        if (el) el.textContent = String(value);
        return { team, value };
      });
    });

    await Promise.all(promises);
    this.handleDiceRoundEnd(participants);
    StorageManager.saveGameStateThrottled(true);
  },

  animateDiceRoll(teamId, targetValue) {
    return new Promise(resolve => {
      const diceEl = document.getElementById(`dice-3d-${teamId}`);
      if (!diceEl) { resolve(targetValue); return; }

      const target = this.diceFrontAngles[targetValue] || this.diceFrontAngles[1];
      if (this.diceAnimations[teamId]) cancelAnimationFrame(this.diceAnimations[teamId]);

      const duration = 3000;
      const start = performance.now();
      const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

      const spinX = 360 + Math.random() * 360;
      const spinY = 540 + Math.random() * 540;
      const spinZ = 360 + Math.random() * 360;

      const animate = (now) => {
        let t = (now - start) / duration;
        if (t > 1) t = 1;

        const p = easeOutCubic(t);
        const k = 1 - p;

        const x = target.x + spinX * k;
        const y = target.y + spinY * k;
        const z = spinZ * k;

        diceEl.style.transform = `rotateX(${x}deg) rotateY(${y}deg) rotateZ(${z}deg)`;

        if (t < 1) {
          this.diceAnimations[teamId] = requestAnimationFrame(animate);
        } else {
          diceEl.style.transform = `rotateX(${target.x}deg) rotateY(${target.y}deg) rotateZ(0deg)`;
          this.diceAnimations[teamId] = null;
          resolve(targetValue);
        }
      };

      this.diceAnimations[teamId] = requestAnimationFrame(animate);
    });
  },

  handleDiceRoundEnd(participants) {
    const groups = {};
    participants.forEach(team => {
      const v = team.diceValue;
      if (!groups[v]) groups[v] = [];
      groups[v].push(team);
    });

    const tied = [];
    Object.values(groups).forEach(g => { if (g.length > 1) tied.push(...g); });

    if (tied.length > 0) {
      let message = `<div class="tie-notice">Eşitlik var! Sadece eşit zar atan takımlar tekrar zar atacak.</div>`;

      const byVal = {};
      tied.forEach(t => { const v = t.diceValue; if (!byVal[v]) byVal[v] = []; byVal[v].push(t); });

      Object.keys(byVal).forEach(v => {
        const names = byVal[v].map(t => t.name).join(', ');
        message += `<div class="tie-info">${names} takımları ${v} attı, tekrar zar atacak.</div>`;
      });

      if (DOM.tieInfoContainer) DOM.tieInfoContainer.innerHTML = message;

      const gameState = StorageManager.gameState;
      gameState.diceParticipants = tied.map(t => t.id);

      if (DOM.rollDiceBtn) {
        DOM.rollDiceBtn.disabled = false;
        DOM.rollDiceBtn.innerHTML = '<i class="fas fa-dice"></i> Eşit Takımlar Tekrar Zar Atsın';
      }
      return;
    }

    const gameState = StorageManager.gameState;
    gameState.diceParticipants = [];

    if (DOM.tieInfoContainer) {
      DOM.tieInfoContainer.innerHTML = gameState.diceRounds > 1
        ? `<div class="tie-info">${gameState.diceRounds} tur zar atıldıktan sonra sıralama belirlendi!</div>`
        : '';
    }

    this.determineOrder();
    if (DOM.rollDiceBtn) DOM.rollDiceBtn.style.display = 'none';
    StorageManager.saveGameStateThrottled(true);
  },

  determineOrder() {
    const gameState = StorageManager.gameState;
    gameState.teamOrder = [...gameState.teams]
      .sort((a, b) => (b.diceValue || 0) - (a.diceValue || 0))
      .map(t => ({ ...t }));

    this.showOrderList();
    if (DOM.startAfterDiceBtn) DOM.startAfterDiceBtn.style.display = 'block';
    StorageManager.saveGameStateThrottled();
  },

  showOrderList() {
    if (!DOM.orderList) return;

    DOM.orderList.innerHTML = '<h3 class="order-title">Oyun Sırası</h3>';
    const gameState = StorageManager.gameState;

    gameState.teamOrder.forEach((team, idx) => {
      const tf = gameState.teamFlags.find(x => x.teamId === team.id);

      const item = document.createElement('div');
      item.className = 'order-item';
      item.innerHTML = `
        <div class="order-number">${idx + 1}</div>
        ${tf ? `
          <div class="order-team-flag">
            <img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}" class="order-flag-image"
              onerror="this.style.display='none'">
          </div>` :
          `<div class="order-team-flag"><div class="order-flag-placeholder">?</div></div>`
        }
        <div class="order-team">${team.name}</div>
        <div class="order-dice">Zar: ${team.diceValue}</div>
      `;
      DOM.orderList.appendChild(item);
    });

    DOM.orderList.style.display = 'block';
  }
};

// ==========================================
//  TUR YÖNETİCİSİ
// ==========================================
const TurnManager = {
  isTurnCountdownRunning: false,

  computeMaxSlots(teams) {
    const m = Math.max(...teams.map(t => (t.players?.length || 0)), 0);
    return Math.max(1, m);
  },

  ensureNarratorPool(teamId, playerCount) {
    const gameState = StorageManager.gameState;
    if (!gameState.narratorPools) gameState.narratorPools = {};

    if (!Array.isArray(gameState.narratorPools[String(teamId)]) ||
      gameState.narratorPools[String(teamId)].length === 0) {
      const pool = Array.from({ length: playerCount }, (_, i) => i);
      Utils.shuffleInPlace(pool);
      gameState.narratorPools[String(teamId)] = pool;
    }
  },

  drawNarratorForTeam(team, slotNo) {
    const gameState = StorageManager.gameState;
    const playerCount = team.players.length;

    if (playerCount <= 0) {
      return { displayName: `OYUNCU ${slotNo}`, actualName: `OYUNCU ${slotNo}`, actualIndex: -1, slotNo };
    }

    if (playerCount === gameState.maxSlotsPerTeam) {
      const idx = (slotNo - 1) % playerCount;
      const actualName = team.players[idx];
      return { displayName: actualName, actualName, actualIndex: idx, slotNo };
    }

    this.ensureNarratorPool(team.id, playerCount);
    const poolKey = String(team.id);
    const pool = gameState.narratorPools[poolKey];

    if (!pool.length) {
      const refill = Array.from({ length: playerCount }, (_, i) => i);
      Utils.shuffleInPlace(refill);
      gameState.narratorPools[poolKey] = refill;
    }

    const pickPool = gameState.narratorPools[poolKey];
    const actualIndex = pickPool.pop();
    const actualName = team.players[actualIndex];
    const displayName = slotNo > playerCount ? `OYUNCU ${slotNo}` : actualName;

    return { displayName, actualName, actualIndex, slotNo };
  },

  buildTurnSchedule(orderTeams, totalRounds) {
    const teams = orderTeams;
    const gameState = StorageManager.gameState;

    gameState.maxSlotsPerTeam = this.computeMaxSlots(teams);

    if (!gameState.narratorPools || typeof gameState.narratorPools !== 'object') gameState.narratorPools = {};

    const schedule = [];
    const maxSlots = gameState.maxSlotsPerTeam;

    for (let r = 1; r <= totalRounds; r++) {
      for (let slotNo = 1; slotNo <= maxSlots; slotNo++) {
        for (let ti = 0; ti < teams.length; ti++) {
          const team = teams[ti];
          const pick = this.drawNarratorForTeam(team, slotNo);

          schedule.push({
            round: r,
            teamId: team.id,
            playerName: pick.displayName,
            actualPlayerName: pick.actualName,
            actualPlayerIndex: pick.actualIndex,
            slotNo: pick.slotNo
          });
        }
      }
    }
    return schedule;
  },

  getCurrentTurn() {
    const gameState = StorageManager.gameState;
    if (!Array.isArray(gameState.turnSchedule) || gameState.turnSchedule.length === 0) return null;
    return gameState.turnSchedule[gameState.currentTurnIndex] || null;
  },

  getTeamById(teamId) {
    const gameState = StorageManager.gameState;
    return gameState.teamOrder.find(t => t.id === teamId) ||
      gameState.teams.find(t => t.id === teamId) || null;
  },

  // ✅ KRİTİK FIX: oyun bitince direkt finalize değil endGameFlow
  advanceTurnIndex() {
    const gameState = StorageManager.gameState;
    gameState.currentTurnIndex++;

    const hasMoreTurns = gameState.currentTurnIndex < gameState.turnSchedule.length;

    if (!hasMoreTurns) {
      console.log('Tüm turlar tamamlandı! Oyun sonu akışı başlatılıyor...');
      GameManager.endGameFlow();
      return false;
    }

    return true;
  }
};

// ==========================================
//  TAKIM SIRASI EKRANI YÖNETİCİSİ
// ==========================================
const TeamTurnScreenManager = {
  showTeamTurnScreen() {
    if (ScreenManager.countdownInterval) {
      clearInterval(ScreenManager.countdownInterval);
      ScreenManager.countdownInterval = null;
    }

    this.isTurnCountdownRunning = false;

    const turn = TurnManager.getCurrentTurn();
    if (!turn) {
      GameManager.endGameFlow();
      return;
    }

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    GameTimer.stopTimer();
    GameTimer.resetTimer();

    const shownPlayer = turn.playerName;
    if (DOM.turnTeamNameDisplay) DOM.turnTeamNameDisplay.textContent = team.name;
    if (DOM.turnCurrentPlayerDisplay) DOM.turnCurrentPlayerDisplay.textContent = `Anlatacak Oyuncu: ${shownPlayer}`;

    const tf = StorageManager.gameState.teamFlags.find(x => x.teamId === team.id);
    if (tf && DOM.turnTeamNameDisplay) {
      DOM.turnTeamNameDisplay.style.color = tf.flagColor;
      DOM.turnTeamNameDisplay.style.boxShadow = `0 0 30px ${tf.flagColor}80`;
    }

    this.updateTurnTeamAvatar(team, turn.actualPlayerName || shownPlayer);
    this.updateTeamStats();

    this.removeMissingPlayerMessage();
    this.maybeShowMissingPlayerMessage(turn, team);

    if (DOM.turnCountdownDisplay) DOM.turnCountdownDisplay.style.display = 'none';

    if (DOM.readyBtn) {
      DOM.readyBtn.style.display = 'block';
      DOM.readyBtn.disabled = false;
    }

    ScreenManager.showScreen('teamTurn');
    StorageManager.saveGameStateThrottled(true);
  },

  updateTurnTeamAvatar(team, actualPlayerName) {
    if (!DOM.turnTeamAvatarDisplay) return;

    const gameState = StorageManager.gameState;
    const pa = gameState.playerAvatars.find(x => x.teamId === team.id && x.playerName === actualPlayerName);

    DOM.turnTeamAvatarDisplay.innerHTML = pa
      ? `<img src="${AvatarManager.avatarList[pa.avatarIndex]}" alt="${actualPlayerName}"
          onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>${actualPlayerName}</div>'">`
      : `<div class="avatar-placeholder">?</div>`;
  },

  updateTeamStats() {
    if (!DOM.teamStatsContainer) return;

    const gameState = StorageManager.gameState;
    DOM.teamStatsContainer.innerHTML = '';

    (gameState.teamOrder || []).forEach((team, index) => {
      const correct = Utils.safeArrayAccess(gameState.stats.correctAnswers, index, 0);
      const forbidden = Utils.safeArrayAccess(gameState.stats.forbiddenWords, index, 0);
      const passes = Utils.safeArrayAccess(gameState.stats.passes, index, 0);
      const tf = gameState.teamFlags.find(x => x.teamId === team.id);

      const card = document.createElement('div');
      card.className = 'team-stat-card';
      card.innerHTML = `
        <div class="team-stat-header">
          ${tf ? `
            <div class="team-stat-flag">
              <img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}"
                class="team-stat-flag-image" onerror="this.style.display='none'">
            </div>` :
            `<div class="team-stat-flag"><div class="team-stat-flag-placeholder">?</div></div>`
          }
          <div class="team-stat-name">${team.name}</div>
        </div>
        <div class="team-stat-scores">
          <div class="stat-item">
            <div class="stat-label">Doğru</div>
            <div class="stat-value stat-positive">${correct}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Yasak</div>
            <div class="stat-value stat-negative">${forbidden}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Pas</div>
            <div class="stat-value">${passes}</div>
          </div>
        </div>
      `;
      DOM.teamStatsContainer.appendChild(card);
    });
  },

  removeMissingPlayerMessage() {
    const old = document.getElementById('playerBalanceMessage');
    if (old) old.remove();
  },

  maybeShowMissingPlayerMessage(turn, team) {
    this.removeMissingPlayerMessage();
    if (!turn || !team) return;

    const playerCount = Array.isArray(team.players) ? team.players.length : 0;
    const slotNo = Number(turn.slotNo || 0);

    const shownName = turn.playerName ?? '';
    const realName = turn.actualPlayerName ?? shownName;

    const isMissingSlot = slotNo > playerCount && playerCount > 0 && realName && (shownName !== realName);
    if (!isMissingSlot) return;

    const msg = document.createElement('div');
    msg.id = 'playerBalanceMessage';
    msg.style.maxWidth = '520px';
    msg.style.margin = '10px auto 0';
    msg.style.padding = '10px 14px';
    msg.style.borderRadius = '14px';
    msg.style.background = 'rgba(255, 255, 255, 0.12)';
    msg.style.border = '1px solid rgba(255, 255, 255, 0.18)';
    msg.style.color = 'rgba(255,255,255,0.95)';
    msg.style.fontSize = '0.95rem';
    msg.style.lineHeight = '1.35';
    msg.style.textAlign = 'center';
    msg.style.backdropFilter = 'blur(6px)';

    msg.textContent = `${team.name} takımının ${slotNo}. oyuncusu olmadığı için, ${team.name} oyuncuları arasından ${realName} rastgele seçilmiştir.`;

    if (DOM.turnCurrentPlayerDisplay && DOM.turnCurrentPlayerDisplay.parentNode) {
      DOM.turnCurrentPlayerDisplay.parentNode.insertBefore(msg, DOM.turnCurrentPlayerDisplay.nextSibling);
    } else if (DOM.screens.teamTurn) {
      DOM.screens.teamTurn.appendChild(msg);
    }
  },

  startTurnCountdown() {
    if (!DOM.readyBtn || !DOM.turnCountdownDisplay) return;
    if (this.isTurnCountdownRunning) return;

    GameTimer.stopTimer();
    if (ScreenManager.countdownInterval) {
      clearInterval(ScreenManager.countdownInterval);
      ScreenManager.countdownInterval = null;
    }

    this.isTurnCountdownRunning = true;
    DOM.readyBtn.disabled = true;
    DOM.readyBtn.style.display = 'none';

    DOM.turnCountdownDisplay.style.display = 'flex';
    DOM.turnCountdownDisplay.style.alignItems = 'center';
    DOM.turnCountdownDisplay.style.justifyContent = 'center';

    let countdownText = document.querySelector('.countdown-text');
    if (!countdownText) {
      countdownText = document.createElement('div');
      countdownText.className = 'countdown-text';
      DOM.turnCountdownDisplay.parentNode.insertBefore(countdownText, DOM.turnCountdownDisplay.nextSibling);
    }

    countdownText.textContent = 'Hazır olun! Oyun başlıyor...';
    countdownText.style.display = 'block';
    countdownText.style.margin = '15px auto';

    let countdown = 3;
    DOM.turnCountdownDisplay.innerHTML = `<span>${countdown}</span>`;
    DOM.turnCountdownDisplay.className = 'turn-countdown countdown-3';

    ScreenManager.countdownInterval = setInterval(() => {
      countdown--;

      if (countdown > 0) {
        DOM.turnCountdownDisplay.className = `turn-countdown countdown-${countdown}`;
        DOM.turnCountdownDisplay.innerHTML = `<span>${countdown}</span>`;
        countdownText.textContent = countdown === 2 ? 'Neredeyse hazır...' : 'Son hazırlıklar!';
      } else {
        clearInterval(ScreenManager.countdownInterval);
        ScreenManager.countdownInterval = null;

        DOM.turnCountdownDisplay.innerHTML = `<span>0</span>`;
        countdownText.textContent = 'Başla!';

        setTimeout(() => {
          if (countdownText) countdownText.style.display = 'none';
          this.isTurnCountdownRunning = false;
          GameManager.beginTurn();
        }, 250);
      }

      StorageManager.saveGameStateThrottled();
    }, 1000);
  }
};

// ==========================================
//  OYUN EKRANI YÖNETİCİSİ
// ==========================================
const GameScreenManager = {
  updateGameDisplay() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) { GameManager.endGameFlow(); return; }

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    if (DOM.currentRoundDisplay) DOM.currentRoundDisplay.textContent = `${turn.round}/${StorageManager.gameState.totalRounds}`;
    if (DOM.currentTeamDisplay) DOM.currentTeamDisplay.textContent = team.name;
    if (DOM.currentPlayerDisplay) DOM.currentPlayerDisplay.textContent = turn.playerName;

    this.updatePlayerAvatar(team, turn.actualPlayerName || turn.playerName);
    this.updateTeamFlag(team);
    this.updatePassDisplay();
  },

  updatePlayerAvatar(team, actualPlayerName) {
    if (!DOM.currentPlayerAvatar) return;

    const gameState = StorageManager.gameState;
    const pa = gameState.playerAvatars.find(x => x.teamId === team.id && x.playerName === actualPlayerName);

    DOM.currentPlayerAvatar.innerHTML = pa
      ? `<img src="${AvatarManager.avatarList[pa.avatarIndex]}" alt="${actualPlayerName}"
          onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>${actualPlayerName}</div>'">`
      : `<div class="avatar-placeholder">?</div>`;
  },

  updateTeamFlag(team) {
    if (!DOM.currentTeamFlag) return;

    const gameState = StorageManager.gameState;
    const tf = gameState.teamFlags.find(x => x.teamId === team.id);

    DOM.currentTeamFlag.innerHTML = tf
      ? `<img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}" class="team-flag-image"
          onerror="this.parentElement.innerHTML='<div class=\\'team-flag-placeholder\\'>?</div>'">`
      : `<div class="team-flag-placeholder">?</div>`;
  },

  updatePassDisplay() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) return;

    const team = TurnManager.getTeamById(turn.teamId);
    const passes = team ? (team.passes ?? CONFIG.PASS_LIMIT) : CONFIG.PASS_LIMIT;

    if (DOM.passCountDisplay) DOM.passCountDisplay.textContent = String(passes);
    if (DOM.currentTeamPassLabel && team) DOM.currentTeamPassLabel.textContent = `${team.name} Pas Hakkı`;

    if (DOM.currentTeamPassCount) {
      const dots = DOM.currentTeamPassCount.querySelectorAll('.pass-dot-mobile');
      dots.forEach((dot, idx) => {
        if (idx < passes) dot.classList.remove('used');
        else dot.classList.add('used');
      });
    }
  }
};

// ==========================================
//  KELİME YÖNETİCİSİ
// ==========================================
const WordManager = {
  getWordPoolSafe() {
    if (Array.isArray(window.wordPool)) return window.wordPool;
    try {
      if (typeof wordPool !== 'undefined' && Array.isArray(wordPool)) return wordPool;
    } catch (_) {}
    return null;
  },

  nextCard() {
    const pool = this.getWordPoolSafe();
    if (!Array.isArray(pool) || pool.length === 0) { this.showFallbackCard(); return; }

    const gameState = StorageManager.gameState;
    if (!Array.isArray(gameState.sessionUsedWords)) gameState.sessionUsedWords = [];
    if (!Array.isArray(gameState.usedWords)) gameState.usedWords = [];

    if (gameState.sessionUsedWords.length >= pool.length) gameState.sessionUsedWords = [];

    const available = pool.filter(w =>
      w && typeof w.main === 'string' &&
      Array.isArray(w.forbidden) && w.forbidden.length >= 4 &&
      !gameState.sessionUsedWords.includes(w.main) &&
      !gameState.usedWords.includes(w.main)
    );

    if (available.length === 0) {
      gameState.sessionUsedWords = [];
      return this.nextCard();
    }

    const randomWord = available[Math.floor(Math.random() * available.length)];
    gameState.sessionUsedWords.push(randomWord.main);
    gameState.usedWords.push(randomWord.main);

    if (DOM.gameCard) DOM.gameCard.classList.add('card-exit');

    setTimeout(() => {
      this.displayCard(randomWord);

      if (DOM.gameCard) {
        DOM.gameCard.classList.remove('card-exit');
        DOM.gameCard.classList.add('card-enter');
        setTimeout(() => DOM.gameCard.classList.remove('card-enter'), 500);
      }

      StorageManager.saveGameStateThrottled();
    }, 220);
  },

  displayCard(word) {
    if (DOM.mainWordDisplay) DOM.mainWordDisplay.textContent = word.main;
    if (DOM.forbiddenWord1) DOM.forbiddenWord1.textContent = word.forbidden[0];
    if (DOM.forbiddenWord2) DOM.forbiddenWord2.textContent = word.forbidden[1];
    if (DOM.forbiddenWord3) DOM.forbiddenWord3.textContent = word.forbidden[2];
    if (DOM.forbiddenWord4) DOM.forbiddenWord4.textContent = word.forbidden[3];
  },

  showFallbackCard() {
    if (DOM.mainWordDisplay) DOM.mainWordDisplay.textContent = 'Kelime yok';
    if (DOM.forbiddenWord1) DOM.forbiddenWord1.textContent = '-';
    if (DOM.forbiddenWord2) DOM.forbiddenWord2.textContent = '-';
    if (DOM.forbiddenWord3) DOM.forbiddenWord3.textContent = '-';
    if (DOM.forbiddenWord4) DOM.forbiddenWord4.textContent = '-';
  }
};

// ==========================================
//  OYUNCU İSTATİSTİK YÖNETİCİSİ
// ==========================================
const PlayerStatsManager = {
  ensurePlayerStats() {
    const gameState = StorageManager.gameState;
    if (!Array.isArray(gameState.playerStats) || gameState.playerStats.length === 0) {
      gameState.playerStats = gameState.teams.map(team => ({
        teamId: team.id,
        players: team.players.map(name => new GameModels.PlayerStat(name))
      }));
    }
  },

  getPlayerStat(teamId, playerName) {
    this.ensurePlayerStats();
    const gameState = StorageManager.gameState;

    const teamStats = gameState.playerStats.find(ts => ts.teamId === teamId);
    if (!teamStats) return null;

    let ps = teamStats.players.find(p => p.name === playerName);
    if (!ps) {
      ps = new GameModels.PlayerStat(playerName);
      teamStats.players.push(ps);
    }
    return ps;
  },

  recomputeTeamScoresFromPlayerStats() {
    this.ensurePlayerStats();
    const gameState = StorageManager.gameState;

    gameState.teams.forEach(team => {
      const ts = gameState.playerStats.find(x => x.teamId === team.id);
      if (!ts) return;
      team.score = ts.players.reduce((sum, p) => sum + ((p.correct || 0) - (p.forbidden || 0)), 0);
    });

    if (Array.isArray(gameState.teamOrder)) {
      gameState.teamOrder.forEach(t => {
        const real = gameState.teams.find(x => x.id === t.id);
        if (real) t.score = real.score;
      });
    }
  }
};

// ==========================================
//  TIMER YÖNETİCİSİ
// ==========================================
const GameTimer = {
  timerInterval: null,

  startTimer() {
    const gameState = StorageManager.gameState;
    this.normalizeTimerState();
    if (gameState.timer.running && !gameState.timer.paused) return;

    let remaining;
    if (gameState.timer.paused && gameState.timer.remainingSec > 0) {
      remaining = gameState.timer.remainingSec;
      console.log(`Pause'dan devam: ${remaining} saniye kaldı`);
    } else {
      remaining = parseInt(gameState.timer.remainingSec, 10);
      if (Number.isNaN(remaining) || remaining < 1) remaining = gameState.timer.durationSec;
    }

    gameState.timer.remainingSec = remaining;
    gameState.timer.endTimeMs = Date.now() + remaining * 1000;
    gameState.timer.running = true;
    gameState.timer.paused = false;

    this.updateTimerDisplay(remaining);

    if (this.timerInterval) clearInterval(this.timerInterval);

    this.timerInterval = setInterval(() => {
      if (!gameState.timer.running || gameState.timer.paused) return;

      const rem = Math.max(0, Math.ceil((gameState.timer.endTimeMs - Date.now()) / 1000));
      gameState.timer.remainingSec = rem;
      this.updateTimerDisplay(rem);

      if (rem <= 0) {
        clearInterval(this.timerInterval);
        this.timerInterval = null;
        gameState.timer.running = false;
        gameState.timer.remainingSec = 0;
        StorageManager.saveGameStateThrottled(true);
        this.timeUp();
        return;
      }

      StorageManager.saveGameStateThrottled();
    }, 250);

    StorageManager.saveGameStateThrottled(true);
  },

  stopTimer() {
    if (this.timerInterval) { clearInterval(this.timerInterval); this.timerInterval = null; }

    const gameState = StorageManager.gameState;
    if (!gameState.timer) {
      gameState.timer = {
        durationSec: CONFIG.TURN_SECONDS_DEFAULT,
        running: false,
        paused: false,
        endTimeMs: null,
        remainingSec: CONFIG.TURN_SECONDS_DEFAULT,
        originalEndTimeMs: null
      };
    }

    this.normalizeTimerState();

    if (gameState.timer.running && !gameState.timer.paused) {
      const rem = Math.max(0, Math.ceil((gameState.timer.endTimeMs - Date.now()) / 1000));
      gameState.timer.remainingSec = rem;
      gameState.timer.running = false;
      gameState.timer.paused = true;
      gameState.timer.originalEndTimeMs = gameState.timer.endTimeMs;
      gameState.timer.endTimeMs = null;
      console.log(`Timer durduruldu: ${rem} saniye kaydedildi`);
    }

    this.updateTimerDisplay(gameState.timer.remainingSec);
  },

  resetTimer() {
    const gameState = StorageManager.gameState;
    this.normalizeTimerState();

    gameState.timer.running = false;
    gameState.timer.paused = false;
    gameState.timer.endTimeMs = null;
    gameState.timer.originalEndTimeMs = null;
    gameState.timer.remainingSec = gameState.timer.durationSec;

    this.updateTimerDisplay(gameState.timer.remainingSec);
  },

  normalizeTimerState() {
    const gameState = StorageManager.gameState;
    if (!gameState.timer || typeof gameState.timer !== 'object') {
      gameState.timer = {
        durationSec: CONFIG.TURN_SECONDS_DEFAULT,
        running: false,
        paused: false,
        endTimeMs: null,
        remainingSec: CONFIG.TURN_SECONDS_DEFAULT,
        originalEndTimeMs: null
      };
    }

    let d = parseInt(gameState.timer.durationSec, 10);
    if (Number.isNaN(d) || d < 1) d = CONFIG.TURN_SECONDS_DEFAULT;
    gameState.timer.durationSec = d;

    let r = parseInt(gameState.timer.remainingSec, 10);
    if (Number.isNaN(r) || r < 0) r = d;
    gameState.timer.remainingSec = r;

    if (gameState.timer.endTimeMs != null && typeof gameState.timer.endTimeMs !== 'number') gameState.timer.endTimeMs = null;
    if (gameState.timer.originalEndTimeMs != null && typeof gameState.timer.originalEndTimeMs !== 'number') gameState.timer.originalEndTimeMs = null;

    if (typeof gameState.timer.running !== 'boolean') gameState.timer.running = false;
    if (typeof gameState.timer.paused !== 'boolean') gameState.timer.paused = false;
  },

  updateTimerDisplay(sec) {
    const s = Utils.clamp(sec, 0, 999);
    if (DOM.timerDisplay) {
      DOM.timerDisplay.textContent = String(s);
      if (s <= 10) DOM.timerDisplay.classList.add('timer-warning');
      else DOM.timerDisplay.classList.remove('timer-warning');
    }
  },

  timeUp() {
    console.log('Süre doldu!');
    this.stopTimer();

    const hasNext = TurnManager.advanceTurnIndex();
    if (!hasNext) return; // endGameFlow çağrıldı

    StorageManager.saveGameStateThrottled(true);
    TeamTurnScreenManager.showTeamTurnScreen();
  }
};

// ==========================================
//  EŞİTLİK YÖNETİCİSİ - SENİN MANTIĞINLA
// ==========================================
const TieManager = {
  groupTeamsByScore(teams) {
    const groups = {};
    teams.forEach(team => {
      const score = team.score || 0;
      if (!groups[score]) groups[score] = [];
      groups[score].push(team);
    });
    return groups;
  },

  // ✅ SENİN İSTEDİĞİN: eşit olan hangi skor grubuysa o grup(lar) uzatmaya gider
  checkAndHandleTiesAtEnd() {
    PlayerStatsManager.recomputeTeamScoresFromPlayerStats();
    const gameState = StorageManager.gameState;

    const sortedTeams = [...gameState.teams].sort((a, b) => (b.score || 0) - (a.score || 0));
    const scoreGroups = this.groupTeamsByScore(sortedTeams);
    const tiedGroups = Object.values(scoreGroups).filter(g => g.length > 1);

    if (tiedGroups.length === 0) {
      if (gameState.tie) {
        gameState.tie.isTie = false;
        gameState.tie.phase = 'none';
      }
      return false;
    }

    const playoffTeams = tiedGroups.flat();

    gameState.tie.isTie = true;
    gameState.tie.phase = 'pending';
    gameState.tie.tieTeams = playoffTeams;
    gameState.tie.tieRoundsCompleted = 0;
    gameState.tie.maxTieRounds = 1;

    gameState.tie.originalScores = {};
    gameState.teams.forEach(team => { gameState.tie.originalScores[team.id] = team.score || 0; });

    console.log('Eşitlik bulundu. Uzatmaya gidecek takımlar:', playoffTeams.map(t => t.name).join(', '));

    this.showTieScreen();
    StorageManager.saveGameStateThrottled(true);
    return true;
  },

  showTieScreen() {
    this.renderTieScreen();
    ScreenManager.showScreen('tie');
  },

  renderTieScreen() {
    if (!DOM.tieTeamsContainer || !DOM.tieExplanationContainer) return;

    const gameState = StorageManager.gameState;
    DOM.tieTeamsContainer.innerHTML = '';
    DOM.tieExplanationContainer.innerHTML = '';

    const sortedTeams = [...gameState.teams].sort((a, b) => (b.score || 0) - (a.score || 0));
    const scoreGroups = this.groupTeamsByScore(sortedTeams);
    const allTiedGroups = Object.values(scoreGroups).filter(group => group.length > 1);

    const tiedTeams = gameState.tie.tieTeams || [];
    tiedTeams.forEach(team => {
      const el = document.createElement('div');
      el.className = 'tie-team';
      const tf = gameState.teamFlags.find(x => x.teamId === team.id);
      el.innerHTML = `
        <div class="tie-team-name">${team.name}</div>
        <div class="tie-team-score">${team.score || 0} puan</div>
        ${tf ? `
          <div style="margin-top:10px;">
            <img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}"
              style="width:40px;height:40px;object-fit:contain;">
          </div>` : ''
        }
      `;
      DOM.tieTeamsContainer.appendChild(el);
    });

    let explanationText = `<p>Normal turlar tamamlandı! Eşit puanlar bulundu:</p>`;
    allTiedGroups.forEach(group => {
      const score = group[0].score || 0;
      const names = group.map(t => t.name).join(', ');
      explanationText += `<p><strong>${names}</strong> takımları ${score} puanla eşit.</p>`;
    });

    explanationText += `
      <p><strong>Sadece eşit puana sahip takımlar</strong> 1 tur uzatma oynayacak.</p>
      <p>Eşit olmayan takımların sıralaması korunur.</p>
    `;

    DOM.tieExplanationContainer.innerHTML = explanationText;
  },

  // ✅ Uzatmayı başlat
  continueTieGame() {
    const gameState = StorageManager.gameState;
    const tiedTeamIds = new Set((gameState.tie.tieTeams || []).map(t => t.id));

    const ordered = (gameState.teamOrder?.length ? gameState.teamOrder : gameState.teams)
      .filter(t => tiedTeamIds.has(t.id))
      .map(t => ({ ...t }));

    gameState.teamOrder = ordered;

    gameState.tie.phase = 'playing';
    gameState.tie.tieRoundsCompleted = (gameState.tie.tieRoundsCompleted || 0) + 1;

    gameState.turnSchedule = TurnManager.buildTurnSchedule(gameState.teamOrder, gameState.tie.maxTieRounds || 1);
    gameState.currentTurnIndex = 0;

    GameTimer.stopTimer();
    if (gameState.timer) {
      gameState.timer.remainingSec = gameState.timer.durationSec;
      gameState.timer.running = false;
      gameState.timer.paused = false;
      gameState.timer.endTimeMs = null;
      gameState.timer.originalEndTimeMs = null;
    }

    StorageManager.saveGameStateThrottled(true);
    TeamTurnScreenManager.showTeamTurnScreen();
  },

  computeFinalRankingWithTie() {
    const gameState = StorageManager.gameState;

    const originalScores = gameState.tie?.originalScores || {};
    const tiedTeamIds = new Set((gameState.tie.tieTeams || []).map(t => t.id));

    const teams = gameState.teams.map(t => ({
      ...t,
      originalScore: Number.isFinite(originalScores[t.id]) ? originalScores[t.id] : (t.score || 0),
      currentScore: t.score || 0,
      isPlayoffTeam: tiedTeamIds.has(t.id)
    }));

    teams.sort((a, b) => {
      if (b.originalScore !== a.originalScore) return b.originalScore - a.originalScore;
      if (b.currentScore !== a.currentScore) return b.currentScore - a.currentScore;
      return (a.id || 0) - (b.id || 0);
    });

    return teams;
  },

  computeFinalRanking() {
    const gameState = StorageManager.gameState;
    if (!gameState.tie?.isTie) return [...gameState.teams].sort((a, b) => (b.score || 0) - (a.score || 0));
    return this.computeFinalRankingWithTie();
  },

  getTeamRankings(orderedTeams) {
    const rankings = {};
    (orderedTeams || []).forEach((t, idx) => { rankings[t.id] = idx + 1; });
    return rankings;
  }
};

// ==========================================
//  OYUN YÖNETİCİSİ
// ==========================================
const GameManager = {
  startGame() {
    const gameState = StorageManager.gameState;
    if (gameState.teams.length < CONFIG.MIN_TEAMS) { alert('En az 2 takım oluşturmalısınız!'); return; }

    gameState.totalRounds = this.normalizeRoundsInput();
    this.resetRuntimeForNewGame();
    gameState.gameStarted = true;

    AvatarManager.selectionState = { currentTeamIndex: 0, currentPlayerIndex: 0 };
    FlagManager.selectionState = { currentTeamIndex: 0 };

    StorageManager.saveGameStateThrottled(true);
    AvatarManager.showAvatarSelectionScreen(false);
  },

  normalizeRoundsInput() {
    let rounds = 10;
    if (DOM.totalRoundsInput) {
      rounds = parseInt(DOM.totalRoundsInput.value, 10);
      if (Number.isNaN(rounds)) rounds = StorageManager.gameState.totalRounds || 10;
      rounds = Utils.clamp(rounds, 1, CONFIG.MAX_ROUNDS);
      DOM.totalRoundsInput.value = rounds;
    }
    return rounds;
  },

  resetRuntimeForNewGame() {
    GameTimer.stopTimer();
    const gameState = StorageManager.gameState;

    gameState.usedWords = [];
    gameState.sessionUsedWords = [];

    // ✅ tie.phase reset
    gameState.tie = {
      isTie: false,
      phase: 'none',
      tieTeams: [],
      tieRoundsCompleted: 0,
      maxTieRounds: 1,
      originalScores: {}
    };

    gameState.turnSchedule = [];
    gameState.currentTurnIndex = 0;

    gameState.diceRolled = false;
    gameState.diceParticipants = [];
    gameState.diceRounds = 0;

    gameState.playerAvatars = [];
    gameState.teamFlags = [];

    gameState.maxSlotsPerTeam = 0;
    gameState.narratorPools = {};

    gameState.stats = {
      passes: gameState.teams.map(() => 0),
      correctAnswers: gameState.teams.map(() => 0),
      forbiddenWords: gameState.teams.map(() => 0)
    };

    PlayerStatsManager.ensurePlayerStats();

    gameState.teams.forEach(t => {
      t.score = 0;
      t.diceValue = 0;
      t.passes = CONFIG.PASS_LIMIT;
    });
  },

  beginTurn() {
    GameTimer.stopTimer();
    GameTimer.normalizeTimerState();

    const gameState = StorageManager.gameState;
    gameState.timer.remainingSec = gameState.timer.durationSec;
    GameTimer.updateTimerDisplay(gameState.timer.remainingSec);

    const turn = TurnManager.getCurrentTurn();
    const team = turn ? TurnManager.getTeamById(turn.teamId) : null;
    if (team) team.passes = CONFIG.PASS_LIMIT;

    GameScreenManager.updateGameDisplay();
    ScreenManager.showScreen('game');

    GameScreenManager.updatePassDisplay();
    WordManager.nextCard();
    GameTimer.startTimer();

    StorageManager.saveGameStateThrottled(true);
  },

  handleCorrectAnswer() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) return;

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    const gameState = StorageManager.gameState;
    const idx = this.getTeamIndexInOrder(team.id);
    if (idx >= 0) gameState.stats.correctAnswers[idx]++;

    const realName = turn.actualPlayerName || turn.playerName;
    const ps = PlayerStatsManager.getPlayerStat(team.id, realName);
    if (ps) ps.correct++;

    team.score = (team.score || 0) + 1;

    if (gameState.teamOrder) {
      const orderTeam = gameState.teamOrder.find(t => t.id === team.id);
      if (orderTeam) orderTeam.score = team.score;
    }

    PlayerStatsManager.recomputeTeamScoresFromPlayerStats();
    GameScreenManager.updateGameDisplay();
    WordManager.nextCard();
    StorageManager.saveGameStateThrottled();
  },

  handleForbiddenWord() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) return;

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    const gameState = StorageManager.gameState;
    const idx = this.getTeamIndexInOrder(team.id);
    if (idx >= 0) gameState.stats.forbiddenWords[idx]++;

    const realName = turn.actualPlayerName || turn.playerName;
    const ps = PlayerStatsManager.getPlayerStat(team.id, realName);
    if (ps) ps.forbidden++;

    team.score = (team.score || 0) - 1;

    if (gameState.teamOrder) {
      const orderTeam = gameState.teamOrder.find(t => t.id === team.id);
      if (orderTeam) orderTeam.score = team.score;
    }

    PlayerStatsManager.recomputeTeamScoresFromPlayerStats();
    GameScreenManager.updateGameDisplay();
    WordManager.nextCard();
    StorageManager.saveGameStateThrottled();
  },

  handlePass() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) return;

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    if ((team.passes ?? 0) > 0) {
      team.passes--;

      const gameState = StorageManager.gameState;
      const idx = this.getTeamIndexInOrder(team.id);
      if (idx >= 0) gameState.stats.passes[idx]++;

      const realName = turn.actualPlayerName || turn.playerName;
      const ps = PlayerStatsManager.getPlayerStat(team.id, realName);
      if (ps) ps.passes++;

      GameScreenManager.updatePassDisplay();
      WordManager.nextCard();
      StorageManager.saveGameStateThrottled();
    }
  },

  getTeamIndexInOrder(teamId) {
    const gameState = StorageManager.gameState;
    return (gameState.teamOrder || []).findIndex(t => t.id === teamId);
  },

  // ✅ KRİTİK: uzatma bittiğinde tekrar tie kontrolüne girme
  endGameFlow() {
    PlayerStatsManager.recomputeTeamScoresFromPlayerStats();
    const gameState = StorageManager.gameState;

    // Uzatma bitti -> direkt final
    if (gameState.tie?.phase === 'playing') {
      gameState.tie.phase = 'resolved';
      StorageManager.saveGameStateThrottled(true);
      this.finalizeGameWithRanking();
      return;
    }

    // Normal oyun bitti -> tie kontrol
    if (TieManager.checkAndHandleTiesAtEnd()) return;

    this.finalizeGameWithRanking();
  },

  finalizeGameWithRanking() {
    ScreenManager.clearAllIntervals();
    GameTimer.stopTimer();

    const orderedTeams = TieManager.computeFinalRanking();
    if (!orderedTeams.length) return;

    const winnerTeam = orderedTeams[0];
    if (DOM.winnerTeamNameDisplay) DOM.winnerTeamNameDisplay.textContent = `${winnerTeam.name} Kazandı!`;

    this.renderFinalScores(orderedTeams);
    this.createStatsTable(orderedTeams);

    ScreenManager.showScreen('winner');
    this.createConfetti();

    StorageManager.clearAll();
  },

  renderFinalScores(orderedTeams) {
    if (!DOM.finalScoresContainer) return;

    DOM.finalScoresContainer.innerHTML = '';
    orderedTeams.forEach(team => {
      const el = document.createElement('div');
      el.className = 'final-score';
      el.innerHTML = `
        <div class="score-value ${team.color}-score">${team.score ?? 0}</div>
        <div class="score-label">${team.name}</div>
      `;
      DOM.finalScoresContainer.appendChild(el);
    });
  },

  createStatsTable(sortedTeams) {
    if (!DOM.statsTableContainer) return;

    const orderedTeams = (Array.isArray(sortedTeams) && sortedTeams.length) ? sortedTeams : TieManager.computeFinalRanking();
    const rankings = TieManager.getTeamRankings(orderedTeams);

    const rowsHtml = orderedTeams.map(team => {
      const idx = this.getTeamIndexInOrder(team.id);
      const correct = idx >= 0 ? Utils.safeArrayAccess(StorageManager.gameState.stats.correctAnswers, idx, 0) : 0;
      const forbidden = idx >= 0 ? Utils.safeArrayAccess(StorageManager.gameState.stats.forbiddenWords, idx, 0) : 0;
      const passes = idx >= 0 ? Utils.safeArrayAccess(StorageManager.gameState.stats.passes, idx, 0) : 0;

      const rank = rankings[team.id] || '-';

      return `
        <tr>
          <td>${rank}</td>
          <td>${team.name}</td>
          <td>${team.score ?? 0}</td>
          <td>${correct}</td>
          <td>${forbidden}</td>
          <td>${passes}</td>
        </tr>
      `;
    }).join('');

    DOM.statsTableContainer.innerHTML = `
      <h3 style="margin-bottom: 20px;">Oyun İstatistikleri</h3>
      <table class="stats-table">
        <thead>
          <tr>
            <th>Sıralama</th>
            <th>Takım</th>
            <th>Puan (Net: Doğru - Yasak)</th>
            <th>Toplam Doğru</th>
            <th>Toplam Yasak</th>
            <th>Pas Kullanımı</th>
          </tr>
        </thead>
        <tbody>${rowsHtml}</tbody>
      </table>
    `;
  },

  createConfetti() {
    const confettiCount = 150;
    const colors = ['#ff9a3c', '#00b4db', '#9b59b6', '#2ecc71', '#ff6b6b', '#4cd964'];

    for (let i = 0; i < confettiCount; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';

      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.left = `${Math.random() * 100}%`;

      const size = Math.random() * 10 + 5;
      confetti.style.width = `${size}px`;
      confetti.style.height = `${size}px`;

      const duration = Math.random() * 3 + 2;
      confetti.style.animation = `confetti-fall ${duration}s linear forwards`;

      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), duration * 1000);
    }
  },

  resetGame() {
    ScreenManager.clearAllIntervals();
    StorageManager.clearAll();
    this.initializeNewGame();
  },

  goToMainMenu() {
    this.resetGame();
  },

  initializeNewGame() {
    StorageManager.gameState = new GameModels.GameState();
    TeamManager.addTeam();
    TeamManager.addTeam();
    TeamManager.renderTeams();
    ScreenManager.showScreen('teamSetup');
    StorageManager.saveGameStateThrottled(true);
  }
};

// ==========================================
//  DURAKLATMA YÖNETİCİSİ
// ==========================================
const PauseManager = {
  pauseGame() {
    const activeKey = Utils.getActiveScreenKeyFromDOM();
    StorageManager.gameState.pauseState.screenBeforePause = activeKey;

    GameTimer.normalizeTimerState();

    const gameState = StorageManager.gameState;
    if (gameState.timer.running && !gameState.timer.paused) {
      const rem = Math.max(0, Math.ceil((gameState.timer.endTimeMs - Date.now()) / 1000));
      gameState.timer.remainingSec = rem;
      gameState.timer.running = false;
      gameState.timer.paused = true;
      gameState.timer.endTimeMs = null;
      console.log(`Oyun duraklatıldı: ${rem} saniye kaldı`);
    }

    GameTimer.stopTimer();

    this.updatePauseDisplay();
    ScreenManager.showScreen('pause');
    StorageManager.saveGameStateThrottled(true);
  },

  updatePauseDisplay() {
    const turn = TurnManager.getCurrentTurn();
    if (!turn) return;

    const team = TurnManager.getTeamById(turn.teamId);
    if (!team) return;

    if (DOM.pauseCurrentRoundDisplay) DOM.pauseCurrentRoundDisplay.textContent = `${turn.round}/${StorageManager.gameState.totalRounds}`;
    if (DOM.pauseCurrentTeamDisplay) DOM.pauseCurrentTeamDisplay.textContent = team.name;
    if (DOM.pauseCurrentPlayerDisplay) DOM.pauseCurrentPlayerDisplay.textContent = turn.playerName;

    const tf = StorageManager.gameState.teamFlags.find(x => x.teamId === team.id);
    if (DOM.pauseTeamFlag) {
      DOM.pauseTeamFlag.innerHTML = tf
        ? `<img src="${FlagManager.flagList[tf.flagIndex].image}" alt="${tf.flagName}" class="team-flag-image"
            onerror="this.parentElement.innerHTML='<div class=\\'team-flag-placeholder\\'>?</div>'">`
        : `<div class="team-flag-placeholder">?</div>`;
    }

    const realName = turn.actualPlayerName || turn.playerName;
    const pa = StorageManager.gameState.playerAvatars.find(x => x.teamId === team.id && x.playerName === realName);

    if (DOM.pausePlayerAvatar) {
      DOM.pausePlayerAvatar.innerHTML = pa
        ? `<img src="${AvatarManager.avatarList[pa.avatarIndex]}" alt="${realName}"
            onerror="this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>${realName}</div>'">`
        : `<div class="avatar-placeholder">?</div>`;
    }

    const remainingSec = StorageManager.gameState.timer?.remainingSec || 0;
    if (DOM.pauseTeamScoresContainer) {
      DOM.pauseTeamScoresContainer.innerHTML = '';

      const timeInfo = document.createElement('div');
      timeInfo.className = 'team-score';
      timeInfo.style.gridColumn = '1 / -1';
      timeInfo.style.marginBottom = '15px';
      timeInfo.style.padding = '15px';
      timeInfo.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;width:100%;">
          <div style="font-size:1.2rem;font-weight:bold;margin-bottom:5px;">Kalan Süre</div>
          <div style="font-size:2rem;font-weight:bold;color:#ff6b6b;">${remainingSec} saniye</div>
          <div style="font-size:0.9rem;margin-top:5px;">Devam ettiğinizde bu süreden devam edeceksiniz</div>
        </div>
      `;
      DOM.pauseTeamScoresContainer.appendChild(timeInfo);

      (StorageManager.gameState.teamOrder || []).forEach(t => {
        const el = document.createElement('div');
        el.className = 'team-score';

        const tflag = StorageManager.gameState.teamFlags.find(x => x.teamId === t.id);
        el.innerHTML = `
          ${tflag ? `
            <div class="pause-flag">
              <img src="${FlagManager.flagList[tflag.flagIndex].image}" alt="${tflag.flagName}" class="team-flag-image"
                onerror="this.parentElement.innerHTML='<div class=\\'team-flag-placeholder\\'>?</div>'">
            </div>` :
            `<div class="pause-flag"><div class="team-flag-placeholder">?</div></div>`
          }
          <div class="info-value">${t.score ?? 0}</div>
        `;
        DOM.pauseTeamScoresContainer.appendChild(el);
      });
    }
  },

  resumeGame() {
    if (DOM.resumeBtn) DOM.resumeBtn.disabled = true;
    if (DOM.quitBtn) DOM.quitBtn.disabled = true;
    this.startResumeCountdown();
  },

  startResumeCountdown() {
    const pauseScreenEl = DOM.screens.pause;
    if (!pauseScreenEl) return;

    let countdownElement = document.getElementById('resumeCountdown');
    if (!countdownElement) {
      countdownElement = document.createElement('div');
      countdownElement.id = 'resumeCountdown';
      countdownElement.className = 'countdown';
      pauseScreenEl.querySelector('.pause-options')?.before(countdownElement);
    }

    let countdown = 3;
    countdownElement.textContent = String(countdown);
    countdownElement.style.display = 'block';

    if (ScreenManager.resumeCountdownInterval) clearInterval(ScreenManager.resumeCountdownInterval);

    ScreenManager.resumeCountdownInterval = setInterval(() => {
      countdown--;
      countdownElement.textContent = String(countdown);

      if (countdown <= 0) {
        clearInterval(ScreenManager.resumeCountdownInterval);
        ScreenManager.resumeCountdownInterval = null;

        countdownElement.style.display = 'none';
        if (DOM.resumeBtn) DOM.resumeBtn.disabled = false;
        if (DOM.quitBtn) DOM.quitBtn.disabled = false;

        const previous = StorageManager.gameState.pauseState.screenBeforePause || 'game';

        if (StorageManager.gameState.timer?.paused) StorageManager.gameState.timer.paused = false;

        ScreenManager.showScreen(previous);

        if (previous === 'game') {
          console.log(`Oyun ekranına dönülüyor, kalan süre: ${StorageManager.gameState.timer?.remainingSec} saniye`);
          GameTimer.startTimer();
        }

        StorageManager.saveGameStateThrottled(true);
      }
    }, 1000);
  },

  quitGame() {
    ScreenManager.clearAllIntervals();
    GameManager.resetGame();
  }
};

// ==========================================
//  DEVAM ETME YÖNETİCİSİ
// ==========================================
const ResumeManager = {
  showResumeScreen() {
    const gameState = StorageManager.gameState;
    if (!gameState || !gameState.gameStarted) { GameManager.initializeNewGame(); return; }

    const turn = TurnManager.getCurrentTurn();
    if (!turn) { GameManager.initializeNewGame(); return; }

    PlayerStatsManager.recomputeTeamScoresFromPlayerStats();
    GameTimer.normalizeTimerState();

    const team = TurnManager.getTeamById(turn.teamId);
    const lastSavedStr = gameState.lastSaved ? new Date(gameState.lastSaved).toLocaleString('tr-TR') : 'Bilinmiyor';

    const shownPlayer = turn.playerName ?? '-';
    const realPlayer = turn.actualPlayerName ?? shownPlayer;

    if (DOM.resumeInfo) {
      DOM.resumeInfo.innerHTML = `
        <div class="resume-item">
          <span class="resume-label">Tur:</span>
          <span class="resume-value">${turn.round}/${gameState.totalRounds}</span>
        </div>
        <div class="resume-item">
          <span class="resume-label">Sıradaki Takım:</span>
          <span class="resume-value">${team ? team.name : '-'}</span>
        </div>
        <div class="resume-item">
          <span class="resume-label">Anlatıcı:</span>
          <span class="resume-value">${shownPlayer}${shownPlayer !== realPlayer ? ` <span style="opacity:.7;">(Gerçek: ${realPlayer})</span>` : ''}</span>
        </div>
        <div class="resume-item">
          <span class="resume-label">Takım Skorları:</span>
          <span class="resume-value">${(gameState.teamOrder || []).map(t => `${t.name}: ${t.score ?? 0}`).join(', ')}</span>
        </div>
        <div class="resume-item">
          <span class="resume-label">Kalan Süre:</span>
          <span class="resume-value">${gameState.timer?.remainingSec ?? CONFIG.TURN_SECONDS_DEFAULT} sn</span>
        </div>
        <div class="resume-item">
          <span class="resume-label">Son Kayıt:</span>
          <span class="resume-value">${lastSavedStr}</span>
        </div>
      `;
    }

    ScreenManager.showScreen('resume');
  },

  resumeFromSave() {
    const gameState = StorageManager.gameState;
    if (!gameState || !gameState.gameStarted) { GameManager.initializeNewGame(); return; }

    GameTimer.normalizeTimerState();

    if (gameState.timer.remainingSec === 0 && gameState.timer.running === false) {
      if (TurnManager.advanceTurnIndex()) gameState.timer.remainingSec = gameState.timer.durationSec;
      else return; // endGameFlow çağrıldı
    }

    const active = gameState.activeScreen || 'teamTurn';

    switch (active) {
      case 'game':
        GameScreenManager.updateGameDisplay();
        ScreenManager.showScreen('game');
        WordManager.nextCard();
        GameTimer.startTimer();
        break;

      case 'pause':
        PauseManager.updatePauseDisplay();
        ScreenManager.showScreen('pause');
        break;

      case 'teamTurn':
        TeamTurnScreenManager.showTeamTurnScreen();
        break;

      case 'tie':
        TieManager.showTieScreen();
        break;

      case 'dice':
        DiceManager.showDiceScreen();
        break;

      case 'readyForDice':
        ReadyScreenManager.showReadyForDiceScreen();
        break;

      case 'flagSelection':
        FlagManager.showFlagSelectionScreen(true);
        break;

      case 'avatarSelection':
        AvatarManager.showAvatarSelectionScreen(true);
        break;

      default:
        TeamTurnScreenManager.showTeamTurnScreen();
        break;
    }

    StorageManager.saveGameStateThrottled(true);
  }
};

// ==========================================
//  MODAL YÖNETİCİSİ
// ==========================================
const ModalManager = {
  rulesUnderstood: false,

  openRulesModal() {
    if (!DOM.rulesModal) return;
    DOM.rulesModal.classList.add('active');
    this.rulesUnderstood = false;
    if (DOM.rulesUnderstoodBtn) DOM.rulesUnderstoodBtn.classList.remove('warning');
  },

  closeRulesModal() {
    if (!DOM.rulesModal) return;
    DOM.rulesModal.classList.remove('active');
  },

  attemptCloseRulesModal() {
    if (this.rulesUnderstood) {
      this.closeRulesModal();
    } else if (DOM.rulesUnderstoodBtn) {
      DOM.rulesUnderstoodBtn.classList.add('warning');
      setTimeout(() => DOM.rulesUnderstoodBtn && DOM.rulesUnderstoodBtn.classList.remove('warning'), 2000);
    }
  },

  confirmRules() {
    this.rulesUnderstood = true;
    this.closeRulesModal();
  }
};

// ==========================================
//  PARTİKÜL YÖNETİCİSİ
// ==========================================
const ParticleManager = {
  createParticles() {
    const particlesContainer = document.getElementById('particles');
    if (!particlesContainer) return;

    const particleCount = 30;
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';

      const size = Math.random() * 6 + 2;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${Math.random() * 100}%`;

      const colors = [
        'rgba(255, 154, 60, 0.7)',
        'rgba(0, 180, 219, 0.7)',
        'rgba(155, 89, 182, 0.7)',
        'rgba(46, 204, 113, 0.7)',
        'rgba(255, 255, 255, 0.5)'
      ];
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];

      const duration = Math.random() * 20 + 10;
      particle.style.animationDuration = `${duration}s`;

      const delay = Math.random() * 5;
      particle.style.animationDelay = `${delay}s`;

      particlesContainer.appendChild(particle);
    }
  }
};

// ==========================================
//  KLAVYE KISAYOL YÖNETİCİSİ
// ==========================================
const KeyboardManager = {
  handleKeyboardShortcuts(e) {
    if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) return;

    const activeScreen = document.querySelector('.screen.active-screen');
    if (!activeScreen) return;

    switch (activeScreen.id) {
      case 'gameScreen': this.handleGameScreenShortcuts(e); break;
      case 'pauseScreen': this.handlePauseScreenShortcuts(e); break;
    }
  },

  handleGameScreenShortcuts(e) {
    switch (e.key) {
      case '1':
      case 'a':
        DOM.correctBtn && DOM.correctBtn.click();
        break;
      case '2':
      case 's':
        DOM.passBtn && DOM.passBtn.click();
        break;
      case '3':
      case 'd':
        DOM.forbiddenBtn && DOM.forbiddenBtn.click();
        break;
      case ' ':
      case 'p':
        DOM.pauseBtn && DOM.pauseBtn.click();
        break;
    }
  },

  handlePauseScreenShortcuts(e) {
    switch (e.key) {
      case ' ':
      case 'p':
      case 'Enter':
        DOM.resumeBtn && DOM.resumeBtn.click();
        break;
      case 'Escape':
        DOM.quitBtn && DOM.quitBtn.click();
        break;
    }
  }
};

// ==========================================
//  EVENT LISTENER YÖNETİCİSİ
// ==========================================
const EventManager = {
  initializeEventListeners() {
    if (DOM.startGameBtn) DOM.startGameBtn.addEventListener('click', () => GameManager.startGame());
    if (DOM.playAgainBtn) DOM.playAgainBtn.addEventListener('click', () => GameManager.resetGame());
    if (DOM.mainMenuBtn) DOM.mainMenuBtn.addEventListener('click', () => GameManager.goToMainMenu());

    if (DOM.addTeamBtn) DOM.addTeamBtn.addEventListener('click', () => { TeamManager.addTeam(); StorageManager.saveGameStateThrottled(); });

    if (DOM.rulesBtn) DOM.rulesBtn.addEventListener('click', () => ModalManager.openRulesModal());
    if (DOM.rulesModalBackdrop) DOM.rulesModalBackdrop.addEventListener('click', () => ModalManager.attemptCloseRulesModal());
    if (DOM.rulesModalClose) DOM.rulesModalClose.addEventListener('click', () => ModalManager.attemptCloseRulesModal());
    if (DOM.rulesUnderstoodBtn) DOM.rulesUnderstoodBtn.addEventListener('click', () => ModalManager.confirmRules());

    if (DOM.resumeGameBtn) DOM.resumeGameBtn.addEventListener('click', () => ResumeManager.resumeFromSave());
    if (DOM.newGameBtn) DOM.newGameBtn.addEventListener('click', () => GameManager.initializeNewGame());

    if (DOM.teamReadyBtn) DOM.teamReadyBtn.addEventListener('click', () => AvatarManager.finishTeamAvatarSelection());
    if (DOM.flagReadyBtn) DOM.flagReadyBtn.addEventListener('click', () => FlagManager.finishTeamFlagSelection());

    if (DOM.goToDiceBtn) DOM.goToDiceBtn.addEventListener('click', () => DiceManager.showDiceScreen());

    if (DOM.rollDiceBtn) DOM.rollDiceBtn.addEventListener('click', () => DiceManager.rollDice());

    if (DOM.startAfterDiceBtn) {
      DOM.startAfterDiceBtn.addEventListener('click', () => {
        const gameState = StorageManager.gameState;
        gameState.turnSchedule = TurnManager.buildTurnSchedule(gameState.teamOrder, gameState.totalRounds);
        gameState.currentTurnIndex = 0;
        GameTimer.stopTimer();
        StorageManager.saveGameStateThrottled(true);
        TeamTurnScreenManager.showTeamTurnScreen();
      });
    }

    if (DOM.readyBtn) DOM.readyBtn.addEventListener('click', () => TeamTurnScreenManager.startTurnCountdown());

    if (DOM.correctBtn) DOM.correctBtn.addEventListener('click', () => GameManager.handleCorrectAnswer());
    if (DOM.passBtn) DOM.passBtn.addEventListener('click', () => GameManager.handlePass());
    if (DOM.forbiddenBtn) DOM.forbiddenBtn.addEventListener('click', () => GameManager.handleForbiddenWord());
    if (DOM.pauseBtn) DOM.pauseBtn.addEventListener('click', () => PauseManager.pauseGame());

    if (DOM.resumeBtn) DOM.resumeBtn.addEventListener('click', () => PauseManager.resumeGame());
    if (DOM.quitBtn) DOM.quitBtn.addEventListener('click', () => PauseManager.quitGame());

    if (DOM.continueTieBtn) DOM.continueTieBtn.addEventListener('click', () => TieManager.continueTieGame());

if (DOM.totalRoundsInput) {
  const picker = document.querySelector('.rounds-picker');
  const pills = picker ? Array.from(picker.querySelectorAll('.rounds-pill')) : [];

  const applyRoundsUI = (value) => {
    const v = Utils.clamp(parseInt(value, 10) || CONFIG.MAX_ROUNDS, 1, CONFIG.MAX_ROUNDS);

    // hidden input (mevcut sistemin kullandığı)
    DOM.totalRoundsInput.value = v;

    // state
    StorageManager.gameState.totalRounds = v;

    // UI
    pills.forEach(btn => {
      const r = parseInt(btn.getAttribute('data-round'), 10);
      const active = r === v;
      btn.classList.toggle('is-active', active);
      btn.setAttribute('aria-pressed', active ? 'true' : 'false');
    });

    StorageManager.saveGameStateThrottled();
  };

  // İlk açılışta: saved state varsa onu, yoksa input/value’yu uygula
  const initial = StorageManager.gameState?.totalRounds ?? parseInt(DOM.totalRoundsInput.value, 10) ?? CONFIG.MAX_ROUNDS;
  applyRoundsUI(initial);

  // Buton click
  pills.forEach(btn => {
    btn.addEventListener('click', () => {
      const r = parseInt(btn.getAttribute('data-round'), 10);
      applyRoundsUI(r);
    });
  });
}



    document.addEventListener('keydown', (e) => KeyboardManager.handleKeyboardShortcuts(e));
  }
};

// ==========================================
//  OTOMATİK KAYDETME YÖNETİCİSİ
// ==========================================
const AutoSaveManager = {
  startAutoSave() {
    setInterval(() => {
      const gameState = StorageManager.gameState;
      if (gameState && gameState.gameStarted && !(gameState.timer?.paused)) StorageManager.saveGameStateThrottled();
    }, CONFIG.AUTOSAVE_MS);
  },

  startCleanup() {
    setInterval(() => StorageManager.cleanupGameState(), CONFIG.CLEANUP_MS);
  }
};

// ==========================================
//  FIX.HTML ÇIKIŞ ONAYI (STABİL + 3sn YÖNLENDİRME)
//  MODAL KİLİT + SCROLL ENGEL
// ==========================================
const FixLeaveModal = {
  init() {
    const fixLink = document.querySelector('.footer-fix');
    const modal = document.getElementById('leaveModal');
    if (!fixLink || !modal) return;

    const box = modal.querySelector('.leave-box');
    const cancelBtn = modal.querySelector('.leave-cancel');
    const confirmBtn = modal.querySelector('.leave-confirm');
    const statusWrap = modal.querySelector('.leave-status');
    const statusText = modal.querySelector('.leave-status-text');

    let targetUrl = 'fix.html';
    let timerId = null;
    let lastFocusEl = null;
    let isRedirecting = false;

    const setStatus = (on) => {
      if (!statusWrap) return;
      statusWrap.hidden = !on;
      if (statusText) statusText.textContent = on ? 'Yönlendiriliyorsunuz…' : '';
    };

    const lockButtons = (locked) => {
      if (cancelBtn) cancelBtn.disabled = locked;
      if (confirmBtn) {
        confirmBtn.disabled = locked;
        confirmBtn.textContent = locked ? 'Yükleniyor…' : 'Devam Et';
      }
    };

    const openModal = (url) => {
      lastFocusEl = document.activeElement;
      targetUrl = url || fixLink.getAttribute('href') || 'fix.html';

      isRedirecting = false;
      if (timerId) clearTimeout(timerId);

      setStatus(false);
      lockButtons(false);

      document.body.classList.add('modal-open');

      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden', 'false');

      setTimeout(() => (confirmBtn || box)?.focus?.(), 0);
    };

    const closeModal = () => {
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden', 'true');

      document.body.classList.remove('modal-open');

      isRedirecting = false;
      setStatus(false);
      lockButtons(false);

      if (timerId) clearTimeout(timerId);

      lastFocusEl?.focus?.();
      lastFocusEl = null;
    };

    const startRedirectFlow = () => {
      if (isRedirecting) return;
      isRedirecting = true;

      lockButtons(true);
      setStatus(true);
      modal.classList.add('is-loading');

      timerId = setTimeout(() => window.location.assign(targetUrl), 3000);
    };

    fixLink.addEventListener('click', (e) => { e.preventDefault(); openModal(fixLink.getAttribute('href')); });
    cancelBtn?.addEventListener('click', () => { if (!isRedirecting) closeModal(); });
    confirmBtn?.addEventListener('click', startRedirectFlow);

    modal.addEventListener('click', (e) => { if (e.target === modal && !isRedirecting) closeModal(); });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('is-open') && !isRedirecting) closeModal();
    });
  }
};

// ==========================================
//  UYGULAMA BAŞLATICI
// ==========================================
const App = {
  initialize() {
    ParticleManager.createParticles();

    const hasSaved = StorageManager.loadGameState();

    if (hasSaved && StorageManager.gameState && StorageManager.gameState.gameStarted) {
      ResumeManager.showResumeScreen();
    } else {
      GameManager.initializeNewGame();
    }

    EventManager.initializeEventListeners();
    AutoSaveManager.startAutoSave();
    AutoSaveManager.startCleanup();

    window.addEventListener('beforeunload', () => {
      const gameState = StorageManager.gameState;
      if (gameState && gameState.gameStarted) StorageManager.saveGameStateThrottled(true);
    });

    document.addEventListener('visibilitychange', () => {
      if (document.hidden && StorageManager.gameState &&
        StorageManager.gameState.timer?.running &&
        !StorageManager.gameState.timer.paused) {
        PauseManager.pauseGame();
        StorageManager.saveGameStateThrottled(true);
      }
    });

    FixLeaveModal.init();

    const footerYearEl = document.getElementById('footerYear');
    if (footerYearEl) footerYearEl.textContent = new Date().getFullYear();
  }
};

// ==========================================
//  GLOBAL DEĞİŞKENLER (backward compatibility)
// ==========================================
window.gameState = StorageManager.gameState;
window.showScreen = ScreenManager.showScreen;
window.saveGameStateThrottled = () => StorageManager.saveGameStateThrottled();
window.startTimer = () => GameTimer.startTimer();
window.stopTimerHard = () => GameTimer.stopTimer();
window.nextCard = () => WordManager.nextCard();
window.updateGameDisplay = () => GameScreenManager.updateGameDisplay();
window.updatePassDisplay = () => GameScreenManager.updatePassDisplay();
window.updateTimerDisplay = (sec) => GameTimer.updateTimerDisplay(sec);

// ==========================================
//  UYGULAMAYI BAŞLAT
// ==========================================
window.addEventListener('DOMContentLoaded', () => {
  App.initialize();
});
(function () {
  "use strict";

  const params = new URLSearchParams(window.location.search);
  if (params.get("consent") !== "reject") return;

  // URL'den parametreyi temizle
  try {
    const url = new URL(window.location.href);
    url.searchParams.delete("consent");
    window.history.replaceState({}, "", url.toString());
  } catch (_) {}

  // Stil ekle (tek seferlik)
  if (!document.getElementById("tg-consent-style")) {
    const style = document.createElement("style");
    style.id = "tg-consent-style";
    style.textContent = `
      .tg-consent-toast{
        position:fixed;
        top:20px;
        left:50%;
        transform:translateX(-50%);
        z-index:9999;
        width:min(720px, calc(100% - 32px));
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:16px;
        padding:18px 20px;
        border-radius:var(--radius-lg, 24px);
        background:rgba(255,255,255,0.12);
        border:1px solid rgba(255,255,255,0.18);
        backdrop-filter:blur(15px);
        -webkit-backdrop-filter:blur(15px);
        box-shadow:var(--shadow-lg, 0 20px 50px rgba(0,0,0,.25));
        color:#fff;
        font-family:'Poppins', sans-serif;
        animation:tgToastIn .45s ease forwards;
      }

      @keyframes tgToastIn{
        from{ opacity:0; transform:translate(-50%, -15px) scale(.96); }
        to{ opacity:1; transform:translate(-50%, 0) scale(1); }
      }

      .tg-consent-left{
        display:flex;
        align-items:center;
        gap:14px;
      }

      .tg-consent-icon{
        width:40px;
        height:40px;
        border-radius:14px;
        display:flex;
        align-items:center;
        justify-content:center;
        background:rgba(255,255,255,0.18);
        border:1px solid rgba(255,255,255,0.25);
        font-weight:900;
        font-size:1.2rem;
        color:#ff6b6b;
        box-shadow:0 0 15px rgba(255,107,107,.4);
      }

      .tg-consent-title{
        font-weight:800;
        font-size:1rem;
        margin-bottom:2px;
      }

      .tg-consent-desc{
        font-size:.9rem;
        opacity:.9;
        line-height:1.4;
      }

      .tg-consent-close{
        width:46px;
        height:46px;
        border-radius:16px;
        border:1px solid rgba(255,255,255,.2);
        background:rgba(255,255,255,.12);
        color:#fff;
        font-size:1.1rem;
        font-weight:900;
        cursor:pointer;
        transition:all .25s ease;
      }

      .tg-consent-close:hover{
        background:rgba(255,255,255,.22);
        transform:scale(1.08) rotate(90deg);
      }
    `;
    document.head.appendChild(style);
  }

  // Toast oluştur
  const box = document.createElement("div");
  box.className = "tg-consent-toast";
  box.setAttribute("role", "status");

  box.innerHTML = `
    <div class="tg-consent-left">
      <div class="tg-consent-icon">!</div>
      <div>
        <div class="tg-consent-title">Çerez tercihini reddettiniz</div>
        <div class="tg-consent-desc">
          KVKK kapsamında bazı özellikler (ör. sorun bildirim formu) devre dışı bırakıldı.
        </div>
      </div>
    </div>
    <button class="tg-consent-close" aria-label="Kapat">✕</button>
  `;

  box.querySelector(".tg-consent-close").addEventListener("click", () => {
    box.remove();
  });

  document.body.appendChild(box);

  // Otomatik kapanma
  setTimeout(() => {
    if (box && box.parentNode) box.remove();
  }, 6500);

})();
    </script>
</body>
</html>
