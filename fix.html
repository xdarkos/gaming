<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>TabulaGo - Sorun Bildir</title>

  <!-- PWA / Meta -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="TabulaGo" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#6a11cb" />
  <meta name="msapplication-TileColor" content="#6a11cb" />
  <meta name="msapplication-tap-highlight" content="no" />

  <!-- Performans -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- Fontlar / ikonlar -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
/* ===== CSS DEÄžÄ°ÅžKENLERÄ° ===== */
:root{
  --primary:#6a11cb;
  --secondary:#2575fc;
  --accent:#ff6b6b;
  --success:#4cd964;
  --light:#f8f9fa;
  --dark:#212529;

  --team1:#ff9a3c;
  --team2:#00b4db;
  --team3:#9b59b6;
  --team4:#2ecc71;

  --transition: all .3s cubic-bezier(.25,.8,.25,1);
  --shadow: 0 10px 30px rgba(0,0,0,.15);
  --shadow-lg: 0 20px 50px rgba(0,0,0,.2);

  --radius:16px;
  --radius-lg:24px;

  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-top: env(safe-area-inset-top, 0px);
}

/* ===== RESET / GENEL ===== */
*{ margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif; }
html, body{ max-width:100vw; overflow-x:hidden; }

body{
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  color:#fff;

  -webkit-tap-highlight-color:transparent;
  -webkit-touch-callout:none;
}

input, textarea{
  -webkit-user-select:text;
  user-select:text;
}

.container{ width:100%; max-width:1200px; text-align:center; }

:focus-visible{
  outline: 3px solid rgba(255,255,255,.85);
  outline-offset: 3px;
  border-radius: 10px;
}

@media (prefers-reduced-motion: reduce){
  *{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}

/* =========================================================
   HEADER
========================================================= */
header{
  margin-bottom:30px;
  padding:25px;
  background: rgba(255,255,255,.10);
  border-radius: var(--radius-lg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  box-shadow: var(--shadow);
  position:relative;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.15);
}
header::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:5px;
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}


.subtitle{
  font-size: clamp(1.2rem, 2.5vw, 1.5rem);
  opacity:.9;
  font-weight:300;
  margin-top:10px;
}
.header-logo-wrapper{
  position:absolute;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  pointer-events:none;
  z-index:5;
}
.header-logo{ width:280px; height:auto; display:block; }
header .subtitle{ position:relative; margin-top:140px; z-index:1; }


/* =========================================================
   MAIN CONTENT
========================================================= */
.main-content{
  background: rgba(255,255,255,.10);
  border-radius: var(--radius-lg);
  padding:30px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  margin-bottom:30px;
  border:1px solid rgba(255,255,255,.15);
  position:relative;
  overflow:hidden;
}
.main-content::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:5px;
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* =========================================================
   INFO CARDS
========================================================= */
.info-cards{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
  gap:25px;
  margin:30px 0;
}
.info-card{
  background: rgba(255,255,255,.10);
  border-radius: var(--radius);
  padding:25px;
  text-align:left;
  transition: var(--transition);
  border:1px solid rgba(255,255,255,.10);
  position:relative;
  overflow:hidden;
}
.info-card::before{
  content:"";
  position:absolute;
  top:0; left:0;
  width:6px; height:100%;
  background: linear-gradient(to bottom,var(--team1),var(--team2));
}
.info-card:hover{
  transform: translateY(-5px);
  background: rgba(255,255,255,.15);
  box-shadow: var(--shadow-lg);
}
.info-card-icon{
  width:64px; height:64px;
  margin-bottom:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:16px;
  background: rgba(255,255,255,.10);
  padding:12px;
  transition: var(--transition);
}
.info-card:hover .info-card-icon{
  background: rgba(255,255,255,.20);
  transform: scale(1.05);
}
.info-card-icon img{
  width:100%;
  height:100%;
  object-fit:contain;
  transform: scale(1.90);
  transform-origin:center;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,.25));
}
.info-card-title{
  font-size:1.3rem;
  font-weight:700;
  margin-bottom:12px;
  color:#fff;
}
.info-card-text{
  font-size:1rem;
  line-height:1.6;
  opacity:.9;
}

/* =========================================================
   FORM
========================================================= */
.form-section{ margin:40px 0; }

.form-section-title{
  font-size:1.8rem;
  margin-bottom:25px;
  color:#fff;
  position:relative;
  display:inline-block;
  font-weight:800;
  letter-spacing:-.2px;
}
.form-section-title::after{
  content:"";
  position:absolute;
  bottom:-10px;
  left:50%;
  transform: translateX(-50%);
  width:90px;
  height:4px;
  background: linear-gradient(to right,var(--team1),var(--team2));
  border-radius:2px;
}

.form-group{ margin-bottom:25px; text-align:left; }

.form-label{
  display:block;
  font-size:1.1rem;
  font-weight:700;
  margin-bottom:10px;
  color:#fff;
}

.required{ color: var(--accent); margin-left:3px; }

.form-input,
.form-textarea{
  width:100%;
  padding:16px 20px;
  background: rgba(255,255,255,.10);
  border:2px solid rgba(255,255,255,.20);
  border-radius:12px;
  color:#fff;
  font-size:1rem;
  transition: var(--transition);
  outline:none;
}
.form-input:focus,
.form-textarea:focus{
  background: rgba(255,255,255,.15);
  border-color: var(--team2);
  box-shadow: 0 0 0 3px rgba(0,180,219,.30);
}

.form-textarea{
  min-height:150px;
  resize:vertical;
  font-family:"Poppins",sans-serif;
}

/* =========================================================
   CHECKBOX GRUPLARI
========================================================= */
.checkbox-group{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
  margin-top:10px;
}
.checkbox-label{
  display:flex;
  align-items:center;
  gap:12px;
  cursor:pointer;
  padding:15px;
  background: rgba(255,255,255,.08);
  border-radius:10px;
  transition: var(--transition);
  border:1px solid rgba(255,255,255,.10);
}
.checkbox-label:hover{
  background: rgba(255,255,255,.12);
  transform: translateY(-3px);
}
.checkbox-label input[type="checkbox"]{
  width:20px; height:20px;
  accent-color: var(--team2);
  cursor:pointer;
}
.checkbox-text{ font-size:1rem; font-weight:600; }

/* =========================================================
   ACÄ°LÄ°YET
========================================================= */
.urgency-badges{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}
.urgency-badge{
  padding:12px 20px;
  border-radius:12px;
  font-size:.95rem;
  font-weight:800;
  cursor:pointer;
  transition: var(--transition);
  border:2px solid transparent;
  flex:1;
  text-align:center;
  min-width:100px;
  background: rgba(255,255,255,.08);
  color:#fff;
}
.urgency-badge:hover{ transform: translateY(-3px); }
.urgency-badge.selected{
  border-color:#fff;
  box-shadow: 0 0 15px rgba(255,255,255,.30);
}
.urgency-low{ background: rgba(46,204,113,.18); color:#d7ffe6; }
.urgency-medium{ background: rgba(255,154,60,.18); color:#ffe6cf; }
.urgency-high{ background: rgba(255,107,107,.18); color:#ffe0e0; }
.urgency-critical{ background: rgba(155,89,182,.18); color:#f2e3ff; }

/* =========================================================
   SINIFLANDIRMA KARTLARI (Kategori + Tekrar)
========================================================= */
.classify-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap:14px;
}
@media (max-width: 767px){
  .classify-grid{ grid-template-columns: 1fr; }
}

.classify-card{
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: var(--radius);
  padding:16px;
  box-shadow: 0 10px 22px rgba(0,0,0,.12);
  position:relative;
  overflow:hidden;
}
.classify-card::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 30%, rgba(0,180,219,.16), transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255,154,60,.14), transparent 55%),
    radial-gradient(circle at 70% 90%, rgba(155,89,182,.14), transparent 55%);
  pointer-events:none;
}
.classify-card-inner{ position:relative; z-index:1; }

.classify-head{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}
.classify-icon{
  width:44px; height:44px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.16);
  flex:0 0 auto;
}
.classify-icon i{
  font-size:18px;
  color: rgba(255,255,255,.92);
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
}
.classify-title{
  font-weight:900;
  letter-spacing:-.2px;
  font-size:1.05rem;
}
.classify-desc{
  margin-top:8px;
  color: rgba(255,255,255,.78);
  font-size:.92rem;
  line-height:1.45;
}

/* =========================================================
   CUSTOM SELECT (Bottom Sheet)
========================================================= */
.cs-field{ margin-top:10px; }
.cs-btn{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:16px 18px;
  background: rgba(255,255,255,.10);
  border:2px solid rgba(255,255,255,.20);
  border-radius:12px;
  color:#fff;
  font-size:1rem;
  font-weight:700;
  cursor:pointer;
  transition: var(--transition);
  text-align:left;
}
.cs-btn:focus{
  background: rgba(255,255,255,.15);
  border-color: var(--team2);
  box-shadow: 0 0 0 3px rgba(0,180,219,.30);
  outline:none;
}
.cs-btn .cs-placeholder{ opacity:.85; font-weight:700; }
.cs-btn .cs-value{ font-weight:800; }
.cs-btn .cs-right{
  display:flex; align-items:center; gap:10px;
  opacity:.9;
}
.cs-btn .cs-chip{
  font-size:.78rem;
  font-weight:900;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.10);
}
.cs-btn i{ opacity:.95; }

/* Modal overlay */
.cs-modal{
  position:fixed;
  inset:0;
  z-index:10001;
  display:none;
}
.cs-modal.is-open{ display:block; }
.cs-backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}
.cs-sheet{
  position:absolute;
  left:0; right:0;
  bottom:0;
  padding-bottom: calc(10px + var(--safe-bottom));
  margin: 0 auto;
  width: min(760px, 100%);
  border-radius: 22px 22px 0 0;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  box-shadow: var(--shadow-lg);
  overflow:hidden;
  transform: translateY(0);
}
@media (min-width: 768px){
  .cs-sheet{
    bottom: 8vh;
    border-radius: 22px;
    width: min(760px, calc(100% - 28px));
  }
}
.cs-sheet::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:5px;
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
}
.cs-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:16px 16px 10px;
  position:relative;
  z-index:1;
}
.cs-title{
  font-size:1.05rem;
  font-weight:900;
  display:flex;
  align-items:center;
  gap:10px;
}
.cs-close{
  width:44px; height:44px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
  transition: var(--transition);
}
.cs-close:hover{ transform: translateY(-2px); background: rgba(255,255,255,.12); }
.cs-close:active{ transform: translateY(1px); }
.cs-body{
  padding: 0 16px 16px;
  max-height: 60vh;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
.cs-body::-webkit-scrollbar{ width:0; height:0; }

.cs-list{ display:grid; gap:10px; }
.cs-item{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  cursor:pointer;
  text-align:left;
  color:#fff;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
  transition: var(--transition);
  font-weight:800;
}
.cs-item:hover{ transform: translateY(-2px); background: rgba(255,255,255,.12); }
.cs-item:active{ transform: translateY(1px); }
.cs-item .cs-sub{ font-weight:700; opacity:.78; font-size:.9rem; }
.cs-item.is-selected{
  border-color: rgba(255,255,255,.55);
  box-shadow: 0 0 14px rgba(255,255,255,.18);
}

/* =========================================================
   BUTONLAR
========================================================= */
.btn{
  padding:16px 35px;
  border:none;
  border-radius:50px;
  font-size:1.1rem;
  font-weight:800;
  cursor:pointer;
  transition: var(--transition);
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
  color:#fff;
  box-shadow: var(--shadow);
  position:relative;
  overflow:hidden;
  min-width:180px;
  letter-spacing:.5px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  touch-action: manipulation;
}
.btn::before{
  content:"";
  position:absolute;
  top:0; left:-100%;
  width:100%; height:100%;
  background: linear-gradient(90deg,transparent,rgba(255,255,255,.30),transparent);
  transition:.5s;
}
.btn:hover::before{ left:100%; }
.btn:hover{ transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,.30); }
.btn:active{ transform: translateY(2px); }
.btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
.btn:disabled:hover::before{ left:-100%; }

.button-group{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:40px;
  flex-wrap:wrap;
}
.btn-submit{ background: linear-gradient(to right,var(--success),#2ecc71); }
.btn-back{
  background: rgba(255,255,255,.15);
  border:2px solid rgba(255,255,255,.30);
}
.btn-back:hover{
  background: rgba(255,255,255,.25);
  border-color: rgba(255,255,255,.50);
}

/* =========================================================
   MESAJ KUTULARI
========================================================= */
.message{
  padding:20px;
  border-radius: var(--radius);
  margin:20px 0;
  text-align:center;
  font-weight:700;
  animation: fadeIn .5s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
}
@keyframes fadeIn{
  from{ opacity:0; transform: translateY(-10px); }
  to{ opacity:1; transform: translateY(0); }
}
.message-success{
  background: rgba(76,217,100,.15);
  border:1px solid rgba(76,217,100,.30);
  color:#c7ffd7;
}
.message-error{
  background: rgba(255,107,107,.15);
  border:1px solid rgba(255,107,107,.30);
  color:#ffd1d1;
}

/* =========================================================
   YARDIMCI
========================================================= */
.form-hint{
  font-size:.9rem;
  color: rgba(255,255,255,.70);
  margin-top:8px;
  font-style:italic;
}
.character-count{
  text-align:right;
  font-size:.85rem;
  color: rgba(255,255,255,.70);
  margin-top:5px;
}
.inline-error{
  margin-top:10px;
  padding:12px 14px;
  border-radius:12px;
  background: rgba(255,107,107,.12);
  border:1px solid rgba(255,107,107,.28);
  color:#ffd1d1;
  display:none;
  gap:10px;
  align-items:center;
  font-weight:800;
  line-height:1.35;
}
.inline-error i{ color:#ffb3b3; }

.loading{
  display:inline-block;
  width:20px; height:20px;
  border:3px solid rgba(255,255,255,.30);
  border-radius:50%;
  border-top-color:#fff;
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin{ to{ transform: rotate(360deg); } }

/* =========================================================
   GÄ°ZLÄ°LÄ°K / KVKK KARTI
========================================================= */
.privacy-card{
  margin-top:10px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: var(--radius);
  padding:16px;
  text-align:left;
  position:relative;
  overflow:hidden;
}
.privacy-card::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:4px;
  background: linear-gradient(to right,var(--team1),var(--team2));
}
.privacy-card-title{
  font-weight:900;
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:8px;
}
.privacy-card-title i{
  color: rgba(255,255,255,.92);
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
}
.privacy-card p{
  color: rgba(255,255,255,.86);
  line-height:1.55;
  font-size:.95rem;
}
.privacy-card a{
  color: rgba(255,255,255,.95);
  font-weight:900;
  text-decoration: underline;
  text-underline-offset: 3px;
}

/* =========================================================
   FOOTER
   ========================================================= */

.site-footer{
  width: 100%;
  margin-top: 10px;
  padding-bottom: 12px;
}

/* ana kapsayÄ±cÄ± */
.footer-inner{
  position: relative;
  overflow: hidden;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 14px 18px;

  background: rgba(255,255,255,0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: var(--shadow);
}

/* Ã¼st renk ÅŸeridi */
.footer-inner::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:5px;
  background: linear-gradient(
    to right,
    var(--team1),
    var(--team2),
    var(--team3),
    var(--team4)
  );
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* glow */
.footer-glow{
  position:absolute;
  inset:-40%;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,183,3,.25), transparent 55%),
    radial-gradient(circle at 80% 20%, rgba(255,154,60,.2), transparent 55%),
    radial-gradient(circle at 60% 90%, rgba(155,89,182,.18), transparent 60%);
  filter: blur(14px);
  animation: footerGlowMove 12s linear infinite;
  pointer-events:none;
}

/* iÃ§erik */
.footer-content{
  position: relative;
  z-index: 2;
  display:flex;
  flex-wrap: nowrap;
  align-items:center;
  justify-content:center;
  gap: 10px;
  row-gap: 2px;
  text-align:center;
}

/* designed by */
.footer-text{
  color: rgba(255,255,255,.85);
  font-size:.95rem;
  font-weight:500;
}

/* Eren Ä°lhan */
.footer-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height:44px;
  padding:8px 12px;

  font-weight:800;
  text-decoration:none;
  position:relative;
  border-radius:12px;

  background: linear-gradient(
    135deg,
    #fff6c2 0%,
    #ffd36a 22%,
    #ffb703 50%,
    #e6a100 78%,
    #fff1a8 100%
  );
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;

  text-shadow:
    0 2px 4px rgba(0,0,0,.55),
    0 0 10px rgba(255,183,3,.35);

  transition: transform .25s ease, text-shadow .25s ease, filter .25s ease;
  touch-action: manipulation;
  user-select:none;
}

.footer-link::after{
  content:"";
  position:absolute;
  left:12%;
  right:12%;
  bottom:-4px;
  height:3px;
  border-radius:999px;
  background: linear-gradient(to right,#fff6c2,#ffb703,#e6a100);
  box-shadow:0 0 8px rgba(255,183,3,.6);
  transform:scaleX(0);
  transition:transform .3s ease;
}

.footer-link:hover{
  transform: translateY(-2px) scale(1.03);
  text-shadow:
    0 4px 8px rgba(0,0,0,.65),
    0 0 18px rgba(255,183,3,.6);
  filter:brightness(1.12);
}
.footer-link:hover::after{ transform:scaleX(1); }
.footer-link:active{ transform:scale(.96); }

/* fix logo */
.footer-fix{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:42px;
  min-height:42px;
  margin-left:6px;
  border-radius:50%;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,183,3,.35);
  backdrop-filter: blur(6px);
  transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
}
.footer-fix img{
  width:20px;
  height:20px;
  transform:scale(3.7);
  pointer-events:none;
}
.footer-fix:hover{
  transform: translateY(-1px);
  background: rgba(255,183,3,.15);
  box-shadow:0 0 10px rgba(255,183,3,.45);
}

/* telif */
.footer-legal{
  width:100%;
  display:block;
  margin-top:-2px;
  font-size:.72rem;
  font-weight:500;
  letter-spacing:.3px;
  color: rgba(255,255,255,.42);
  text-align:center;
  user-select:none;
  opacity:.9;
  transition:opacity .25s ease,color .25s ease;
}
.footer-legal strong{
  color: rgba(255,183,3,.85);
  font-weight:800;
}
.site-footer:hover .footer-legal{
  opacity:1;
  color: rgba(255,255,255,.55);
}

/* sparkles */
.footer-sparkles{
  position:absolute;
  inset:0;
  z-index:1;
  pointer-events:none;
}
.spark{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  background: rgba(255,255,255,.7);
  box-shadow:0 0 12px rgba(255,255,255,.6);
  opacity:.35;
  animation:sparkFloat 4.5s ease-in-out infinite;
}
.spark.s1{ left:12%; top:60%; }
.spark.s2{ left:38%; top:32%; animation-delay:1s; }
.spark.s3{ left:70%; top:65%; animation-delay:2s; }
.spark.s4{ left:88%; top:38%; animation-delay:3s; }

@keyframes footerGlowMove{
  0%{ transform:translateX(-2%) rotate(0deg); }
  50%{ transform:translateX(2%) rotate(180deg); }
  100%{ transform:translateX(-2%) rotate(360deg); }
}
@keyframes sparkFloat{
  0%,100%{ transform:translateY(0) scale(1); opacity:.25; }
  50%{ transform:translateY(-10px) scale(1.15); opacity:.55; }
}

/* =========================================================
   LEAVE MODAL
   ========================================================= */

.leave-modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  background: rgba(20,18,40,.65);
  backdrop-filter: blur(8px);
  z-index:9999;
}
.leave-modal.is-open{ display:flex; }

.leave-box{
  position:relative;
  z-index:2;
  width:100%;
  max-width:420px;
  padding:22px 20px;
  border-radius:22px;
  text-align:center;
  background: linear-gradient(160deg, rgba(130,120,200,.95), rgba(100,90,170,.95));
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 25px 60px rgba(0,0,0,.45);
  animation: leaveModalIn .25s ease-out;
}

/* orbit */
.leave-orbit{
  position:absolute;
  width:520px;
  height:520px;
  border-radius:50%;
  pointer-events:none;
  background: conic-gradient(#ffb703,#ff5ec4,#8a5cff,#00f5d4,#ffb703);
  filter:blur(22px);
  opacity:.65;
  animation: orbitSpin 8s linear infinite;
}
.leave-modal .leave-orbit{
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:0;
}

@keyframes orbitSpin{
  from{ transform:translate(-50%,-50%) rotate(0); }
  to{ transform:translate(-50%,-50%) rotate(360deg); }
}

/* logo */
.leave-logo img{
  width:150px;
  filter:drop-shadow(0 6px 14px rgba(0,0,0,.35));
}

/* metinler */
.leave-warning{
  font-size:1.15rem;
  font-weight:800;
  color:#ffe29a;
  text-shadow:0 2px 8px rgba(255,183,3,.45);
}
.leave-subinfo{
  font-size:.9rem;
  color: rgba(255,255,255,.5);
  margin-top:6px;
}
.leave-subinfo strong{
  color:#ffb703;
  font-weight:800;
  font-size:1.08em;
}

/* butonlar */
.leave-actions{
  display:flex;
  gap:12px;
}
.leave-actions button{
  flex:1;
  height:46px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
}
.leave-cancel{
  background: rgba(255,255,255,.15);
  color:#fff;
}
.leave-confirm{
  background: linear-gradient(135deg,#ffe29a,#ffb703);
  color:#2b2b2b;
}

/* loading */
.leave-status[hidden]{ display:none!important; }
.leave-status{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin:8px 0 18px;
}
.leave-spinner{
  width:18px;
  height:18px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;
  animation: spin .8s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg); } }

@keyframes leaveModalIn{
  from{ opacity:0; transform:translateY(10px) scale(.97); }
  to{ opacity:1; transform:none; }
}

/* scroll kilidi */
body.modal-open{
  overflow:hidden;
  touch-action:none;
}

/* mobil */
@media(max-width:480px){
  .leave-box{ padding:20px 16px; }
  .leave-logo img{ width:130px; }
}


.footer-instagram{
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.footer-instagram{
  display: inline-flex;
  align-items: center;
  gap: 6px;                 /* ikon â€“ yazÄ± arasÄ± */
}

/* ================================
   Instagram Icon (Premium & Stabil)
   ================================ */

.ig-icon{
  width: 16px;
  height: 16px;
  object-fit: contain;

  /* GÃ¶rÃ¼nÃ¼m */
  opacity: 0.88;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.35));

  /* Sadece ikon bÃ¼yÃ¼r */
  transform: scale(1.7);
  transform-origin: center;

  /* AkÄ±cÄ± animasyon */
  transition:
    transform .22s cubic-bezier(.4,0,.2,1),
    opacity .22s ease,
    filter .22s ease;

  pointer-events: none; /* link alanÄ±nÄ± bozmaz */
}

/* Hover â€“ desktop */
.footer-instagram:hover .ig-icon{
  opacity: 1;
  transform: scale(1.6);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.45));
}

/* Active â€“ dokunma hissi */
.footer-instagram:active .ig-icon{
  transform: scale(1.45);
}

/* ================================
   Mobil Optimizasyon
   ================================ */

@media (max-width: 767px){
  .ig-icon{
    width: 18px;
    height: 18px;

    transform: scale(1.55);
  }

  /* mobilde hover yok â†’ stabil kalsÄ±n */
  .footer-instagram:hover .ig-icon{
    transform: scale(1.55);
  }
}
.rules-icon{
  width: 22px;
  height: 22px;
  object-fit: contain;
  vertical-align: middle;
  margin-right: 8px;

  transform: scale(4) translateX(1px);   /* ðŸ”¥ sadece gÃ¶rsel bÃ¼yÃ¼r */
  transform-origin: center;
}

/* =========================================================
   PARTICLES
========================================================= */
.floating-particles{
  position:fixed;
  top:0; left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:-1;
}
.particle{
  position:absolute;
  width:6px; height:6px;
  background: rgba(255,255,255,.50);
  border-radius:50%;
  animation: float 15s infinite linear;
}
@keyframes float{
  0%{ transform: translateY(100vh) rotate(0deg); opacity:0; }
  10%{ opacity:1; }
  90%{ opacity:1; }
  100%{ transform: translateY(-100px) rotate(360deg); opacity:0; }
}

/* =========================================================
   SAFE AREA SUPPORT
========================================================= */
@supports (padding: max(0px)){
  .container{
    padding-left: max(10px, env(safe-area-inset-left));
    padding-right: max(10px, env(safe-area-inset-right));
    padding-bottom: max(10px, env(safe-area-inset-bottom));
  }
  body{ padding-top: max(10px, env(safe-area-inset-top)); }
}

/* =========================================================
   iOS Ã–ZEL
========================================================= */
@supports (-webkit-touch-callout: none){
  .btn{ -webkit-appearance:none; border-radius:50px; }
  input, textarea{ border-radius:12px; }
}

/* =========================================================
   COOKIE BANNER + MODAL
========================================================= */
.cookie-banner{
  position:fixed;
  left:16px;
  right:16px;
  bottom: calc(16px + var(--safe-bottom));
  z-index:9999;
  display:none;
}
.cookie-banner.is-open{ display:block; }

.cookie-banner-inner{
  max-width:1200px;
  margin:0 auto;
  display:flex;
  align-items:flex-start;
  gap:14px;
  padding:16px;
  border-radius: var(--radius-lg);
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: var(--shadow-lg);
  position:relative;
  overflow:hidden;
}
.cookie-banner-inner::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:5px;
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.cookie-banner-icon{
  width:46px;
  height:46px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.14);
  flex:0 0 auto;
}
.cookie-banner-icon i{
  font-size:20px;
  color: rgba(255,255,255,.92);
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
}

.cookie-banner-text{ flex:1; min-width:220px; }
.cookie-banner-title{ font-weight:900; letter-spacing:-.2px; margin-bottom:6px; }
.cookie-banner-desc{
  font-size:.95rem;
  line-height:1.5;
  color: rgba(255,255,255,.88);
}
.cookie-banner-desc a{
  color: rgba(255,255,255,.95);
  font-weight:900;
  text-decoration: underline;
  text-underline-offset: 3px;
}

.cookie-banner-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
  align-items:center;
  flex:0 0 auto;
}

.cookie-btn{
  border:none;
  border-radius:999px;
  padding:12px 16px;
  font-weight:900;
  cursor:pointer;
  transition: var(--transition);
  box-shadow: var(--shadow);
  min-height:44px;
  touch-action: manipulation;
  color:#fff;
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
}
.cookie-btn:hover{ transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.cookie-btn:active{ transform: translateY(1px); }

.cookie-btn-primary{
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
  border:0;
}
.cookie-btn-secondary{ background: rgba(255,255,255,.14); }
.cookie-btn-ghost{
  background: rgba(255,255,255,.07);
  border: 1px solid rgba(255,255,255,.14);
}

/* Modal */
.cookie-modal{
  position:fixed;
  inset:0;
  z-index:10000;
  display:none;
}
.cookie-modal.is-open{ display:block; }

.cookie-modal-backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}

.cookie-modal-content{
  position:relative;
  width: min(760px, calc(100% - 28px));
  margin: 8vh auto 0 auto;
  border-radius: var(--radius-lg);
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  box-shadow: var(--shadow-lg);
  overflow:hidden;
}
.cookie-modal-content::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:5px;
  background: linear-gradient(to right,var(--team1),var(--team2),var(--team3),var(--team4));
}

.cookie-modal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:18px 18px 12px;
}
.cookie-modal-title{
  font-size:1.15rem;
  font-weight:900;
  display:flex;
  align-items:center;
  gap:10px;
}
.cookie-modal-title i{
  color: rgba(255,255,255,.92);
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
}

.cookie-modal-close{
  width:44px;
  height:44px;
  border-radius:14px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
  transition: var(--transition);
}
.cookie-modal-close:hover{ transform: translateY(-2px); background: rgba(255,255,255,.12); }
.cookie-modal-close:active{ transform: translateY(1px); }

.cookie-modal-body{
  padding: 0 18px 12px;
  max-height:60vh;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
.cookie-modal-body::-webkit-scrollbar{ width:0; height:0; }

.cookie-modal-p{
  color: rgba(255,255,255,.90);
  line-height:1.55;
  margin:8px 0 14px;
  font-size:.98rem;
}

.cookie-cards{ display:grid; gap:12px; }

.cookie-card{
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: var(--radius);
  padding:14px;
}
.cookie-card-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:8px;
}
.cookie-card-name{ font-weight:900; }
.cookie-card-desc{
  color: rgba(255,255,255,.85);
  font-size:.94rem;
  line-height:1.5;
}

.cookie-pill{
  font-size:.78rem;
  font-weight:900;
  padding:7px 10px;
  border-radius:999px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.10);
}
.cookie-pill-required{
  border-color: rgba(76,217,100,.35);
  background: rgba(76,217,100,.14);
  color:#c7ffd7;
}

/* Switch */
.cookie-switch{
  position:relative;
  width:52px;
  height:30px;
  display:inline-block;
}
.cookie-switch input{ opacity:0; width:0; height:0; }
.cookie-slider{
  position:absolute;
  inset:0;
  border-radius:999px;
  background: rgba(255,255,255,.14);
  border: 1px solid rgba(255,255,255,.16);
  transition: .25s ease;
}
.cookie-slider::after{
  content:"";
  position:absolute;
  top:50%;
  left:4px;
  width:22px;
  height:22px;
  border-radius:999px;
  transform: translateY(-50%);
  background: rgba(255,255,255,.92);
  box-shadow: 0 8px 18px rgba(0,0,0,.25);
  transition: .25s ease;
}
.cookie-switch input:checked + .cookie-slider{
  background: rgba(0,180,219,.22);
  border-color: rgba(0,180,219,.40);
}
.cookie-switch input:checked + .cookie-slider::after{ left:26px; }

.cookie-policy{
  margin-top:14px;
  padding:14px;
  border-radius: var(--radius);
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
}
.cookie-policy-title{ font-weight:900; margin-bottom:8px; }
.cookie-policy-list{
  margin-left:18px;
  color: rgba(255,255,255,.86);
  line-height:1.55;
}
.cookie-policy-note{
  margin-top:10px;
  font-size:.88rem;
  color: rgba(255,255,255,.72);
  font-style:italic;
}
.cookie-policy-note a{
  color:#fff;
  font-weight:900;
  text-decoration: underline;
  text-underline-offset: 3px;
}
.cookie-modal-actions{
  padding:14px 18px 18px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}

/* =========================================================
   RESPONSIVE
========================================================= */

@media (max-width: 767px){
  body{ padding:10px; }
  header{ padding:15px; margin-bottom:20px; }
  .main-content{ padding:20px 15px; }
  .header-logo{ width:300px; }
  header .subtitle{ margin-top:100px; font-size:1rem; }

  .info-cards{ grid-template-columns: 1fr; gap:15px; }
  .info-card{ padding:20px; }
  .info-card-icon{ width:56px; height:56px; margin-bottom:15px; }

  .checkbox-group{ grid-template-columns: 1fr; }
  .urgency-badges{ flex-direction:column; }
  .urgency-badge{ min-width:auto; padding:10px 15px; }

  .button-group{ flex-direction:column; align-items:center; gap:15px; }
  .btn{ width:100%; max-width:300px; }

  .form-input, .form-textarea{ padding:14px 16px; }

  .cookie-banner-inner{ flex-direction:column; align-items:stretch; }
  .cookie-banner-actions{ justify-content:stretch; }
  .cookie-btn{ width:100%; }
  .cookie-modal-content{ margin-top:6vh; }
}
@media (max-width: 480px){
  .header-logo{ width:160px; }
  header .subtitle{ margin-top:80px; font-size:.9rem; }
  .main-content{ padding:15px 10px; }
  .form-section-title{ font-size:1.5rem; }
  .info-card-title{ font-size:1.2rem; }
  .info-card-icon{ width:48px; height:48px; margin-bottom:12px; }
  .form-hint{ font-size:.8rem; }
}

/* âœ… Arka plan bozulmasÄ±n diye gradient'i body yerine fixed katmana taÅŸÄ± */
html{
  min-height: 100%;
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
}

body{
  background: transparent !important; /* body fixed olunca renk bozulmasÄ±n */
}

/* sabit arka plan katmanÄ± */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  z-index: -2;
  pointer-events: none;
  transform: translateZ(0); /* iOS/Safari stabil */
}

/* particles zaten -1, arka plan katmanÄ± -2 olmalÄ± */
.floating-particles{ z-index: -1; }

@media (max-width: 767px){
  header .subtitle{
    margin-top: 100px; /* mobilde logo altÄ±ndan aÅŸaÄŸÄ± indirir */
  }
}

@media (max-width: 767px){
  .header-logo-wrapper{
    top: 40%; /* 50 â†’ yukarÄ± Ã§Ä±kar */
  }
}

  </style>
</head>

<body>
  <noscript>
    <div style="max-width:900px;margin:16px auto;padding:14px;border-radius:14px;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.2);color:#fff;">
      Bu sayfanÄ±n Ã§alÄ±ÅŸmasÄ± iÃ§in JavaScript gereklidir. LÃ¼tfen tarayÄ±cÄ±nÄ±zda JavaScriptâ€™i etkinleÅŸtirin.
    </div>
  </noscript>

  <div class="floating-particles" id="particles" aria-hidden="true"></div>

  <div class="container">
    <header>
      <div class="header-logo-wrapper">
        <img src="logo.png" alt="TabulaGo" class="header-logo" onerror="this.style.display='none'" />
      </div>
      <p class="subtitle">Oyunla ilgili sorun, hata, Ã¶neri veya geri bildirimlerinizi bize iletin</p>
    </header>

    <main class="main-content">
      <div class="info-cards">
        <div class="info-card">
          <div class="info-card-icon"><img src="hata.png" alt="Hata Bildirimi" /></div>
          <h3 class="info-card-title">Hata Bildirimi</h3>
          <p class="info-card-text">Oyun sÄ±rasÄ±nda karÅŸÄ±laÅŸtÄ±ÄŸÄ±nÄ±z teknik problemleri, Ã§Ã¶kmeleri veya beklenmeyen davranÄ±ÅŸlarÄ± detaylÄ±ca aÃ§Ä±klayÄ±n.</p>
        </div>

        <div class="info-card">
          <div class="info-card-icon"><img src="istek.png" alt="Ã–neri / Ä°stek" /></div>
          <h3 class="info-card-title">Ã–neri / Ä°stek</h3>
          <p class="info-card-text">Oyunu nasÄ±l geliÅŸtirebileceÄŸimiz konusunda fikirlerinizi paylaÅŸÄ±n. Her Ã¶neriniz dikkatle deÄŸerlendirilecektir.</p>
        </div>

        <div class="info-card">
          <div class="info-card-icon"><img src="bildirim.png" alt="Geri Bildirim" /></div>
          <h3 class="info-card-title">Geri Bildirim</h3>
          <p class="info-card-text">Oyun deneyiminiz hakkÄ±ndaki dÃ¼ÅŸÃ¼ncelerinizi, beÄŸendiÄŸiniz veya geliÅŸtirilmesini istediÄŸiniz noktalarÄ± belirtin.</p>
        </div>
      </div>

      <!-- Mesajlar -->
      <div id="successMessage" class="message message-success" style="display:none;" role="status" aria-live="polite">
        <i class="fas fa-check-circle" aria-hidden="true"></i>
        <span id="successText">TeÅŸekkÃ¼rler! Bildiriminiz gÃ¶nderildi.</span>
      </div>

      <div id="errorMessage" class="message message-error" style="display:none;" role="alert" aria-live="assertive">
        <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
        <span id="errorText">Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.</span>
      </div>

      <!-- Formspree -->
      <form id="reportForm" action="https://formspree.io/f/xdkqjbkk" method="POST" novalidate>
        <input type="hidden" name="_subject" value="TabulaGo - Yeni Sorun Bildirimi" />

        <!-- Anti-bot: sayfa aÃ§Ä±lÄ±ÅŸ zamanÄ± (Ã§ok hÄ±zlÄ± gÃ¶nderimi engeller) -->
        <input type="hidden" name="_page_open_ts" id="pageOpenTs" />

        <!-- Mailde TÃ¼rkÃ§e alan isimleri -->
        <input type="hidden" name="GÃ¶nderim Tarihi" id="gonderimTarihi" />
        <input type="hidden" name="Sayfa Adresi" id="sayfaAdresi" />

        <!-- Teknik alan -->
        <input type="hidden" name="TarayÄ±cÄ± Bilgisi" id="tarayiciBilgisi" />
        <input type="hidden" name="Oturum ID" id="sessionId" />

        <!-- IP (sadece performans izni varsa) -->
        <input type="hidden" name="IP Adresi Bilgisi" id="ipBilgisi" />

        <!-- Honeypot -->
        <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />

        <!-- Bildirim TÃ¼rÃ¼ -->
        <div class="form-section">
          <h2 class="form-section-title">Bildirim TÃ¼rÃ¼</h2>

          <div class="form-group">
            <label class="form-label">
              Ne tÃ¼r bir bildirim gÃ¶ndermek istiyorsunuz?
              <span class="required" data-required="turler">*</span>
            </label>

            <div class="checkbox-group" role="group" aria-label="Bildirim TÃ¼rÃ¼" id="turlerGroup" tabindex="-1">
              <label class="checkbox-label">
                <input type="checkbox" name="Bildirim TÃ¼rÃ¼[]" value="Hata / Bug" />
                <span class="checkbox-text">Hata / Bug</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" name="Bildirim TÃ¼rÃ¼[]" value="Ã–neri / Ä°stek" />
                <span class="checkbox-text">Ã–neri / Ä°stek</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" name="Bildirim TÃ¼rÃ¼[]" value="Geri Bildirim" />
                <span class="checkbox-text">Geri Bildirim</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" name="Bildirim TÃ¼rÃ¼[]" value="DiÄŸer" />
                <span class="checkbox-text">DiÄŸer</span>
              </label>
            </div>

            <div id="turlerHata" class="inline-error" style="display:none;" role="alert" aria-live="assertive">
              <i class="fas fa-triangle-exclamation" aria-hidden="true"></i>
              <span>LÃ¼tfen en az bir bildirim tÃ¼rÃ¼ seÃ§in.</span>
            </div>
          </div>
        </div>

        <!-- Aciliyet -->
        <div class="form-section">
          <h2 class="form-section-title">Aciliyet Durumu</h2>

          <div class="form-group">
            <label class="form-label">Sorununuz ne kadar acil Ã§Ã¶zÃ¼lmeli?</label>

            <div class="urgency-badges" role="radiogroup" aria-label="Aciliyet Durumu" id="urgencyGroup">
              <button type="button" class="urgency-badge urgency-low" data-urgency="DÃ¼ÅŸÃ¼k" role="radio" aria-checked="false">DÃ¼ÅŸÃ¼k</button>
              <button type="button" class="urgency-badge urgency-medium selected" data-urgency="Orta" role="radio" aria-checked="true">Orta</button>
              <button type="button" class="urgency-badge urgency-high" data-urgency="YÃ¼ksek" role="radio" aria-checked="false">YÃ¼ksek</button>
              <button type="button" class="urgency-badge urgency-critical" data-urgency="Kritik" role="radio" aria-checked="false">Kritik</button>
            </div>

            <input type="hidden" name="Aciliyet Durumu" id="aciliyetDurumu" value="Orta" />
            <div class="form-hint">Sorunun ne kadar acil Ã§Ã¶zÃ¼lmesi gerektiÄŸini belirtin</div>
          </div>
        </div>

        <!-- Kategori + Tekrar Ãœretilebilirlik -->
        <div class="form-section">
          <h2 class="form-section-title">Sorun SÄ±nÄ±flandÄ±rma</h2>

          <div class="classify-grid">
            <div class="classify-card">
              <div class="classify-card-inner">
                <div class="classify-head">
                  <div class="classify-icon"><i class="fa-solid fa-layer-group" aria-hidden="true"></i></div>
                  <div>
                    <div class="classify-title">Kategori</div>
                    <div class="classify-desc">Sorunu doÄŸru ekibe yÃ¶nlendirmek iÃ§in yardÄ±mcÄ± olur.</div>
                  </div>
                </div>

                <label id="kategoriLabel" class="form-label" style="margin-bottom:8px;">Kategori (opsiyonel)</label>

                <input type="hidden" name="Kategori" id="kategoriValue" value="" />

                <div class="cs-field">
                  <button
                    type="button"
                    class="cs-btn"
                    id="kategoriBtn"
                    aria-haspopup="dialog"
                    aria-expanded="false"
                    aria-labelledby="kategoriLabel kategoriBtnText"
                  >
                    <span id="kategoriBtnText" class="cs-placeholder">SeÃ§iniz</span>
                    <span class="cs-right">
                      <span class="cs-chip">Opsiyonel</span>
                      <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
              </div>
            </div>

            <div class="classify-card">
              <div class="classify-card-inner">
                <div class="classify-head">
                  <div class="classify-icon"><i class="fa-solid fa-rotate" aria-hidden="true"></i></div>
                  <div>
                    <div class="classify-title">Tekrar Ãœretilebilirlik</div>
                    <div class="classify-desc">HatanÄ±n ne kadar sÄ±k yaÅŸandÄ±ÄŸÄ±nÄ± belirtin.</div>
                  </div>
                </div>

                <label id="tekrarLabel" class="form-label" style="margin-bottom:8px;">Tekrar Durumu (opsiyonel)</label>

                <input type="hidden" name="Tekrar Ãœretilebilirlik" id="tekrarValue" value="" />

                <div class="cs-field">
                  <button
                    type="button"
                    class="cs-btn"
                    id="tekrarBtn"
                    aria-haspopup="dialog"
                    aria-expanded="false"
                    aria-labelledby="tekrarLabel tekrarBtnText"
                  >
                    <span id="tekrarBtnText" class="cs-placeholder">SeÃ§iniz</span>
                    <span class="cs-right">
                      <span class="cs-chip">Opsiyonel</span>
                      <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detaylar -->
        <div class="form-section">
          <h2 class="form-section-title">Sorun DetaylarÄ±</h2>

          <div class="form-group">
            <label for="baslik" class="form-label">
              BaÅŸlÄ±k <span class="required" data-required="baslik">*</span>
            </label>
            <input
              type="text"
              id="baslik"
              name="BaÅŸlÄ±k"
              class="form-input"
              placeholder="Sorunun kÄ±sa aÃ§Ä±klamasÄ± (Ã–rn: 'Tur geÃ§iÅŸinde hata')"
              maxlength="100"
              required
              autocomplete="off"
            />
            <div class="character-count" id="baslikSayac">0/100</div>

            <div id="baslikHata" class="inline-error" style="display:none;" role="alert" aria-live="assertive">
              <i class="fas fa-triangle-exclamation" aria-hidden="true"></i>
              <span>LÃ¼tfen bir baÅŸlÄ±k girin.</span>
            </div>
          </div>

          <div class="form-group">
            <label for="aciklama" class="form-label">
              DetaylÄ± AÃ§Ä±klama <span class="required" data-required="aciklama">*</span>
            </label>
            <textarea
              id="aciklama"
              name="DetaylÄ± AÃ§Ä±klama"
              class="form-textarea"
              placeholder="Sorunu detaylÄ±ca aÃ§Ä±klayÄ±n. Hangi adÄ±mlarÄ± izlediniz? Ne bekliyordunuz? Ne oldu?"
              maxlength="2000"
              required
              spellcheck="true"
            ></textarea>
            <div class="character-count" id="aciklamaSayac">0/2000</div>

            <div id="aciklamaHata" class="inline-error" style="display:none;" role="alert" aria-live="assertive">
              <i class="fas fa-triangle-exclamation" aria-hidden="true"></i>
              <span>LÃ¼tfen detaylÄ± aÃ§Ä±klama girin.</span>
            </div>
          </div>

          <!-- âœ… EKRAN GÃ–RÃœNTÃœSÃœ / DOSYA KISMI TAMAMEN KALDIRILDI -->
        </div>

        <!-- Ek Bilgiler -->
        <div class="form-section">
          <h2 class="form-section-title">Ek Bilgiler</h2>

          <div class="form-group">
            <label for="eposta" class="form-label">
              E-posta Adresiniz <span class="required" data-required="eposta">*</span>
            </label>
            <input
              type="email"
              id="eposta"
              name="E-posta Adresi"
              class="form-input"
              placeholder="Ã–rn: kullanici@gmail.com"
              autocomplete="email"
              required
              inputmode="email"
              spellcheck="false"
              aria-describedby="emailHint"
            />
            <div class="form-hint" id="emailHint">
              Sadece ÅŸu uzantÄ±lar kabul edilir: gmail.com, hotmail.com, outlook.com, icloud.com, yandex.com, mail.com
              (Not: â€œ@â€ yazdÄ±ktan sonra sadece bu uzantÄ±lar yazÄ±labilir ve otomatik tamamlanÄ±r.)
            </div>

            <div id="epostaHata" class="inline-error" style="display:none;" role="alert" aria-live="assertive">
              <i class="fas fa-triangle-exclamation" aria-hidden="true"></i>
              <span>GeÃ§ersiz e-posta. LÃ¼tfen sadece izin verilen uzantÄ±lardan birini kullanÄ±n.</span>
            </div>
          </div>

          <div class="form-group">
            <label for="cihazBilgisi" class="form-label">Cihaz Bilgisi</label>
            <input type="text" id="cihazBilgisi" name="Cihaz Bilgisi" class="form-input" readonly />
            <div class="form-hint">Otomatik olarak cihaz bilgileriniz alÄ±nmÄ±ÅŸtÄ±r</div>
          </div>

          <!-- Telemetry -->
          <div class="form-group">
            <label class="form-label">TeÅŸhis (Telemetry) Ä°zni (opsiyonel)</label>
            <label class="checkbox-label" style="margin-top:10px;">
              <input type="checkbox" id="telemetryOptIn" name="Anonim TeÅŸhis Ä°zni" value="Evet" />
              <span class="checkbox-text">
                Anonim teÅŸhis bilgisi paylaÅŸmayÄ± kabul ediyorum (performans izni varsa daha faydalÄ± olur)
              </span>
            </label>
            <div class="form-hint">
              Bu seÃ§enek <strong>tek baÅŸÄ±na</strong> ekstra veri toplamaz; yalnÄ±zca rapora <strong>oturum ID</strong> eklenmesine izin verir.
              (IP/UA gibi detaylar sadece â€œPerformansâ€ Ã§erez izni aÃ§Ä±kken eklenir.)
            </div>
          </div>

<!-- KVKK -->
<div class="privacy-card" role="note" aria-label="Gizlilik Bilgisi">
  <div class="privacy-card-title">
    <i class="fa-solid fa-user-shield" aria-hidden="true"></i>
    Ã‡erez & Gizlilik
  </div>
  <p>
    Bu sayfada ilettiÄŸiniz bilgiler, yalnÄ±zca bildiriminizin deÄŸerlendirilmesi ve gerekli durumlarda sizinle
    iletiÅŸime geÃ§ilebilmesi amacÄ±yla iÅŸlenmektedir. KiÅŸisel verileriniz, 6698 sayÄ±lÄ± KiÅŸisel Verilerin KorunmasÄ±
    Kanunu (KVKK) kapsamÄ±nda korunur ve Ã¼Ã§Ã¼ncÃ¼ kiÅŸilerle paylaÅŸÄ±lmaz.
    Ã‡erez tercihlerinizi dilediÄŸiniz zaman Ã§erez penceresinden yÃ¶netebilirsiniz.
    AyrÄ±ntÄ±lÄ± bilgi iÃ§in
    <a href="privacy.html" target="_blank" rel="noopener noreferrer">KVKK / AydÄ±nlatma Metni</a>
    sayfasÄ±nÄ± inceleyebilirsiniz.
  </p>
</div>


          <!-- Bot / rate limit -->
          <div id="rateLimitInfo" class="message message-error" style="display:none;" role="alert" aria-live="assertive">
            <i class="fas fa-shield-halved" aria-hidden="true"></i>
            <span id="rateLimitText">Ã‡ok sÄ±k gÃ¶nderim yapÄ±yorsunuz. LÃ¼tfen biraz bekleyip tekrar deneyin.</span>
          </div>
        </div>

        <div class="button-group">
          <button type="submit" class="btn btn-submit" id="gonderBtn">
            <i class="fas fa-paper-plane" aria-hidden="true"></i> Bildirimi GÃ¶nder
          </button>

          <button type="button" class="btn btn-back" id="geriBtn">
            <i class="fas fa-arrow-left" aria-hidden="true"></i> Oyuna DÃ¶n
          </button>
        </div>
      </form>
    </main>
  </div>

  <!-- =========================================================
       KATEGORÄ° MODAL
  ========================================================= -->
  <div id="kategoriModal" class="cs-modal" aria-hidden="true">
    <div class="cs-backdrop" data-cs-close></div>
    <div class="cs-sheet" role="dialog" aria-modal="true" aria-label="Kategori SeÃ§imi">
      <div class="cs-head">
        <div class="cs-title"><i class="fa-solid fa-layer-group" aria-hidden="true"></i> Kategori</div>
        <button type="button" class="cs-close" aria-label="Kapat" data-cs-close><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="cs-body">
        <div class="cs-list" role="listbox" aria-label="Kategori Listesi">
          <button type="button" class="cs-item" data-cs-value="">
            <div>
              SeÃ§iniz
              <div class="cs-sub">BoÅŸ bÄ±rakabilirsiniz</div>
            </div>
            <i class="fa-solid fa-circle-xmark" aria-hidden="true"></i>
          </button>

          <button type="button" class="cs-item" data-cs-value="OynanÄ±ÅŸ / Gameplay">OynanÄ±ÅŸ / Gameplay</button>
          <button type="button" class="cs-item" data-cs-value="KullanÄ±cÄ± ArayÃ¼zÃ¼ / UI">KullanÄ±cÄ± ArayÃ¼zÃ¼ / UI</button>
          <button type="button" class="cs-item" data-cs-value="Performans / FPS / Donma">Performans / FPS / Donma</button>
          <button type="button" class="cs-item" data-cs-value="Ã‡Ã¶kme / Crash">Ã‡Ã¶kme / Crash</button>
          <button type="button" class="cs-item" data-cs-value="BaÄŸlantÄ± / Sunucu">BaÄŸlantÄ± / Sunucu</button>
          <button type="button" class="cs-item" data-cs-value="Ses / MÃ¼zik">Ses / MÃ¼zik</button>
          <button type="button" class="cs-item" data-cs-value="GÃ¶rsel / Grafik">GÃ¶rsel / Grafik</button>
          <button type="button" class="cs-item" data-cs-value="Reklam / Ã–dÃ¼l">Reklam / Ã–dÃ¼l</button>
          <button type="button" class="cs-item" data-cs-value="Hesap / GiriÅŸ">Hesap / GiriÅŸ</button>
          <button type="button" class="cs-item" data-cs-value="DiÄŸer">DiÄŸer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       TEKRAR MODAL
  ========================================================= -->
  <div id="tekrarModal" class="cs-modal" aria-hidden="true">
    <div class="cs-backdrop" data-cs-close></div>
    <div class="cs-sheet" role="dialog" aria-modal="true" aria-label="Tekrar Ãœretilebilirlik SeÃ§imi">
      <div class="cs-head">
        <div class="cs-title"><i class="fa-solid fa-rotate" aria-hidden="true"></i> Tekrar Ãœretilebilirlik</div>
        <button type="button" class="cs-close" aria-label="Kapat" data-cs-close><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="cs-body">
        <div class="cs-list" role="listbox" aria-label="Tekrar Listesi">
          <button type="button" class="cs-item" data-cs-value="">
            <div>
              SeÃ§iniz
              <div class="cs-sub">BoÅŸ bÄ±rakabilirsiniz</div>
            </div>
            <i class="fa-solid fa-circle-xmark" aria-hidden="true"></i>
          </button>

          <button type="button" class="cs-item" data-cs-value="Her zaman oluyor">Her zaman oluyor</button>
          <button type="button" class="cs-item" data-cs-value="Bazen oluyor">Bazen oluyor</button>
          <button type="button" class="cs-item" data-cs-value="Ä°lk kez oldu">Ä°lk kez oldu</button>
          <button type="button" class="cs-item" data-cs-value="Bilmiyorum">Bilmiyorum</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       Ã‡EREZ (COOKIE) BANNER + MODAL
  ========================================================= -->
  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Ã‡erez Bildirimi" aria-hidden="true">
    <div class="cookie-banner-inner">
      <div class="cookie-banner-icon" aria-hidden="true">
        <i class="fa-solid fa-cookie-bite"></i>
      </div>

      <div class="cookie-banner-text">
        <div class="cookie-banner-title">Ã‡erez (Cookie) Bildirimi</div>
        <div class="cookie-banner-desc">
          Bu sayfa, gÃ¼venlik ve raporlama iÃ§in bazÄ± verileri iÅŸler. Tercihlerinizi yÃ¶netebilirsiniz.
          Detay: <a href="privacy.html" target="_blank" rel="noopener noreferrer">KVKK / AydÄ±nlatma</a>
        </div>
      </div>

      <div class="cookie-banner-actions">
        <button type="button" class="cookie-btn cookie-btn-secondary" id="cookieManageBtnBanner">Tercihleri YÃ¶net</button>
        <button type="button" class="cookie-btn cookie-btn-primary" id="cookieAcceptAllBtnBanner">TÃ¼mÃ¼nÃ¼ Kabul Et</button>
        <button type="button" class="cookie-btn cookie-btn-ghost" id="cookieRejectAllBtnBanner">TÃ¼mÃ¼nÃ¼ Reddet</button>
      </div>
    </div>
  </div>

  <div id="cookieModal" class="cookie-modal" aria-hidden="true">
    <div class="cookie-modal-backdrop" data-cookie-close></div>

    <div class="cookie-modal-content" role="dialog" aria-modal="true" aria-label="Ã‡erez Tercihleri">
      <div class="cookie-modal-head">
        <div class="cookie-modal-title">
          <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
          Ã‡erez Tercihleri
        </div>
        <button class="cookie-modal-close" type="button" aria-label="Kapat" data-cookie-close>
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="cookie-modal-body">
        <p class="cookie-modal-p">
          Bu sayfa (â€œTabulaGo - Sorun Bildirâ€), bildirimleri iÅŸlemek ve gÃ¼venliÄŸi saÄŸlamak iÃ§in bazÄ± verileri iÅŸler.
          AÅŸaÄŸÄ±dan tercihleri yÃ¶netebilirsiniz. Zorunlu tercih (seÃ§iminizin saklanmasÄ±) kapatÄ±lamaz.
        </p>

        <div class="cookie-cards">
          <div class="cookie-card">
            <div class="cookie-card-top">
              <div class="cookie-card-name">Zorunlu</div>
              <div class="cookie-pill cookie-pill-required">Her zaman aÃ§Ä±k</div>
            </div>
            <div class="cookie-card-desc">
              Ã‡erez tercihinizin saklanmasÄ± (localStorage), gÃ¼venlik kontrolleri ve sayfanÄ±n dÃ¼zgÃ¼n Ã§alÄ±ÅŸmasÄ± iÃ§in gereklidir.
            </div>
          </div>

          <div class="cookie-card">
            <div class="cookie-card-top">
              <div class="cookie-card-name">Analitik / Ä°statistik</div>
              <label class="cookie-switch">
                <input type="checkbox" id="cookieAnalytics" />
                <span class="cookie-slider" aria-hidden="true"></span>
              </label>
            </div>
            <div class="cookie-card-desc">
              Ziyaret/kullanÄ±m istatistikleri ile deneyimi geliÅŸtirmeye yardÄ±mcÄ± olur.
              Not: Bu sayfada analitik araÃ§ eklemediyseniz, bu tercih ÅŸu an ekstra iÅŸlem tetiklemez.
            </div>
          </div>

          <div class="cookie-card">
            <div class="cookie-card-top">
              <div class="cookie-card-name">Performans / Hata AyÄ±klama</div>
              <label class="cookie-switch">
                <input type="checkbox" id="cookiePerformance" />
                <span class="cookie-slider" aria-hidden="true"></span>
              </label>
            </div>
            <div class="cookie-card-desc">
              Bu izni verirseniz; tarayÄ±cÄ±/cihaz bilgileri daha detaylÄ± toplanabilir ve IP bilgisi Ã¼Ã§Ã¼ncÃ¼ taraf bir servis
              (ipify) Ã¼zerinden alÄ±narak forma eklenebilir.
            </div>
          </div>
        </div>

        <div class="cookie-policy">
          <div class="cookie-policy-title">Performans izni verilince neler toplanÄ±r?</div>
          <ul class="cookie-policy-list">
            <li><strong>IP:</strong> ipify Ã¼zerinden alÄ±nÄ±r, forma eklenir.</li>
            <li><strong>Detay UA:</strong> TarayÄ±cÄ± User-Agent metni (UA).</li>
            <li><strong>Platform bilgisi:</strong> (varsa) platform ve sÃ¼rÃ¼m (userAgentData high entropy).</li>
            <li><strong>TarayÄ±cÄ± marka/sÃ¼rÃ¼m listesi:</strong> (varsa) fullVersionList / brands.</li>
            <li><strong>Her zaman:</strong> Ekran boyutu, dil, temel tarayÄ±cÄ±/OS Ã¶zeti.</li>
          </ul>
          <div class="cookie-policy-note">
            DetaylÄ± metin: <a href="privacy.html" target="_blank" rel="noopener noreferrer">KVKK / AydÄ±nlatma</a>
          </div>
        </div>
      </div>

      <div class="cookie-modal-actions">
        <button type="button" class="cookie-btn cookie-btn-secondary" id="cookieSaveBtn">SeÃ§imleri Kaydet</button>
        <button type="button" class="cookie-btn cookie-btn-primary" id="cookieAcceptAllBtnModal">TÃ¼mÃ¼nÃ¼ Kabul Et</button>
        <button type="button" class="cookie-btn cookie-btn-ghost" id="cookieRejectAllBtnModal">TÃ¼mÃ¼nÃ¼ Reddet</button>
      </div>
    </div>
  </div>

<!-- ===== FOOTER ===== -->
<footer class="site-footer" role="contentinfo">
  <div class="footer-inner">
    <div class="footer-glow" aria-hidden="true"></div>

<div class="footer-content">
  <span class="footer-text">Designed by</span>

<a class="footer-link footer-instagram"
   href="https://www.instagram.com/ileri.official?igsh=MXo0bmczdHVtbjFm&utm_source=qr"
   target="_blank"
   rel="noopener noreferrer">

  <img src="insta.png"
       alt="Instagram"
       class="ig-icon"
       draggable="false">

  Eren Ä°lhan
</a>


  <a href="fix.html" class="footer-fix">
    <img src="fix.png" alt="Sorun Bildir">
  </a>
</div>

<!-- â¬‡ï¸ AYRI SATIR -->
<span class="footer-legal">
  Â© <span id="footerYear"></span> <strong>TabulaGo</strong> â€¢ TÃ¼m haklarÄ± saklÄ±dÄ±r
</span>

    <div class="footer-sparkles" aria-hidden="true">
      <span class="spark s1"></span>
      <span class="spark s2"></span>
      <span class="spark s3"></span>
      <span class="spark s4"></span>
    </div>
  </div>
</footer>

<script>
(function () {
  "use strict";

  /* =========================================================
     HELPERS
  ========================================================= */
  const $  = (sel, root = document) => root.querySelector(sel);
  const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

  const el = {
    particles: $("#particles"),
    form: $("#reportForm"),

    success: $("#successMessage"),
    error: $("#errorMessage"),
    successText: $("#successText"),
    errorText: $("#errorText"),

    gonderBtn: $("#gonderBtn"),
    geriBtn: $("#geriBtn"),

    baslik: $("#baslik"),
    baslikSayac: $("#baslikSayac"),
    baslikHata: $("#baslikHata"),

    aciklama: $("#aciklama"),
    aciklamaSayac: $("#aciklamaSayac"),
    aciklamaHata: $("#aciklamaHata"),

    turlerGroup: $("#turlerGroup"),
    turlerHata: $("#turlerHata"),

    rozetler: $$(".urgency-badge"),
    aciliyetHidden: $("#aciliyetDurumu"),

    eposta: $("#eposta"),
    epostaHata: $("#epostaHata"),

    cihaz: $("#cihazBilgisi"),
    yil: $("#footerYear"),

    gonderimTarihi: $("#gonderimTarihi"),
    sayfaAdresi: $("#sayfaAdresi"),
    tarayiciBilgisi: $("#tarayiciBilgisi"),
    ipBilgisi: $("#ipBilgisi"),

    pageOpenTs: $("#pageOpenTs"),
    sessionId: $("#sessionId"),

    telemetryOptIn: $("#telemetryOptIn"),

    rateLimitInfo: $("#rateLimitInfo"),
    rateLimitText: $("#rateLimitText"),

    requiredMarks: $$(".required[data-required]"),

    // Cookie UI
    cookieBanner: $("#cookieBanner"),
    cookieModal: $("#cookieModal"),
    cookieManageBtnBanner: $("#cookieManageBtnBanner"),
    cookieAcceptAllBtnBanner: $("#cookieAcceptAllBtnBanner"),
    cookieRejectAllBtnBanner: $("#cookieRejectAllBtnBanner"),

    cookieSaveBtn: $("#cookieSaveBtn"),
    cookieAcceptAllBtnModal: $("#cookieAcceptAllBtnModal"),
    cookieRejectAllBtnModal: $("#cookieRejectAllBtnModal"),

    cookieAnalytics: $("#cookieAnalytics"),
    cookiePerformance: $("#cookiePerformance"),

    urgencyGroup: $("#urgencyGroup"),

    // Custom select
    kategoriBtn: $("#kategoriBtn"),
    kategoriBtnText: $("#kategoriBtnText"),
    kategoriValue: $("#kategoriValue"),
    kategoriModal: $("#kategoriModal"),

    tekrarBtn: $("#tekrarBtn"),
    tekrarBtnText: $("#tekrarBtnText"),
    tekrarValue: $("#tekrarValue"),
    tekrarModal: $("#tekrarModal"),
  };

  const LIMIT = { baslik: 100, aciklama: 2000 };
  const ALLOWED_DOMAINS = ["gmail.com", "hotmail.com", "outlook.com", "icloud.com", "yandex.com", "mail.com"];

  /* =========================================================
     RATE LIMIT + BOT PROTECTION
  ========================================================= */
  const RL_KEY = "tabulago_last_submit_ts_v1";
  const COOLDOWN_MS = 30 * 1000;     // 30 saniye
  const MIN_FILL_MS = 2500;          // 2.5 saniye (Ã§ok hÄ±zlÄ± gÃ¶nderim)

  function now() { return Date.now(); }

  function canSubmitCooldown() {
    const last = parseInt(localStorage.getItem(RL_KEY) || "0", 10) || 0;
    const diff = now() - last;
    if (diff < COOLDOWN_MS) {
      const remain = Math.ceil((COOLDOWN_MS - diff) / 1000);
      return { ok: false, remain };
    }
    return { ok: true, remain: 0 };
  }

  function markSubmittedNow() {
    localStorage.setItem(RL_KEY, String(now()));
  }

  function isTooFastSinceOpen() {
    const openTs = parseInt(el.pageOpenTs?.value || "0", 10) || 0;
    if (!openTs) return false;
    return (now() - openTs) < MIN_FILL_MS;
  }

  /* =========================================================
     COOKIE / CONSENT (PERSIST)
  ========================================================= */
  const CONSENT_KEY = "tabulago_consent_v1";
  const CONSENT_TTL_DAYS = 180;
  const CONSENT_TTL_MS = CONSENT_TTL_DAYS * 24 * 60 * 60 * 1000;

  let consent = { required: true, analytics: false, performance: false, granted: false, ts: 0 };
  let gonderiliyor = false;
  let cookieEventsBound = false;

  function safeJSONParse(str) {
    try { return JSON.parse(str); } catch (_) { return null; }
  }

  function loadConsent() {
    const raw = localStorage.getItem(CONSENT_KEY);
    if (!raw) return null;
    const c = safeJSONParse(raw);
    if (!c || typeof c !== "object") return null;
    if (!c.ts || (now() - c.ts) > CONSENT_TTL_MS) return null;
    return {
      required: true,
      analytics: !!c.analytics,
      performance: !!c.performance,
      granted: !!c.granted,
      ts: Number(c.ts) || 0
    };
  }

  function saveConsent(c) {
    const data = {
      required: true,
      analytics: !!c.analytics,
      performance: !!c.performance,
      granted: true,
      ts: now()
    };
    localStorage.setItem(CONSENT_KEY, JSON.stringify(data));
    consent = data;
    updateSubmitGate();
  }

  /* =========================================================
     UI HELPERS
  ========================================================= */
  const goster = (x) => { if (x) x.style.display = "flex"; };
  const gizle  = (x) => { if (x) x.style.display = "none"; };
  const kaydir = (x) => { if (x) x.scrollIntoView({ behavior: "smooth", block: "start" }); };
  const setText = (node, text) => { if (node) node.textContent = text; };

  function showInlineError(node, show) {
    if (!node) return;
    node.style.display = show ? "flex" : "none";
  }

  function showRateLimit(show, msg) {
    if (!el.rateLimitInfo) return;
    el.rateLimitInfo.style.display = show ? "flex" : "none";
    if (show && el.rateLimitText && msg) el.rateLimitText.textContent = msg;
  }

  function focusGroupFirstInput(groupEl) {
    if (!groupEl) return;
    const first = groupEl.querySelector("input,button,select,textarea");
    if (first && first.focus) first.focus();
    else groupEl.focus?.();
  }

  /* =========================================================
     ZORUNLU ALAN YILDIZI
  ========================================================= */
  function setStarVisible(key, visible) {
    el.requiredMarks
      .filter(s => s.getAttribute("data-required") === key)
      .forEach(s => { s.style.display = visible ? "inline" : "none"; });
  }

  function syncStars() {
    setStarVisible("baslik", !((el.baslik?.value || "").trim().length > 0));
    setStarVisible("aciklama", !((el.aciklama?.value || "").trim().length > 0));
    setStarVisible("eposta", !((el.eposta?.value || "").trim().length > 0));

    const anyChecked = $$('input[name="Bildirim TÃ¼rÃ¼[]"]:checked', el.form).length > 0;
    setStarVisible("turler", !anyChecked);
  }

  /* =========================================================
     PARTÄ°KÃœL
  ========================================================= */
  function partikullerOlustur() {
    const c = el.particles;
    if (!c) return;

    const adet = 25;
    const frag = document.createDocumentFragment();
    c.innerHTML = "";

    for (let i = 0; i < adet; i++) {
      const p = document.createElement("div");
      p.className = "particle";
      const size = Math.random() * 6 + 2;
      p.style.width = size + "px";
      p.style.height = size + "px";
      p.style.left = (Math.random() * 100).toFixed(2) + "%";
      p.style.animationDuration = (Math.random() * 20 + 10).toFixed(2) + "s";
      p.style.animationDelay = (Math.random() * 5).toFixed(2) + "s";
      frag.appendChild(p);
    }
    c.appendChild(frag);
  }

  /* =========================================================
     âœ… EMAIL: SIKI KISIT + OTOMATÄ°K TAMAMLAMA (FIX)
     - Yazarken autocomplete
     - Silme/backspace sÄ±rasÄ±nda autocomplete YOK (silinebilir)
  ========================================================= */
  const EMAIL_LOCAL_ALLOWED = /^[a-zA-Z0-9._%+\-]*$/;
  const EMAIL_DOMAIN_ALLOWED_CHARS = /^[a-z0-9.]*$/;
  const emailState = { lastValue: "" };

  function normalizeLocal(local) {
    return (local || "")
      .replace(/\s+/g, "")
      .split("")
      .filter(ch => EMAIL_LOCAL_ALLOWED.test(ch))
      .join("");
  }

  function getMatches(prefix) {
    const p = (prefix || "").toLowerCase();
    return ALLOWED_DOMAINS.filter(d => d.startsWith(p));
  }

  function clampToValidDomainPrefix(prefix) {
    let p = (prefix || "").toLowerCase();
    p = p.replace(/[^a-z0-9.]/g, "");
    while (p.length > 0 && getMatches(p).length === 0) {
      p = p.slice(0, -1);
    }
    return p;
  }

  function isAllowedEmailFull(value) {
    const v = (value || "").trim();
    const m = v.match(/^([^@\s]+)@([^@\s]+)$/);
    if (!m) return false;
    return ALLOWED_DOMAINS.includes(m[2].toLowerCase());
  }

  function showEmailError(show, msg) {
    if (!el.epostaHata) return;
    el.epostaHata.style.display = show ? "flex" : "none";
    if (show && msg) el.epostaHata.querySelector("span").textContent = msg;
  }

  function validateEmailStrict() {
    const v = (el.eposta?.value || "").trim();
    if (!v) { showEmailError(true, "E-posta adresi zorunludur."); el.eposta?.focus(); return false; }
    if (!isAllowedEmailFull(v)) { showEmailError(true, "GeÃ§ersiz e-posta. Ã–rn: kullanici@gmail.com"); el.eposta?.focus(); return false; }
    showEmailError(false);
    return true;
  }

  function safeSetSelection(inputEl, start, end) {
    try {
      if (inputEl && inputEl.setSelectionRange) inputEl.setSelectionRange(start, end);
    } catch (_) {}
  }

  function applyEmailRuleAndMaybeSuggest(inputEl, inputType) {
    if (!inputEl) return;

    const isDelete = (inputType || "").startsWith("delete");
    const isUndoRedo = inputType === "historyUndo" || inputType === "historyRedo";

    // Undo/redo'ya karÄ±ÅŸmayalÄ±m (stabil)
    if (isUndoRedo) {
      emailState.lastValue = inputEl.value || "";
      return;
    }

    // deÄŸer
    let raw = inputEl.value || "";

    // Ã§oklu @ temizle (paste vb.)
    const firstAt = raw.indexOf("@");
    const lastAt = raw.lastIndexOf("@");
    if (firstAt !== -1 && lastAt !== firstAt) {
      const left = raw.slice(0, firstAt);
      const right = raw.slice(firstAt + 1).replace(/@/g, "");
      raw = left + "@" + right;
      inputEl.value = raw;
    }

    const at = raw.indexOf("@");

    // @ yoksa: local normalize
    if (at < 0) {
      const local = normalizeLocal(raw);
      if (local !== raw) {
        const caret = inputEl.selectionStart ?? local.length;
        inputEl.value = local;
        safeSetSelection(inputEl, Math.min(caret, local.length), Math.min(caret, local.length));
      }
      emailState.lastValue = inputEl.value;
      return;
    }

    // parÃ§ala
    let local = normalizeLocal(raw.slice(0, at));
    let domTyped = (raw.slice(at + 1) || "").toLowerCase();
    domTyped = domTyped.replace(/[^a-z0-9.]/g, "");

    // sadece @ yazÄ±lmÄ±ÅŸsa
    if (domTyped.length === 0) {
      const next = local + "@";
      if (next !== raw) inputEl.value = next;
      emailState.lastValue = inputEl.value;
      return;
    }

    // domain prefix'ini geÃ§erli olana kÄ±rp
    domTyped = clampToValidDomainPrefix(domTyped);

    // âœ… Silme/backspace ise: ASLA autocomplete yapma.
    if (isDelete) {
      const next = local + "@" + domTyped;
      inputEl.value = next;

      // caret'i sona koy (mobilde daha stabil)
      const pos = next.length;
      safeSetSelection(inputEl, pos, pos);

      emailState.lastValue = inputEl.value;
      return;
    }

    // âœ… Yazma/insert ise: Ã¶ner (autocomplete)
    const matches = getMatches(domTyped);
    if (!matches.length) {
      // clamp zaten yaptÄ±, yine de gÃ¼venlik
      const next = local + "@" + domTyped;
      inputEl.value = next;
      emailState.lastValue = inputEl.value;
      return;
    }

    const best = matches[0];
    inputEl.value = local + "@" + best;

    // tamamlanan kÄ±smÄ± seÃ§ (kullanÄ±cÄ± backspace ile tek hamlede silebilsin)
    const startSel = (local + "@").length + domTyped.length;
    const endSel   = (local + "@").length + best.length;
    if (startSel <= endSel) safeSetSelection(inputEl, startSel, endSel);

    emailState.lastValue = inputEl.value;
  }

  function handleEmailBeforeInput(e) {
    if (!el.eposta) return;
    if (e.target !== el.eposta) return;
    if (e.isComposing) return;

    const inputType = e.inputType || "";
    const data = (typeof e.data === "string") ? e.data : "";

    // silme/geri alma serbest
    if (inputType.startsWith("delete") || inputType === "historyUndo" || inputType === "historyRedo") return;

    const start = el.eposta.selectionStart ?? (el.eposta.value || "").length;
    const end = el.eposta.selectionEnd ?? start;

    const current = el.eposta.value || "";
    const next = current.slice(0, start) + data + current.slice(end);

    // boÅŸluk engelle
    if (/\s/.test(data)) { e.preventDefault(); return; }

    // sadece 1 adet @ izin ver
    if ((next.match(/@/g) || []).length > 1) { e.preventDefault(); return; }

    const at = next.indexOf("@");
    if (at < 0) {
      // local part
      const ok = /^[a-zA-Z0-9._%+\-]*$/.test(next);
      if (!ok) e.preventDefault();
      return;
    }

    // @ sonrasÄ± (prefix)
    const local = next.slice(0, at);
    const dom = (next.slice(at + 1) || "").toLowerCase();

    if (!/^[a-zA-Z0-9._%+\-]+$/.test(local)) { e.preventDefault(); return; }
    if (!EMAIL_DOMAIN_ALLOWED_CHARS.test(dom)) { e.preventDefault(); return; }

    if (dom.length > 0 && getMatches(dom).length === 0) {
      e.preventDefault();
      return;
    }
  }

  function handleEmailInput(e) {
    if (!el.eposta) return;
    if (e.target !== el.eposta) return;

    const inputType = e.inputType || "";
    applyEmailRuleAndMaybeSuggest(el.eposta, inputType);

    // anlÄ±k hata kapat
    showEmailError(false);
    syncStars();
  }

  function handleEmailBlur() {
    if (!el.eposta) return;

    const v = (el.eposta.value || "").trim();
    if (!v) return;

    // @ var ama domain tamam deÄŸilse uyar
    if (!isAllowedEmailFull(v)) {
      showEmailError(true, "GeÃ§ersiz e-posta. Sadece izin verilen uzantÄ±larÄ± kullanÄ±n.");
    } else {
      showEmailError(false);
    }
  }

  /* =========================================================
     ACÄ°LÄ°YET
  ========================================================= */
  function aciliyetSec(trDeger) {
    if (!el.aciliyetHidden) return;

    el.rozetler.forEach(btn => {
      const v = btn.getAttribute("data-urgency") || "Orta";
      const secili = (v === trDeger);
      btn.classList.toggle("selected", secili);
      btn.setAttribute("aria-checked", secili ? "true" : "false");
      btn.tabIndex = secili ? 0 : -1;
    });
    el.aciliyetHidden.value = trDeger;
  }

  function urgencyKeyboardSupport(e) {
    const keys = ["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];
    if (!keys.includes(e.key)) return;

    const items = el.rozetler;
    const currentIndex = items.findIndex(x => x.classList.contains("selected"));
    if (currentIndex < 0) return;

    e.preventDefault();
    const dir = (e.key === "ArrowLeft" || e.key === "ArrowUp") ? -1 : 1;
    const next = (currentIndex + dir + items.length) % items.length;
    const nextVal = items[next].getAttribute("data-urgency") || "Orta";
    aciliyetSec(nextVal);
    items[next].focus();
  }

  /* =========================================================
     SAYAC
  ========================================================= */
  function sayacGuncelle(inputEl, sayacEl, max) {
    if (!inputEl || !sayacEl) return;
    const len = (inputEl.value || "").length;
    sayacEl.textContent = `${len}/${max}`;
  }

  /* =========================================================
     FORM DOÄžRULAMA
  ========================================================= */
  function seciliBildirimTurleri() {
    return $$('input[name="Bildirim TÃ¼rÃ¼[]"]:checked', el.form);
  }

  function dogrula() {
    const baslik = (el.baslik?.value || "").trim();
    const aciklama = (el.aciklama?.value || "").trim();
    const turler = seciliBildirimTurleri();

    showInlineError(el.baslikHata, false);
    showInlineError(el.aciklamaHata, false);
    showInlineError(el.turlerHata, false);
    showRateLimit(false);

    let ok = true;

    if (!baslik) {
      showInlineError(el.baslikHata, true);
      el.baslik?.focus();
      ok = false;
    }

    if (ok && !aciklama) {
      showInlineError(el.aciklamaHata, true);
      el.aciklama?.focus();
      ok = false;
    }

    if (ok && turler.length === 0) {
      showInlineError(el.turlerHata, true);
      kaydir(el.turlerGroup || el.turlerHata);
      focusGroupFirstInput(el.turlerGroup);
      ok = false;
    }

    if (ok && !validateEmailStrict()) ok = false;

    return ok;
  }

  /* =========================================================
     TEKNÄ°K VERÄ° TOPLAMA (Ä°ZNE BAÄžLI)
  ========================================================= */
  function parseBrowser(ua) {
    const m =
      ua.match(/Edg\/([\d.]+)/) ||
      ua.match(/OPR\/([\d.]+)/) ||
      ua.match(/Chrome\/([\d.]+)/) ||
      ua.match(/Firefox\/([\d.]+)/) ||
      (ua.match(/Version\/([\d.]+).*Safari\//) ? ua.match(/Version\/([\d.]+).*Safari\//) : null);

    if (ua.includes("Edg/")) return { name: "Microsoft Edge", version: (m && m[1]) || "" };
    if (ua.includes("OPR/")) return { name: "Opera", version: (m && m[1]) || "" };
    if (ua.includes("Firefox/")) return { name: "Firefox", version: (m && m[1]) || "" };
    if (ua.includes("Chrome/") && !ua.includes("Edg/")) return { name: "Chrome", version: (m && m[1]) || "" };
    if (ua.includes("Safari/") && !ua.includes("Chrome/")) return { name: "Safari", version: (m && m[1]) || "" };
    return { name: "Bilinmeyen TarayÄ±cÄ±", version: "" };
  }

  function parseOS(ua) {
    if (/Windows NT 10/.test(ua)) return "Windows 10/11";
    if (/Windows NT 6\.3/.test(ua)) return "Windows 8.1";
    if (/Windows NT 6\.2/.test(ua)) return "Windows 8";
    if (/Windows NT 6\.1/.test(ua)) return "Windows 7";
    if (/Android/.test(ua)) return "Android";
    if (/(iPhone|iPad|iPod)/.test(ua)) return "iOS";
    if (/Mac OS X/.test(ua) || /Macintosh/.test(ua)) return "Mac OS";
    if (/Linux/.test(ua)) return "Linux";
    return "Bilinmeyen Ä°ÅŸletim Sistemi";
  }

  async function ipAlIzinle() {
    try {
      const res = await fetch("https://api.ipify.org?format=json", { cache: "no-store" });
      if (!res.ok) throw new Error("ipify failed");
      const data = await res.json();
      return (data && data.ip) ? String(data.ip) : "";
    } catch (_) {
      return "";
    }
  }

  function minCihazBilgisiYaz() {
    const ua = navigator.userAgent || "";
    const os = parseOS(ua);
    const br = parseBrowser(ua);
    const shortLine = `${os} | ${br.name}${br.version ? " " + br.version : ""}`;
    if (el.cihaz) el.cihaz.value = shortLine;
  }

  function ensureSessionId() {
    let sid = localStorage.getItem("tabulago_session_id_v1");
    if (!sid) {
      sid = (crypto?.randomUUID?.() || ("sid_" + Math.random().toString(16).slice(2) + "_" + Date.now()));
      localStorage.setItem("tabulago_session_id_v1", sid);
    }
    if (el.sessionId) el.sessionId.value = sid;
  }

  async function teknikVeriDoldur() {
    const ua = navigator.userAgent || "";
    const os = parseOS(ua);
    const br = parseBrowser(ua);
    const shortLine = `${os} | ${br.name}${br.version ? " " + br.version : ""}`;

    if (el.cihaz) el.cihaz.value = shortLine;

    if (el.gonderimTarihi) el.gonderimTarihi.value = new Date().toLocaleString("tr-TR");
    if (el.sayfaAdresi) el.sayfaAdresi.value = window.location.href;

    const lang = (navigator.language || "tr-TR");
    const size = `${window.screen?.width || "-"}x${window.screen?.height || "-"}`;
    const dpr  = window.devicePixelRatio ? `DPR:${window.devicePixelRatio}` : "";

    let ip = "";
    let platform = "";
    let brands = "";

    if (consent.performance === true) {
      ip = await ipAlIzinle();

      try {
        if (navigator.userAgentData && navigator.userAgentData.getHighEntropyValues) {
          const hi = await navigator.userAgentData.getHighEntropyValues([
            "platform", "platformVersion", "architecture", "model", "uaFullVersion", "fullVersionList"
          ]);
          platform = `${hi.platform || ""}${hi.platformVersion ? " " + hi.platformVersion : ""}`.trim();
          if (hi.fullVersionList && hi.fullVersionList.length) {
            brands = hi.fullVersionList.map(x => `${x.brand} ${x.version}`).join(" | ");
          } else if (navigator.userAgentData.brands) {
            brands = navigator.userAgentData.brands.map(x => `${x.brand} ${x.version}`).join(" | ");
          }
        }
      } catch (_) {}
    }

    if (el.ipBilgisi) el.ipBilgisi.value = (consent.performance ? (ip || "") : "");

    const telemetryOn = !!el.telemetryOptIn?.checked;

    const details = [
      (telemetryOn ? `Session: ${el.sessionId?.value || ""}` : ""),
      `Ekran: ${size}`,
      dpr,
      `Dil: ${lang}`,
      (consent.performance ? (ip ? `IP: ${ip}` : "") : ""),
      (consent.performance ? (platform ? `Platform: ${platform}` : "") : ""),
      (consent.performance ? (brands ? `Markalar: ${brands}` : "") : ""),
      (consent.performance ? `UA: ${ua}` : "")
    ].filter(Boolean).join(" â€¢ ");

    if (el.tarayiciBilgisi) el.tarayiciBilgisi.value = details ? `${shortLine} â€” ${details}` : shortLine;
  }

  /* =========================================================
     FORMSPREE HATA MESAJI Ã‡EVÄ°RÄ°
  ========================================================= */
  function humanizeFormspreeError(msg) {
    const s = String(msg || "").toLowerCase();
    const map = [
      { k: "should be an email", v: "E-posta adresi geÃ§ersiz gÃ¶rÃ¼nÃ¼yor." },
      { k: "must be an email", v: "E-posta adresi geÃ§ersiz gÃ¶rÃ¼nÃ¼yor." },
      { k: "required", v: "LÃ¼tfen zorunlu alanlarÄ± doldurun." },
      { k: "too many requests", v: "Ã‡ok fazla istek yapÄ±ldÄ±. LÃ¼tfen biraz sonra tekrar deneyin." },
      { k: "invalid", v: "GÃ¶nderimde bir sorun var. LÃ¼tfen alanlarÄ± kontrol edin." },
      { k: "captcha", v: "DoÄŸrulama baÅŸarÄ±sÄ±z. LÃ¼tfen tekrar deneyin." },
      { k: "payload", v: "GÃ¶nderim verisi Ã§ok bÃ¼yÃ¼k." },
    ];
    for (const item of map) {
      if (s.includes(item.k)) return item.v;
    }
    return "GÃ¶nderim baÅŸarÄ±sÄ±z. LÃ¼tfen tekrar deneyin.";
  }

  /* =========================================================
     FORMSPREE GÃ–NDERÄ°MÄ°
  ========================================================= */
  async function formspreeGonder() {
    if (!el.form) return;

    await teknikVeriDoldur();

    const formData = new FormData(el.form);
    const res = await fetch(el.form.action, {
      method: "POST",
      body: formData,
      headers: { "Accept": "application/json" }
    });

    if (!res.ok) {
      let msg = "GÃ¶nderim baÅŸarÄ±sÄ±z. LÃ¼tfen tekrar deneyin.";
      try {
        const json = await res.json();
        if (json?.errors?.length) {
          msg = json.errors.map(e => humanizeFormspreeError(e.message)).join(" ");
        } else if (json?.error) {
          msg = humanizeFormspreeError(json.error);
        }
      } catch (_) {}
      throw new Error(msg);
    }
  }

  /* =========================================================
     UI STATE
  ========================================================= */
  function gonderimDurumu(state) {
    gonderiliyor = state;
    if (!el.gonderBtn) return;

    if (state) {
      el.gonderBtn.disabled = true;
      el.gonderBtn.dataset.orj = el.gonderBtn.innerHTML;
      el.gonderBtn.innerHTML = '<span class="loading" aria-hidden="true"></span> GÃ¶nderiliyor...';
    } else {
      if (el.gonderBtn.dataset.orj) {
        el.gonderBtn.innerHTML = el.gonderBtn.dataset.orj;
        delete el.gonderBtn.dataset.orj;
      }
      updateSubmitGate();
    }
  }

  function formSifirla() {
    el.form?.reset();
    sayacGuncelle(el.baslik, el.baslikSayac, LIMIT.baslik);
    sayacGuncelle(el.aciklama, el.aciklamaSayac, LIMIT.aciklama);
    aciliyetSec("Orta");
    showEmailError(false);
    showInlineError(el.baslikHata, false);
    showInlineError(el.aciklamaHata, false);
    showInlineError(el.turlerHata, false);
    showRateLimit(false);

    setCustomSelectValue(el.kategoriValue, el.kategoriBtnText, "", "SeÃ§iniz");
    setCustomSelectValue(el.tekrarValue, el.tekrarBtnText, "", "SeÃ§iniz");

    syncStars();
  }

  /* =========================================================
     SCROLL LOCK (Ã‡AKIÅžMASIZ)
  ========================================================= */
  let scrollLockCount = 0;

  function getScrollbarWidth() {
    return Math.max(0, window.innerWidth - document.documentElement.clientWidth);
  }

  function lockScroll() {
    scrollLockCount += 1;
    if (scrollLockCount > 1) return;

    const y = window.scrollY || 0;
    const sbw = getScrollbarWidth();

    document.body.dataset.scrollY = String(y);
    document.body.dataset.pr = document.body.style.paddingRight || "";

    if (sbw > 0) {
      const currentPR = parseFloat(getComputedStyle(document.body).paddingRight) || 0;
      document.body.style.paddingRight = (currentPR + sbw) + "px";
    }

    document.body.style.position = "fixed";
    document.body.style.top = `-${y}px`;
    document.body.style.left = "0";
    document.body.style.right = "0";
    document.body.style.width = "100%";
  }

  function unlockScroll() {
    scrollLockCount = Math.max(0, scrollLockCount - 1);
    if (scrollLockCount > 0) return;

    const y = parseInt(document.body.dataset.scrollY || "0", 10) || 0;
    const pr = document.body.dataset.pr ?? "";

    document.body.style.position = "";
    document.body.style.top = "";
    document.body.style.left = "";
    document.body.style.right = "";
    document.body.style.width = "";
    document.body.style.paddingRight = pr;

    delete document.body.dataset.scrollY;
    delete document.body.dataset.pr;

    window.scrollTo(0, y);
  }

  /* =========================================================
     COOKIE UI
  ========================================================= */
  function bannerOpen() {
    if (!el.cookieBanner) return;
    el.cookieBanner.classList.add("is-open");
    el.cookieBanner.setAttribute("aria-hidden", "false");
  }

  function bannerClose() {
    if (!el.cookieBanner) return;
    el.cookieBanner.classList.remove("is-open");
    el.cookieBanner.setAttribute("aria-hidden", "true");
  }

  let lastFocusEl = null;

  function getModalFocusable(modalRoot) {
    if (!modalRoot) return [];
    const selectors = ['button:not([disabled])','input:not([disabled])','a[href]'].join(",");
    return Array.from(modalRoot.querySelectorAll(selectors)).filter(x => x.offsetParent !== null);
  }

  function modalOpenCookie() {
    if (!el.cookieModal) return;
    lastFocusEl = document.activeElement;

    el.cookieModal.classList.add("is-open");
    el.cookieModal.setAttribute("aria-hidden", "false");
    lockScroll();

    setTimeout(() => {
      const root = el.cookieModal.querySelector(".cookie-modal-content");
      const items = getModalFocusable(root);
      (items[0] || el.cookieSaveBtn || el.cookieAcceptAllBtnModal || el.cookieRejectAllBtnModal)?.focus?.();
    }, 0);
  }

  function modalCloseCookie() {
    if (!el.cookieModal) return;

    el.cookieModal.classList.remove("is-open");
    el.cookieModal.setAttribute("aria-hidden", "true");
    unlockScroll();

    if (lastFocusEl && lastFocusEl.focus) setTimeout(() => lastFocusEl.focus(), 0);
    lastFocusEl = null;
  }

  function trapFocusCookie(e) {
    if (!el.cookieModal?.classList.contains("is-open")) return;
    if (e.key !== "Tab") return;

    const root = el.cookieModal.querySelector(".cookie-modal-content");
    const items = getModalFocusable(root);
    if (!items.length) return;

    const first = items[0];
    const last = items[items.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }
  }

  function applyConsentToUI(c) {
    if (el.cookieAnalytics) el.cookieAnalytics.checked = !!c.analytics;
    if (el.cookiePerformance) el.cookiePerformance.checked = !!c.performance;
  }

  function updateSubmitGate() {
    const allowed = !!consent.granted && !gonderiliyor;
    if (el.gonderBtn) el.gonderBtn.disabled = !allowed;
    if (el.gonderBtn) el.gonderBtn.title = allowed ? "" : "Devam etmek iÃ§in Ã§erez tercihlerinizi seÃ§melisiniz.";
  }

  function acceptAll() {
    applyConsentToUI({ analytics: true, performance: true });
    saveConsent({ analytics: true, performance: true });
    bannerClose();
    modalCloseCookie();
  }

  function rejectAll() {
    applyConsentToUI({ analytics: false, performance: false });
    saveConsent({ analytics: false, performance: false });
    bannerClose();
    modalCloseCookie();
  }

  function saveChoices() {
    const c = {
      analytics: !!el.cookieAnalytics?.checked,
      performance: !!el.cookiePerformance?.checked
    };
    saveConsent(c);
    bannerClose();
    modalCloseCookie();
  }

  function bindCookieEvents() {
    if (cookieEventsBound) return;
    cookieEventsBound = true;

    el.cookieManageBtnBanner?.addEventListener("click", () => {
      applyConsentToUI(consent.granted ? consent : { analytics:false, performance:false });
      modalOpenCookie();
    });

    el.cookieAcceptAllBtnBanner?.addEventListener("click", acceptAll);
    el.cookieRejectAllBtnBanner?.addEventListener("click", rejectAll);

    el.cookieSaveBtn?.addEventListener("click", saveChoices);
    el.cookieAcceptAllBtnModal?.addEventListener("click", acceptAll);
    el.cookieRejectAllBtnModal?.addEventListener("click", rejectAll);

    el.cookieModal?.addEventListener("click", (e) => {
      const closeTarget = e.target?.closest?.("[data-cookie-close]");
      if (closeTarget) modalCloseCookie();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && el.cookieModal?.classList.contains("is-open")) modalCloseCookie();
    });

    document.addEventListener("keydown", trapFocusCookie);
  }

  function initCookieConsent() {
    bindCookieEvents();

    const stored = loadConsent();
    if (stored && stored.granted) {
      consent = stored;
      applyConsentToUI(consent);
      bannerClose();
    } else {
      consent = { required: true, analytics:false, performance:false, granted:false, ts:0 };
      applyConsentToUI({ analytics:false, performance:false });
      bannerOpen();
    }
    updateSubmitGate();
  }

  /* =========================================================
     CUSTOM SELECT (Kategori / Tekrar)
  ========================================================= */
  function setCustomSelectValue(hiddenInput, btnTextEl, value, fallbackText) {
    if (hiddenInput) hiddenInput.value = value || "";
    if (!btnTextEl) return;
    if (value) {
      btnTextEl.textContent = value;
      btnTextEl.classList.remove("cs-placeholder");
      btnTextEl.classList.add("cs-value");
    } else {
      btnTextEl.textContent = fallbackText || "SeÃ§iniz";
      btnTextEl.classList.remove("cs-value");
      btnTextEl.classList.add("cs-placeholder");
    }
  }

  function getModalRoot(modalEl) {
    return modalEl?.querySelector(".cs-sheet") || null;
  }

  function openCS(btnEl, modalEl) {
    if (!btnEl || !modalEl) return;
    btnEl.setAttribute("aria-expanded", "true");
    modalEl.classList.add("is-open");
    modalEl.setAttribute("aria-hidden", "false");
    lockScroll();

    setTimeout(() => {
      const first = modalEl.querySelector(".cs-item");
      first?.focus?.();
    }, 0);
  }

  function closeCS(btnEl, modalEl) {
    if (!btnEl || !modalEl) return;
    btnEl.setAttribute("aria-expanded", "false");
    modalEl.classList.remove("is-open");
    modalEl.setAttribute("aria-hidden", "true");
    unlockScroll();

    setTimeout(() => { btnEl.focus?.(); }, 0);
  }

  function trapFocusCS(e, modalEl) {
    if (!modalEl?.classList.contains("is-open")) return;
    if (e.key !== "Tab") return;

    const root = getModalRoot(modalEl);
    const items = getModalFocusable(root);
    if (!items.length) return;

    const first = items[0];
    const last = items[items.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }
  }

  function syncSelectedClass(modalEl, currentValue) {
    if (!modalEl) return;
    $$(".cs-item", modalEl).forEach(item => {
      const v = item.getAttribute("data-cs-value") ?? "";
      item.classList.toggle("is-selected", (v === (currentValue || "")));
    });
  }

  function initCustomSelect(opts) {
    const { btn, modal, hidden, btnText, fallback = "SeÃ§iniz" } = opts;
    if (!btn || !modal || !hidden || !btnText) return;

    btn.addEventListener("click", () => {
      syncSelectedClass(modal, hidden.value);
      openCS(btn, modal);
    });

    modal.addEventListener("click", (e) => {
      const closeTarget = e.target?.closest?.("[data-cs-close]");
      if (closeTarget) { closeCS(btn, modal); return; }

      const item = e.target?.closest?.(".cs-item");
      if (item) {
        const v = item.getAttribute("data-cs-value") ?? "";
        setCustomSelectValue(hidden, btnText, v, fallback);
        closeCS(btn, modal);
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("is-open")) closeCS(btn, modal);
      trapFocusCS(e, modal);
    });

    setCustomSelectValue(hidden, btnText, hidden.value || "", fallback);
  }

  /* =========================================================
     EVENTS
  ========================================================= */
  function olaylariBagla() {
    el.baslik?.addEventListener("input", () => {
      sayacGuncelle(el.baslik, el.baslikSayac, LIMIT.baslik);
      showInlineError(el.baslikHata, false);
      syncStars();
    });

    el.aciklama?.addEventListener("input", () => {
      sayacGuncelle(el.aciklama, el.aciklamaSayac, LIMIT.aciklama);
      showInlineError(el.aciklamaHata, false);
      syncStars();
    });

    $$('#turlerGroup input[type="checkbox"]').forEach(ch =>
      ch.addEventListener("change", () => {
        showInlineError(el.turlerHata, false);
        syncStars();
      })
    );

    // âœ… Email: FIX'li sÃ¼rÃ¼m
    el.eposta?.addEventListener("beforeinput", handleEmailBeforeInput);
    el.eposta?.addEventListener("input", handleEmailInput);
    el.eposta?.addEventListener("blur", handleEmailBlur);

    el.urgencyGroup?.addEventListener("click", (e) => {
      const btn = e.target.closest(".urgency-badge");
      if (!btn) return;
      aciliyetSec(btn.getAttribute("data-urgency") || "Orta");
    });
    el.urgencyGroup?.addEventListener("keydown", urgencyKeyboardSupport);

    el.geriBtn?.addEventListener("click", () => { window.location.href = "index.html"; });

    el.form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (gonderiliyor) return;

      if (!consent.granted) {
        bannerOpen();
        kaydir(el.cookieBanner);
        return;
      }

      if (isTooFastSinceOpen()) {
        showRateLimit(true, "Form Ã§ok hÄ±zlÄ± gÃ¶nderildi. LÃ¼tfen birkaÃ§ saniye bekleyip tekrar deneyin.");
        kaydir(el.rateLimitInfo);
        return;
      }

      const rl = canSubmitCooldown();
      if (!rl.ok) {
        showRateLimit(true, `Ã‡ok sÄ±k gÃ¶nderim yapÄ±yorsunuz. LÃ¼tfen ${rl.remain} saniye sonra tekrar deneyin.`);
        kaydir(el.rateLimitInfo);
        return;
      }

      gizle(el.success);
      gizle(el.error);
      showRateLimit(false);

      syncStars();
      if (!dogrula()) return;

      gonderimDurumu(true);

      try {
        await formspreeGonder();
        markSubmittedNow();

        setText(el.successText, "TeÅŸekkÃ¼rler! Bildiriminiz bize ulaÅŸtÄ±. Ana sayfaya yÃ¶nlendiriliyorsunuzâ€¦");
        goster(el.success);
        kaydir(el.success);

        window.setTimeout(() => { window.location.href = "index.html"; }, 2200);
        formSifirla();
      } catch (err) {
        console.error(err);
        setText(el.errorText, err?.message || "Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.");
        goster(el.error);
        kaydir(el.error);
      } finally {
        gonderimDurumu(false);
      }
    });

    let t = null;
    window.addEventListener("resize", () => {
      window.clearTimeout(t);
      t = window.setTimeout(partikullerOlustur, 150);
    });
  }

  /* =========================================================
     INIT
  ========================================================= */
  document.addEventListener("DOMContentLoaded", () => {
    document.title = "TabulaGo - Sorun Bildir";
    if (el.yil) el.yil.textContent = String(new Date().getFullYear());

    if (el.pageOpenTs) el.pageOpenTs.value = String(Date.now());

    ensureSessionId();
    partikullerOlustur();
    minCihazBilgisiYaz();

    sayacGuncelle(el.baslik, el.baslikSayac, LIMIT.baslik);
    sayacGuncelle(el.aciklama, el.aciklamaSayac, LIMIT.aciklama);

    aciliyetSec("Orta");
    syncStars();

    initCustomSelect({
      btn: el.kategoriBtn,
      modal: el.kategoriModal,
      hidden: el.kategoriValue,
      btnText: el.kategoriBtnText,
      fallback: "SeÃ§iniz"
    });
    initCustomSelect({
      btn: el.tekrarBtn,
      modal: el.tekrarModal,
      hidden: el.tekrarValue,
      btnText: el.tekrarBtnText,
      fallback: "SeÃ§iniz"
    });

    olaylariBagla();
    initCookieConsent();
  });

})();
</script>
</body>
</html>
